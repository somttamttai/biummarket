<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ë¹„ì›€ë§ˆì¼“ BIUM MARKET â€” ì¬ê³ ì›ë‹¨ B2B í”Œë«í¼</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:16px}
body{font-family:'Noto Sans KR',sans-serif;background:#f0f0f0;color:#212121;min-height:100vh;display:flex;justify-content:center}
button{cursor:pointer;border:none;background:none;font-family:inherit}
input,select,textarea{font-family:inherit}
ul{list-style:none}
:root{
  --P:#FF6B35;--PL:#FFF0EB;--PD:#E55A26;
  --g50:#FAFAFA;--g100:#F5F5F5;--g200:#EEEEEE;--g300:#E0E0E0;
  --g500:#9E9E9E;--g700:#616161;--g900:#212121;
  --r:12px;--rs:8px;
}
#app{width:100%;max-width:480px;background:#fff;min-height:100vh;position:relative;overflow-x:hidden;box-shadow:0 0 32px rgba(0,0,0,.1)}

/* VIEWS */
.view{display:none;flex-direction:column;min-height:100vh}
.view.active{display:flex}

/* HEADER */
.hdr{position:sticky;top:0;z-index:100;background:#fff;border-bottom:1px solid var(--g200);padding:0 14px;height:52px;display:flex;align-items:center;gap:8px}
.hdr-logo{font-size:18px;font-weight:700;color:var(--P);flex:1}
.hdr-logo small{font-size:10px;font-weight:400;color:var(--g500);margin-left:4px}
.hdr-btn{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;color:var(--g700);transition:background .15s}
.hdr-btn:hover{background:var(--g100)}
.hdr-back{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--g900)}
.hdr-title{font-size:16px;font-weight:700;flex:1;text-align:center}
.hdr-loc{display:flex;align-items:center;gap:3px;font-size:13px;font-weight:600;padding:5px 10px;border-radius:20px;background:var(--g100)}

/* TAB BAR */
.tabbar{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;height:60px;background:#fff;border-top:1px solid var(--g200);display:flex;align-items:center;justify-content:space-around;z-index:200}
.tab{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 12px;color:var(--g500);font-size:10px;font-weight:500}
.tab .ti{font-size:20px;line-height:1}
.tab.on{color:var(--P)}
.tab-fab{width:46px;height:46px;border-radius:50%;background:var(--P);color:#fff;font-size:24px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(255,107,53,.4)}

/* SEARCH */
.srch-wrap{padding:10px 14px 6px;background:#fff;border-bottom:1px solid var(--g200)}
.srch-bar{display:flex;align-items:center;gap:8px;background:var(--g100);border-radius:22px;padding:9px 14px;margin-bottom:8px}
.srch-bar input{flex:1;border:none;background:transparent;font-size:14px;outline:none;color:var(--g900)}
.srch-bar input::placeholder{color:var(--g500)}
.chips{display:flex;gap:6px;overflow-x:auto;padding-bottom:2px;scrollbar-width:none}
.chips::-webkit-scrollbar{display:none}
.chip{flex-shrink:0;padding:5px 13px;border-radius:20px;font-size:12px;font-weight:500;border:1.5px solid var(--g300);color:var(--g700);background:#fff}
.chip.on{border-color:var(--P);color:var(--P);background:var(--PL)}

/* PRODUCT LIST */
.plist{flex:1;padding:10px 10px 72px;display:grid;grid-template-columns:1fr 1fr;gap:10px}
.pcard{border-radius:var(--r);overflow:hidden;background:#fff;border:1px solid var(--g200);cursor:pointer;transition:transform .15s,box-shadow .15s;position:relative}
.pcard:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.1)}
.pthumb{width:100%;aspect-ratio:1;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.pthumb::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.12) 0%,transparent 60%)}
.fabric-badge{position:relative;z-index:1;background:rgba(0,0,0,.25);padding:3px 9px;border-radius:20px;font-size:11px;font-weight:600;color:rgba(255,255,255,.9)}
.card-heart{position:absolute;top:7px;right:7px;z-index:2;width:30px;height:30px;border-radius:50%;background:rgba(255,255,255,.88);display:flex;align-items:center;justify-content:center;font-size:14px;box-shadow:0 1px 4px rgba(0,0,0,.12)}
.pinfo{padding:9px 9px 7px}
.pname{font-size:12px;font-weight:600;line-height:1.4;margin-bottom:3px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
.pmeta{font-size:11px;color:var(--g500);margin-bottom:5px}
.pprice{font-size:13px;font-weight:700}
.pprice .pu{font-size:10px;font-weight:400;color:var(--g500)}
.pfoot{display:flex;justify-content:space-between;align-items:center;margin-top:5px;padding-top:5px;border-top:1px solid var(--g100)}
.ploc{font-size:10px;color:var(--g500);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.pcnt{display:flex;gap:5px;font-size:10px;color:var(--g500);flex-shrink:0}
.badge-new{position:absolute;top:7px;left:7px;z-index:2;background:var(--P);color:#fff;font-size:9px;font-weight:700;padding:2px 6px;border-radius:10px}

/* EMPTY */
.empty{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;color:var(--g500);padding:40px;text-align:center}
.empty .ei{font-size:44px}

/* LOGIN */
#view-login{background:#fff;align-items:center;justify-content:center;padding:32px 24px}
.login-logo{font-size:32px;font-weight:700;color:var(--P);margin-bottom:4px;text-align:center}
.login-sub{font-size:13px;color:var(--g500);text-align:center;margin-bottom:32px;line-height:1.6}
.login-box{width:100%}
.fi{width:100%;border:1.5px solid var(--g300);border-radius:var(--rs);padding:12px 14px;font-size:15px;color:var(--g900);outline:none;transition:border-color .15s;background:#fff}
.fi:focus{border-color:var(--P)}
.fi::placeholder{color:var(--g500)}
.fg{margin-bottom:14px}
.fg label{display:block;font-size:13px;font-weight:600;color:var(--g700);margin-bottom:6px}
.fg .req{color:var(--P)}
.btn-primary{width:100%;padding:14px;background:var(--P);color:#fff;border-radius:var(--r);font-size:15px;font-weight:700;transition:background .15s}
.btn-primary:hover{background:var(--PD)}
.btn-secondary{width:100%;padding:13px;border:1.5px solid var(--g300);border-radius:var(--r);font-size:14px;font-weight:600;color:var(--g700);transition:all .15s}
.btn-secondary:hover{border-color:var(--P);color:var(--P)}
.divider-text{text-align:center;color:var(--g500);font-size:12px;margin:16px 0;position:relative}
.divider-text::before,.divider-text::after{content:'';position:absolute;top:50%;width:40%;height:1px;background:var(--g200)}
.divider-text::before{left:0}.divider-text::after{right:0}
.type-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px}
.type-card{border:1.5px solid var(--g300);border-radius:var(--rs);padding:12px 10px;text-align:center;cursor:pointer;transition:all .15s}
.type-card:hover{border-color:var(--P);background:var(--PL)}
.type-card.sel{border-color:var(--P);background:var(--PL);color:var(--P)}
.type-card .tc-icon{font-size:24px;margin-bottom:4px}
.type-card .tc-name{font-size:13px;font-weight:600}
.type-card .tc-desc{font-size:10px;color:var(--g500);margin-top:2px}
.type-card.sel .tc-desc{color:var(--PD)}

/* DETAIL */
.d-scroll{flex:1;overflow-y:auto;padding-bottom:88px}
.d-slider{position:relative;width:100%;aspect-ratio:1;overflow:hidden;background:var(--g200)}
.s-track{display:flex;height:100%;transition:transform .35s cubic-bezier(.4,0,.2,1)}
.s-slide{flex-shrink:0;width:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:8px;color:rgba(255,255,255,.9)}
.s-dots{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:5px}
.s-dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.55);transition:all .2s}
.s-dot.on{background:#fff;transform:scale(1.3)}
.s-nav{position:absolute;top:50%;transform:translateY(-50%);width:34px;height:34px;border-radius:50%;background:rgba(0,0,0,.28);color:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;z-index:2}
.s-prev{left:10px}.s-next{right:10px}

.sel-sec{padding:14px;border-bottom:8px solid var(--g100);display:flex;align-items:center;gap:12px}
.sel-av{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:17px;color:#fff;font-weight:700;flex-shrink:0}
.sel-info{flex:1}
.sel-name{font-size:14px;font-weight:700;margin-bottom:1px}
.sel-loc{font-size:12px;color:var(--g500)}
.temp-box{text-align:right}
.temp-val{font-size:16px;font-weight:700;color:var(--P)}
.temp-lbl{font-size:10px;color:var(--g500)}

.d-sec{padding:14px;border-bottom:8px solid var(--g100)}
.d-sec h3{font-size:15px;font-weight:700;margin-bottom:10px}
.ftbl{width:100%;border-collapse:collapse}
.ftbl tr:not(:last-child) td{border-bottom:1px solid var(--g100)}
.ftbl td{padding:9px 4px;font-size:13px}
.ftbl td:first-child{color:var(--g500);width:72px;font-weight:500}
.ftbl td:last-child{font-weight:600}
.d-desc p{font-size:13px;line-height:1.7;color:var(--g700)}
.tag-row{display:flex;flex-wrap:wrap;gap:7px}
.tagc{padding:4px 11px;border-radius:20px;background:var(--PL);color:var(--P);font-size:12px;font-weight:500}
.d-stats{padding:10px 14px;font-size:11px;color:var(--g500);display:flex;gap:14px}

.d-action{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;height:76px;background:#fff;border-top:1px solid var(--g200);display:flex;align-items:center;gap:10px;padding:0 14px;z-index:200}
.heart-btn{display:flex;flex-direction:column;align-items:center;gap:2px;font-size:10px;color:var(--g500);padding:6px 8px}
.heart-btn .hicon{font-size:21px}
.heart-btn.on{color:var(--P)}
.price-area{flex:1}
.price-area .tp{font-size:17px;font-weight:700}
.price-area .pp{font-size:11px;color:var(--g500)}
.chat-btn{background:var(--P);color:#fff;border-radius:10px;padding:11px 20px;font-size:14px;font-weight:700}
.suggest-btn{border:1.5px solid var(--P);color:var(--P);border-radius:10px;padding:11px 14px;font-size:13px;font-weight:600}

/* FORM */
.f-scroll{flex:1;overflow-y:auto;padding:14px 14px 96px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.total-disp{padding:11px 14px;background:var(--PL);border-radius:var(--rs);border:1.5px solid rgba(255,107,53,.2);font-size:14px;font-weight:700;color:var(--P)}
.img-scroll{display:flex;gap:8px;overflow-x:auto;scrollbar-width:none;padding-bottom:2px}
.img-scroll::-webkit-scrollbar{display:none}
.img-add{flex-shrink:0;width:76px;height:76px;border-radius:var(--rs);border:2px dashed var(--g300);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;color:var(--g500);font-size:11px}
.img-add:hover{border-color:var(--P);color:var(--P)}
.img-prev{flex-shrink:0;width:76px;height:76px;border-radius:var(--rs);overflow:hidden;position:relative}
.img-prev img{width:100%;height:100%;object-fit:cover}
.img-rm{position:absolute;top:3px;right:3px;width:18px;height:18px;border-radius:50%;background:rgba(0,0,0,.5);color:#fff;font-size:11px;display:flex;align-items:center;justify-content:center}
select.fi{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%239E9E9E' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 13px center;padding-right:34px}
textarea.fi{resize:vertical;min-height:90px;line-height:1.6}
.submit-btn{width:100%;padding:15px;background:var(--P);color:#fff;border-radius:var(--r);font-size:15px;font-weight:700;margin-top:8px}
.submit-btn:hover{background:var(--PD)}
.form-divider{height:1px;background:var(--g200);margin:16px 0}
.ai-hint{background:#f0f4ff;border:1px solid #c0d0ff;border-radius:var(--rs);padding:10px 12px;font-size:12px;color:#3355cc;line-height:1.6;margin-bottom:14px;display:flex;gap:8px;align-items:flex-start}
.ai-hint .ai-icon{font-size:18px;flex-shrink:0}

/* ADMIN */
.admin-tabs{display:flex;border-bottom:1px solid var(--g200);background:#fff;position:sticky;top:52px;z-index:50}
.atab{flex:1;padding:12px 4px;text-align:center;font-size:12px;font-weight:600;color:var(--g500);border-bottom:2px solid transparent;transition:all .15s}
.atab.on{color:var(--P);border-bottom-color:var(--P)}
.admin-content{flex:1;overflow-y:auto;padding:14px 14px 80px}
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:18px}
.stat-card{background:#fff;border:1px solid var(--g200);border-radius:var(--r);padding:14px;text-align:center}
.stat-card .sv{font-size:22px;font-weight:700;color:var(--P)}
.stat-card .sl{font-size:11px;color:var(--g500);margin-top:3px}
.table-wrap{overflow-x:auto}
.data-table{width:100%;border-collapse:collapse;font-size:12px}
.data-table th{padding:8px 10px;text-align:left;background:var(--g100);color:var(--g700);font-weight:600;white-space:nowrap}
.data-table td{padding:8px 10px;border-bottom:1px solid var(--g100);vertical-align:middle}
.data-table tr:hover td{background:var(--g50)}
.badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:10px;font-weight:600}
.badge-green{background:#e8f5e9;color:#2e7d32}
.badge-blue{background:#e3f2fd;color:#1565c0}
.badge-orange{background:var(--PL);color:var(--P)}
.badge-gray{background:var(--g200);color:var(--g700)}
.action-btn{padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;border:1px solid var(--g300);color:var(--g700)}
.action-btn.del{border-color:#ffcdd2;color:#c62828;background:#fff5f5}

/* SELLER PAGE */
.seller-hero{position:relative;height:140px;background:linear-gradient(135deg,var(--P),#ff9a6c);display:flex;align-items:flex-end;padding:14px}
.seller-hero-info{display:flex;align-items:flex-end;gap:12px;color:#fff}
.seller-big-av{width:60px;height:60px;border-radius:50%;background:rgba(255,255,255,.25);border:2px solid rgba(255,255,255,.6);display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:700;color:#fff;flex-shrink:0}
.seller-hero-name{font-size:18px;font-weight:700;margin-bottom:2px}
.seller-hero-loc{font-size:12px;opacity:.85}
.seller-stats{display:flex;gap:0;border-bottom:8px solid var(--g100)}
.sstat{flex:1;padding:14px;text-align:center;border-right:1px solid var(--g200)}
.sstat:last-child{border-right:none}
.sstat .sv{font-size:17px;font-weight:700}
.sstat .sl{font-size:11px;color:var(--g500);margin-top:2px}

/* MYPAGE */
.mp-user{padding:20px 14px;display:flex;align-items:center;gap:14px;border-bottom:8px solid var(--g100)}
.mp-av{width:54px;height:54px;border-radius:50%;background:var(--P);display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700;color:#fff;flex-shrink:0}
.mp-info{}
.mp-name{font-size:17px;font-weight:700;margin-bottom:2px}
.mp-type{font-size:12px;color:var(--g500)}
.mp-temp{font-size:13px;color:var(--P);font-weight:600;margin-top:2px}
.menu-list{padding:0 0 80px}
.menu-item{display:flex;align-items:center;gap:12px;padding:15px 16px;border-bottom:1px solid var(--g100);cursor:pointer}
.menu-item:hover{background:var(--g50)}
.menu-icon{font-size:20px;width:28px;text-align:center}
.menu-label{flex:1;font-size:14px;font-weight:500}
.menu-arrow{color:var(--g300);font-size:14px}
.menu-section{padding:12px 16px 6px;font-size:11px;font-weight:700;color:var(--g500);letter-spacing:.5px}

/* ANALYTICS */
.ana-sec{padding:14px;border-bottom:6px solid var(--g100)}
.ana-sec h3{font-size:14px;font-weight:700;margin-bottom:10px}
.bar-chart{display:flex;align-items:flex-end;gap:6px;height:80px}
.bar-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px}
.bar{border-radius:4px 4px 0 0;width:100%;background:var(--PL);transition:height .5s;position:relative}
.bar.active{background:var(--P)}
.bar-lbl{font-size:9px;color:var(--g500)}
.bar-val{font-size:9px;font-weight:600;color:var(--g700)}

/* LANG SELECTOR */
.lang-sel{display:flex;gap:2px;padding:0 14px}
.lang-btn{padding:4px 8px;border-radius:14px;font-size:11px;font-weight:600;color:var(--g500);border:1px solid transparent;transition:all .15s}
.lang-btn.on{background:var(--P);color:#fff}

/* RESERVATION */
.res-type-row{display:flex;gap:8px;margin-bottom:16px}
.res-card{flex:1;border:1.5px solid var(--g300);border-radius:var(--rs);padding:12px 8px;text-align:center;cursor:pointer;transition:all .15s}
.res-card:hover,.res-card.sel{border-color:var(--P);background:var(--PL)}
.res-card .ri{font-size:22px;margin-bottom:5px}
.res-card .rn{font-size:12px;font-weight:600}
.res-card .rd{font-size:10px;color:var(--g500);margin-top:2px}

/* TOAST */
.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(16px);background:rgba(33,33,33,.9);color:#fff;padding:11px 20px;border-radius:22px;font-size:13px;font-weight:500;opacity:0;transition:opacity .3s,transform .3s;z-index:999;white-space:nowrap;pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* MODAL */
.mover{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:500;display:none;align-items:flex-end;justify-content:center}
.mover.open{display:flex}
.msheet{width:100%;max-width:480px;background:#fff;border-radius:20px 20px 0 0;padding:20px 18px 36px}
.mhandle{width:34px;height:4px;border-radius:2px;background:var(--g300);margin:0 auto 16px}
.mtitle{font-size:17px;font-weight:700;margin-bottom:8px;text-align:center}
.mdesc{font-size:13px;color:var(--g500);line-height:1.6;text-align:center}
.mclose{margin-top:18px;padding:12px 32px;background:var(--P);color:#fff;border-radius:10px;font-size:14px;font-weight:600;width:100%}

/* PRICE SUGGEST MODAL */
.suggest-form{padding:0 0 8px}
.suggest-form .fg{margin-bottom:12px}
.suggest-form .fg label{font-size:13px;font-weight:600;color:var(--g700);display:block;margin-bottom:5px}

/* SCROLLBAR */
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--g200);border-radius:4px}

@media(min-width:480px){
  .tabbar,.d-action,.toast{left:50%}
}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
</head>
<body>
<div id="app">

<!-- ========== LOGIN ========== -->
<div id="view-login" class="view active">
  <div style="padding:48px 24px 0;width:100%">
    <div class="login-logo">ğŸ§µ ë¹„ì›€ë§ˆì¼“</div>
    <div class="login-logo" style="font-size:13px;font-weight:400;color:var(--g500);margin-bottom:28px">BIUM MARKET â€” B2B ì¬ê³ ì›ë‹¨ ê±°ë˜ í”Œë«í¼</div>
    <div class="login-box">
      <div class="fg">
        <label>ì•„ì´ë”” (ì´ë©”ì¼)</label>
        <input type="email" class="fi" id="l-email" placeholder="example@bium.market" />
      </div>
      <div class="fg">
        <label>ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" class="fi" id="l-pw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" onkeydown="if(event.key==='Enter')doLogin()" />
      </div>
      <button class="btn-primary" onclick="doLogin()" style="margin-bottom:12px">ë¡œê·¸ì¸</button>
      <button class="btn-secondary" onclick="showView('signup')">íšŒì›ê°€ì…</button>
      <div class="divider-text">í…ŒìŠ¤íŠ¸ ê³„ì •</div>
      <div style="background:var(--g100);border-radius:var(--rs);padding:12px 14px;font-size:12px;color:var(--g700);line-height:1.8">
        ê´€ë¦¬ì: <b>admin</b> / <b>1234</b><br>
        íŒë§¤ì: <b>seller@test.com</b> / <b>1234</b><br>
        êµ¬ë§¤ì: <b>buyer@test.com</b> / <b>1234</b>
      </div>
    </div>
  </div>
  <div style="margin-top:auto;padding:20px;text-align:center;font-size:11px;color:var(--g500)">
    â“’ 2024 LOWHIGH MARKET Â· ì„œìš¸ ë™ëŒ€ë¬¸êµ¬ Â· ëŒ€í‘œ ì†ì •í˜„
  </div>
</div>

<!-- ========== SIGNUP ========== -->
<div id="view-signup" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="showView('login')">â†</button>
    <div class="hdr-title" data-i18n="signup_title">íšŒì›ê°€ì…</div>
    <div style="width:38px"></div>
  </header>
  <div class="f-scroll">
    <div style="margin-bottom:16px">
      <div class="fg"><label>íšŒì› ìœ í˜• ì„ íƒ <span class="req">*</span></label></div>
      <div class="type-grid">
        <div class="type-card sel" data-type="seller" onclick="selectType('seller',this)">
          <div class="tc-icon">ğŸ­</div>
          <div class="tc-name">íŒë§¤ì</div>
          <div class="tc-desc">ì›ë‹¨ ë„ë§¤ Â· ì¬ê³  íŒë§¤</div>
        </div>
        <div class="type-card" data-type="buyer" onclick="selectType('buyer',this)">
          <div class="tc-icon">ğŸ›’</div>
          <div class="tc-name">êµ¬ë§¤ì</div>
          <div class="tc-desc">ì›ë‹¨ ì†Œì‹± Â· êµ¬ë§¤</div>
        </div>
        <div class="type-card" data-type="brand" onclick="selectType('brand',this)">
          <div class="tc-icon">ğŸ‘—</div>
          <div class="tc-name">ë¸Œëœë“œ</div>
          <div class="tc-desc">íŒ¨ì…˜ ë¸Œëœë“œ Â· ì œì¡°ì‚¬</div>
        </div>
        <div class="type-card" data-type="both" onclick="selectType('both',this)">
          <div class="tc-icon">ğŸ”„</div>
          <div class="tc-name">ê²¸ì—…</div>
          <div class="tc-desc">íŒë§¤ + êµ¬ë§¤ ëª¨ë‘</div>
        </div>
      </div>
    </div>
    <div class="fg"><label>ì´ë¦„ <span class="req">*</span></label><input type="text" class="fi" id="s-name" placeholder="ì´ë¦„ ë˜ëŠ” ì—…ì²´ëª…"/></div>
    <div class="fg"><label>ì´ë©”ì¼ <span class="req">*</span></label><input type="email" class="fi" id="s-email" placeholder="example@bium.market"/></div>
    <div class="fg"><label>ë¹„ë°€ë²ˆí˜¸ <span class="req">*</span></label><input type="password" class="fi" id="s-pw" placeholder="6ì ì´ìƒ"/></div>
    <div class="fg"><label>ì‚¬ì—…ì¥ ìœ„ì¹˜</label><input type="text" class="fi" id="s-loc" placeholder="ì˜ˆ) ì„œìš¸ ë™ëŒ€ë¬¸êµ¬ ì‹ ì„¤ë™"/></div>
    <button class="submit-btn" onclick="doSignup()">ê°€ì…í•˜ê¸°</button>
  </div>
</div>

<!-- ========== LIST ========== -->
<div id="view-list" class="view">
  <header class="hdr">
    <div class="hdr-logo">ë¹„ì›€ë§ˆì¼“ <small>BIUM MARKET</small></div>
    <button class="hdr-btn" id="btn-loc" title="ì§€ì—­">ğŸ“</button>
    <button class="hdr-btn" id="btn-alert" title="ì•Œë¦¼">ğŸ””</button>
    <button class="hdr-btn" onclick="toggleLangPanel()" title="ì–¸ì–´">ğŸŒ</button>
  </header>
  <div id="lang-panel" style="display:none;padding:8px 14px;background:#fff;border-bottom:1px solid var(--g200)">
    <div class="lang-sel" id="lang-sel"></div>
  </div>
  <div class="srch-wrap">
    <div class="srch-bar">
      <span style="font-size:15px;color:var(--g500)">ğŸ”</span>
      <input type="text" id="search-input" placeholder="ì›ë‹¨ ì¢…ë¥˜, ìƒ‰ìƒ, ì—…ì²´ëª… ê²€ìƒ‰" autocomplete="off"/>
    </div>
    <div class="chips" id="filter-chips"></div>
  </div>
  <ul class="plist" id="product-list"></ul>
  <div class="empty" id="empty-state" style="display:none">
    <div class="ei">ğŸ§µ</div>
    <p id="empty-msg">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”</p>
  </div>
  <nav class="tabbar">
    <button class="tab on" onclick="showView('list')"><span class="ti">ğŸ </span><span data-i18n="tab_home">í™ˆ</span></button>
    <button class="tab" onclick="showView('search-view')"><span class="ti">ğŸ”</span><span data-i18n="tab_search">ê²€ìƒ‰</span></button>
    <button class="tab-fab" onclick="showView('form')">ï¼‹</button>
    <button class="tab" onclick="showToast(t('chat_coming'))"><span class="ti">ğŸ’¬</span><span data-i18n="tab_chat">ì±„íŒ…</span></button>
    <button class="tab" onclick="showView('mypage')"><span class="ti">ğŸ‘¤</span><span data-i18n="tab_me">MY</span></button>
  </nav>
</div>

<!-- ========== DETAIL ========== -->
<div id="view-detail" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">â†</button>
    <div class="hdr-title" id="d-hdr-title">ìƒí’ˆ ìƒì„¸</div>
    <button class="hdr-btn" onclick="shareProduct()">â‹¯</button>
  </header>
  <div class="d-scroll" id="d-scroll">
    <div class="d-slider" id="d-slider">
      <div class="s-track" id="s-track"></div>
      <div class="s-dots" id="s-dots"></div>
      <button class="s-nav s-prev" id="s-prev" onclick="slideMove(-1)">â€¹</button>
      <button class="s-nav s-next" id="s-next" onclick="slideMove(1)">â€º</button>
    </div>
    <div class="sel-sec">
      <div class="sel-av" id="d-av"></div>
      <div class="sel-info">
        <div class="sel-name" id="d-sname"></div>
        <div class="sel-loc" id="d-sloc"></div>
      </div>
      <div class="temp-box">
        <div class="temp-val" id="d-temp"></div>
        <div class="temp-lbl">ë§¤ë„ˆì˜¨ë„</div>
        <button style="font-size:11px;color:var(--P);margin-top:3px" onclick="openSellerPage()">ë¯¸ë‹ˆí™ˆí”¼ â†’</button>
      </div>
    </div>
    <div class="d-sec">
      <h3 data-i18n="fabric_info">ì›ë‹¨ ì •ë³´</h3>
      <table class="ftbl" id="d-ftbl"></table>
    </div>
    <div class="d-sec d-desc">
      <h3 data-i18n="product_desc">ìƒí’ˆ ì„¤ëª…</h3>
      <p id="d-desc"></p>
    </div>
    <div class="d-sec">
      <div class="tag-row" id="d-tags"></div>
    </div>
    <div class="d-stats" id="d-stats"></div>
    <!-- ì˜ˆì•½ ì„¹ì…˜ -->
    <div class="d-sec">
      <h3>ì˜ˆì•½ ì‹ ì²­</h3>
      <div class="res-type-row">
        <div class="res-card sel" onclick="selectRes('visit',this)">
          <div class="ri">ğŸ </div>
          <div class="rn">ë°©ë¬¸ ì˜ˆì•½</div>
          <div class="rd">ì§ì ‘ ë°©ë¬¸</div>
        </div>
        <div class="res-card" onclick="selectRes('swatch',this)">
          <div class="ri">ğŸ¨</div>
          <div class="rn">ìŠ¤ì™€ì¹˜</div>
          <div class="rd">ìƒ˜í”Œ ë°œì†¡</div>
        </div>
        <div class="res-card" onclick="selectRes('inspect',this)">
          <div class="ri">ğŸ”</div>
          <div class="rn">ì¶œì¥ê°ë³„</div>
          <div class="rd">ì „ë¬¸ê°€ ë°©ë¬¸</div>
        </div>
      </div>
      <button class="btn-secondary" style="font-size:13px;padding:10px" onclick="openResModal()">ì˜ˆì•½í•˜ê¸°</button>
    </div>
  </div>
  <div class="d-action">
    <button class="heart-btn" id="d-heart" onclick="toggleDetailLike()">
      <span class="hicon" id="d-hicon">ğŸ¤</span>
      <span id="d-lcnt">0</span>
    </button>
    <div class="price-area">
      <div class="tp" id="d-tp"></div>
      <div class="pp" id="d-pp"></div>
    </div>
    <button class="suggest-btn" onclick="openSuggestModal()">ê°€ê²©ì œì•ˆ</button>
    <button class="chat-btn" onclick="openChatModal()">ì±„íŒ…</button>
  </div>
</div>

<!-- ========== FORM ========== -->
<div id="view-form" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">âœ•</button>
    <div class="hdr-title" data-i18n="form_title">ì›ë‹¨ íŒë§¤ ë“±ë¡</div>
    <div style="width:38px"></div>
  </header>
  <div class="f-scroll">
    <div class="ai-hint">
      <span class="ai-icon">ğŸ¤–</span>
      <span>AI ìë™ ì…ë ¥: ì‚¬ì§„ì„ ì²¨ë¶€í•˜ë©´ ì†Œì¬Â·ìƒ‰ìƒÂ·ì¤‘ëŸ‰ì„ ìë™ìœ¼ë¡œ ì¸ì‹í•´ë“œë ¤ìš”!</span>
    </div>
    <div style="margin-bottom:16px">
      <div style="font-size:13px;font-weight:600;color:var(--g700);margin-bottom:8px">ì‚¬ì§„ ì²¨ë¶€ <span style="color:var(--g500);font-weight:400">(ìµœëŒ€ 5ì¥)</span></div>
      <div class="img-scroll" id="img-scroll">
        <input type="file" id="file-input" accept="image/*" multiple style="display:none"/>
        <button class="img-add" onclick="document.getElementById('file-input').click()">
          <span style="font-size:22px">ï¼‹</span><span>ì‚¬ì§„ì¶”ê°€</span>
        </button>
      </div>
    </div>
    <div class="form-divider"></div>
    <div class="fg"><label>ìƒí’ˆëª… <span class="req">*</span></label><input type="text" class="fi" id="f-title" placeholder="ì˜ˆ) ì•„ì´ë³´ë¦¬ ë©´ ì›ë‹¨ ì¬ê³  45m"/></div>
    <div class="fg"><label>ì¹´í…Œê³ ë¦¬ (ëŒ€ë¶„ë¥˜)</label>
      <select class="fi" id="f-cat1" onchange="updateCat2()">
        <option value="">ì„ íƒ</option>
        <option value="ì²œì—°ì„¬ìœ ">ì²œì—°ì„¬ìœ </option>
        <option value="í•©ì„±ì„¬ìœ ">í•©ì„±ì„¬ìœ </option>
        <option value="í˜¼ë°©">í˜¼ë°©</option>
        <option value="íŠ¹ìˆ˜ì›ë‹¨">íŠ¹ìˆ˜ì›ë‹¨</option>
      </select>
    </div>
    <div class="fg"><label>ì›ë‹¨ ì¢…ë¥˜ <span class="req">*</span></label>
      <select class="fi" id="f-type">
        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
        <option value="ë©´">ë©´</option>
        <option value="í´ë¦¬">í´ë¦¬</option>
        <option value="ìš¸">ìš¸</option>
        <option value="ë¦°ë„¨">ë¦°ë„¨</option>
        <option value="ì‹¤í¬">ì‹¤í¬</option>
        <option value="í˜¼ë°©">í˜¼ë°©</option>
        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
      </select>
    </div>
    <div class="form-row">
      <div class="fg"><label>ìƒ‰ìƒ <span class="req">*</span></label><input type="text" class="fi" id="f-color" placeholder="ì˜ˆ) ì•„ì´ë³´ë¦¬"/></div>
      <div class="fg"><label>í­ (cm)</label><input type="number" class="fi" id="f-width" placeholder="ì˜ˆ) 150" min="0"/></div>
    </div>
    <div class="form-row">
      <div class="fg"><label>ì¤‘ëŸ‰ (g/ã¡)</label><input type="number" class="fi" id="f-weight" placeholder="ì˜ˆ) 180"/></div>
      <div class="fg"><label>ìˆ˜ëŸ‰ (m) <span class="req">*</span></label><input type="number" class="fi" id="f-qty" placeholder="ì˜ˆ) 30" min="0" step="0.1" oninput="calcTotal()"/></div>
    </div>
    <div class="fg"><label>ë‹¨ê°€ (ì›/m) <span class="req">*</span></label><input type="number" class="fi" id="f-price" placeholder="ì˜ˆ) 5000" min="0" oninput="calcTotal()"/></div>
    <div class="fg"><label>ì´ ê¸ˆì•¡ (ìë™ ê³„ì‚°)</label><div class="total-disp" id="f-total">ìˆ˜ëŸ‰ê³¼ ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ë©´ ìë™ ê³„ì‚°ë¼ìš”</div></div>
    <div class="fg"><label>ê±°ë˜ ì§€ì—­ <span class="req">*</span></label><input type="text" class="fi" id="f-loc" placeholder="ì˜ˆ) ì„œìš¸ ë™ëŒ€ë¬¸êµ¬ ì‹ ì„¤ë™"/></div>
    <div class="form-divider"></div>
    <div class="fg"><label>ìƒì„¸ ì„¤ëª…</label><textarea class="fi" id="f-desc" placeholder="ì›ë‹¨ ìƒíƒœ, êµ¬ë§¤ ê²½ìœ„, ê±°ë˜ ë°©ë²• ë“±ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”."></textarea></div>
    <div class="fg"><label>í•´ì‹œíƒœê·¸ <span style="color:var(--g500);font-weight:400">(ì‰¼í‘œ êµ¬ë¶„)</span></label><input type="text" class="fi" id="f-tags" placeholder="ì¬ê³ ì›ë‹¨, í• ì¸, ì†ŒëŸ‰ê°€ëŠ¥"/></div>
    <div class="fg"><label>AI ê°€ê²© ì˜ˆì¸¡</label>
      <div style="background:#f8fff8;border:1px solid #c0e0c0;border-radius:var(--rs);padding:10px 12px;font-size:12px;color:#2e7d32" id="ai-price-hint">ì›ë‹¨ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ AIê°€ ì ì • ê°€ê²©ì„ ì˜ˆì¸¡í•´ë“œë ¤ìš” ğŸ“Š</div>
    </div>
    <button class="submit-btn" onclick="submitForm()">ë“±ë¡í•˜ê¸°</button>
  </div>
</div>

<!-- ========== ADMIN ========== -->
<div id="view-admin" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">â†</button>
    <div class="hdr-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</div>
    <button class="hdr-btn" onclick="doLogout()">ğŸšª</button>
  </header>
  <div class="admin-tabs" id="admin-tabs">
    <button class="atab on" onclick="switchAdminTab('overview',this)">ê°œìš”</button>
    <button class="atab" onclick="switchAdminTab('users',this)">íšŒì›</button>
    <button class="atab" onclick="switchAdminTab('products',this)">ìƒí’ˆ</button>
    <button class="atab" onclick="switchAdminTab('notices',this)">ê³µì§€</button>
  </div>
  <div class="admin-content" id="admin-content"></div>
</div>

<!-- ========== SELLER PAGE ========== -->
<div id="view-seller" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">â†</button>
    <div class="hdr-title">íŒë§¤ì ë¯¸ë‹ˆí™ˆí”¼</div>
    <button class="hdr-btn" onclick="showToast('ê³µìœ ëì–´ìš”!')">â‹¯</button>
  </header>
  <div style="flex:1;overflow-y:auto;padding-bottom:72px">
    <div class="seller-hero" id="sh-hero">
      <div class="seller-hero-info">
        <div class="seller-big-av" id="sh-av"></div>
        <div>
          <div class="seller-hero-name" id="sh-name"></div>
          <div class="seller-hero-loc" id="sh-loc"></div>
        </div>
      </div>
    </div>
    <div class="seller-stats" id="sh-stats"></div>
    <div style="padding:14px;border-bottom:6px solid var(--g100)">
      <div style="font-size:13px;font-weight:700;margin-bottom:8px">ì—…ì²´ ì†Œê°œ</div>
      <div style="font-size:13px;color:var(--g700);line-height:1.7" id="sh-intro"></div>
    </div>
    <div style="padding:14px">
      <div style="font-size:13px;font-weight:700;margin-bottom:10px">ë“±ë¡ ìƒí’ˆ</div>
      <ul class="plist" id="sh-products" style="padding:0;grid-template-columns:1fr 1fr"></ul>
    </div>
  </div>
</div>

<!-- ========== MYPAGE ========== -->
<div id="view-mypage" class="view">
  <header class="hdr">
    <div class="hdr-logo">ë¹„ì›€ë§ˆì¼“</div>
    <button class="hdr-btn" onclick="doLogout()">ğŸšª</button>
  </header>
  <div style="flex:1;overflow-y:auto">
    <div class="mp-user">
      <div class="mp-av" id="mp-av"></div>
      <div class="mp-info">
        <div class="mp-name" id="mp-name"></div>
        <div class="mp-type" id="mp-type"></div>
        <div class="mp-temp" id="mp-temp"></div>
      </div>
    </div>
    <div class="menu-list" id="menu-list"></div>
  </div>
  <nav class="tabbar">
    <button class="tab" onclick="showView('list')"><span class="ti">ğŸ </span><span>í™ˆ</span></button>
    <button class="tab" onclick="showToast(t('chat_coming'))"><span class="ti">ğŸ”</span><span>ê²€ìƒ‰</span></button>
    <button class="tab-fab" onclick="showView('form')">ï¼‹</button>
    <button class="tab" onclick="showToast(t('chat_coming'))"><span class="ti">ğŸ’¬</span><span>ì±„íŒ…</span></button>
    <button class="tab on" onclick="showView('mypage')"><span class="ti">ğŸ‘¤</span><span>MY</span></button>
  </nav>
</div>

<!-- ========== ANALYTICS ========== -->
<div id="view-analytics" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">â†</button>
    <div class="hdr-title">ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ</div>
    <div style="width:38px"></div>
  </header>
  <div style="flex:1;overflow-y:auto;padding-bottom:20px">
    <div class="ana-sec">
      <h3>ì´ë²ˆ ë‹¬ ìš”ì•½</h3>
      <div class="stat-grid">
        <div class="stat-card"><div class="sv">â‚©2.4M</div><div class="sl">ì´ ë§¤ì¶œ</div></div>
        <div class="stat-card"><div class="sv">8ê±´</div><div class="sl">ê±°ë˜ ì™„ë£Œ</div></div>
        <div class="stat-card"><div class="sv">340m</div><div class="sl">íŒë§¤ ìˆ˜ëŸ‰</div></div>
        <div class="stat-card"><div class="sv">94%</div><div class="sl">ì‘ë‹µë¥ </div></div>
      </div>
    </div>
    <div class="ana-sec">
      <h3>ì›”ë³„ ë§¤ì¶œ (ìµœê·¼ 6ê°œì›”)</h3>
      <div class="bar-chart" id="bar-chart"></div>
    </div>
    <div class="ana-sec">
      <h3>ì¸ê¸° ì›ë‹¨ TOP 3</h3>
      <div id="top-fabrics"></div>
    </div>
    <div class="ana-sec">
      <h3>ì‹¤ì‹œê°„ ì›ë‹¨ ì‹œì„¸</h3>
      <div id="market-price"></div>
    </div>
  </div>
</div>

</div><!-- #app -->

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- MODAL: CHAT -->
<div class="mover" id="modal-chat" onclick="closeModal('modal-chat',event)">
  <div class="msheet">
    <div class="mhandle"></div>
    <div style="font-size:40px;text-align:center;margin-bottom:10px">ğŸ’¬</div>
    <div class="mtitle">ì±„íŒ…í•˜ê¸°</div>
    <div class="mdesc">ì‹¤ì‹œê°„ ì±„íŒ… ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.<br>ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ì˜¤í”ˆí• ê²Œìš”!</div>
    <button class="mclose" onclick="closeModal('modal-chat')">í™•ì¸</button>
  </div>
</div>

<!-- MODAL: PRICE SUGGEST -->
<div class="mover" id="modal-suggest" onclick="closeModal('modal-suggest',event)">
  <div class="msheet">
    <div class="mhandle"></div>
    <div class="mtitle">ğŸ’° ê°€ê²© ì œì•ˆ</div>
    <div class="suggest-form">
      <div class="fg">
        <label>ì œì•ˆ ê°€ê²© (ì›/m)</label>
        <input type="number" class="fi" id="suggest-price" placeholder="ì œì•ˆí•  ë‹¨ê°€ ì…ë ¥"/>
      </div>
      <div class="fg">
        <label>ë©”ì‹œì§€</label>
        <textarea class="fi" id="suggest-msg" placeholder="ì œì•ˆ ì´ìœ ë‚˜ ê±°ë˜ ì¡°ê±´ì„ ì…ë ¥í•˜ì„¸ìš”" style="min-height:70px"></textarea>
      </div>
    </div>
    <button class="mclose" onclick="submitSuggest()">ì œì•ˆ ë³´ë‚´ê¸°</button>
  </div>
</div>

<!-- MODAL: RESERVATION -->
<div class="mover" id="modal-res" onclick="closeModal('modal-res',event)">
  <div class="msheet">
    <div class="mhandle"></div>
    <div class="mtitle" id="res-modal-title">ë°©ë¬¸ ì˜ˆì•½</div>
    <div class="suggest-form">
      <div class="fg">
        <label>í¬ë§ ë‚ ì§œ</label>
        <input type="date" class="fi" id="res-date"/>
      </div>
      <div class="fg">
        <label>í¬ë§ ì‹œê°„</label>
        <select class="fi" id="res-time">
          <option>09:00</option><option>10:00</option><option>11:00</option>
          <option>13:00</option><option>14:00</option><option>15:00</option><option>16:00</option>
        </select>
      </div>
      <div class="fg">
        <label>ìš”ì²­ ì‚¬í•­</label>
        <input type="text" class="fi" id="res-note" placeholder="íŠ¹ì´ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•´ì£¼ì„¸ìš”"/>
      </div>
    </div>
    <button class="mclose" onclick="submitReservation()">ì˜ˆì•½ ì‹ ì²­</button>
  </div>
</div>

<!-- MODAL: SHARE -->
<div class="mover" id="modal-share" onclick="closeModal('modal-share',event)">
  <div class="msheet">
    <div class="mhandle"></div>
    <div class="mtitle">ê³µìœ í•˜ê¸°</div>
    <div style="display:flex;justify-content:center;gap:16px;margin:16px 0">
      <button onclick="showToast('ë§í¬ê°€ ë³µì‚¬ëì–´ìš”!');closeModal('modal-share')" style="display:flex;flex-direction:column;align-items:center;gap:6px;font-size:12px;color:var(--g700)"><span style="font-size:32px;background:var(--g100);border-radius:50%;width:52px;height:52px;display:flex;align-items:center;justify-content:center">ğŸ”—</span>ë§í¬ë³µì‚¬</button>
      <button onclick="showToast('ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì¤€ë¹„ì¤‘');closeModal('modal-share')" style="display:flex;flex-direction:column;align-items:center;gap:6px;font-size:12px;color:var(--g700)"><span style="font-size:32px;background:#FFE812;border-radius:50%;width:52px;height:52px;display:flex;align-items:center;justify-content:center">ğŸ’›</span>ì¹´ì¹´ì˜¤í†¡</button>
    </div>
    <button class="mclose" onclick="closeModal('modal-share')">ë‹«ê¸°</button>
  </div>
</div>

<script>
/* ==================== I18N ==================== */
const LANGS={
  ko:{code:'ko',name:'í•œêµ­ì–´',flag:'ğŸ‡°ğŸ‡·',
    tab_home:'í™ˆ',tab_search:'ê²€ìƒ‰',tab_chat:'ì±„íŒ…',tab_me:'MY',
    signup_title:'íšŒì›ê°€ì…',form_title:'ì›ë‹¨ íŒë§¤ ë“±ë¡',
    fabric_info:'ì›ë‹¨ ì •ë³´',product_desc:'ìƒí’ˆ ì„¤ëª…',
    chat_coming:'ì±„íŒ… ê¸°ëŠ¥ ì¤€ë¹„ì¤‘ì´ì—ìš”',
    empty_msg:'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”',
    registered:'ìƒí’ˆì´ ë“±ë¡ëì–´ìš”! ğŸ‰',
  },
  en:{code:'en',name:'English',flag:'ğŸ‡ºğŸ‡¸',
    tab_home:'Home',tab_search:'Search',tab_chat:'Chat',tab_me:'My',
    signup_title:'Sign Up',form_title:'Register Fabric',
    fabric_info:'Fabric Info',product_desc:'Description',
    chat_coming:'Chat coming soon',
    empty_msg:'No results found',
    registered:'Product registered! ğŸ‰',
  },
  ja:{code:'ja',name:'æ—¥æœ¬èª',flag:'ğŸ‡¯ğŸ‡µ',
    tab_home:'ãƒ›ãƒ¼ãƒ ',tab_search:'æ¤œç´¢',tab_chat:'ãƒãƒ£ãƒƒãƒˆ',tab_me:'MY',
    signup_title:'ä¼šå“¡ç™»éŒ²',form_title:'ç”Ÿåœ°ç™»éŒ²',
    fabric_info:'ç”Ÿåœ°æƒ…å ±',product_desc:'å•†å“èª¬æ˜',
    chat_coming:'ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™',
    empty_msg:'æ¤œç´¢çµæœãªã—',
    registered:'å•†å“ãŒç™»éŒ²ã•ã‚Œã¾ã—ãŸï¼ğŸ‰',
  },
  zh:{code:'zh',name:'ä¸­æ–‡',flag:'ğŸ‡¨ğŸ‡³',
    tab_home:'é¦–é¡µ',tab_search:'æœç´¢',tab_chat:'èŠå¤©',tab_me:'æˆ‘çš„',
    signup_title:'æ³¨å†Œ',form_title:'æ³¨å†Œé¢æ–™',
    fabric_info:'é¢æ–™ä¿¡æ¯',product_desc:'å•†å“æè¿°',
    chat_coming:'èŠå¤©åŠŸèƒ½å‡†å¤‡ä¸­',
    empty_msg:'æ²¡æœ‰æœç´¢ç»“æœ',
    registered:'å•†å“å·²æ³¨å†Œï¼ğŸ‰',
  },
  vi:{code:'vi',name:'Tiáº¿ng Viá»‡t',flag:'ğŸ‡»ğŸ‡³',
    tab_home:'Trang chá»§',tab_search:'TÃ¬m kiáº¿m',tab_chat:'Chat',tab_me:'TÃ´i',
    signup_title:'ÄÄƒng kÃ½',form_title:'ÄÄƒng kÃ½ váº£i',
    fabric_info:'ThÃ´ng tin váº£i',product_desc:'MÃ´ táº£ sáº£n pháº©m',
    chat_coming:'Chá»©c nÄƒng chat Ä‘ang chuáº©n bá»‹',
    empty_msg:'KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£',
    registered:'Sáº£n pháº©m Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng kÃ½! ğŸ‰',
  },
};
let curLang='ko';
function t(k){return(LANGS[curLang]||LANGS.ko)[k]||k}
function setLang(code){
  curLang=code;
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const k=el.dataset.i18n;const v=t(k);if(v)el.textContent=v;
  });
  renderLangButtons();
}
function renderLangButtons(){
  const el=document.getElementById('lang-sel');if(!el)return;
  el.innerHTML=Object.values(LANGS).map(l=>`<button class="lang-btn ${l.code===curLang?'on':''}" onclick="setLang('${l.code}')">${l.flag} ${l.name}</button>`).join('');
}
function toggleLangPanel(){
  const p=document.getElementById('lang-panel');
  p.style.display=p.style.display==='none'?'block':'none';
  renderLangButtons();
}

/* ==================== COLORS ==================== */
const FCOLORS={
  'ë©´':['#E8D5C4','#C8DFE4','#D4E8C8','#2C3E50','#E8C8D4','#F2E8D0'],
  'í´ë¦¬':['#4A90D9','#B8D4F0','#D4B8F0','#F0B8B8','#B8F0D4','#F0D4B8'],
  'ìš¸':['#8B4513','#4A2810','#A0522D','#CD853F','#D2691E','#DEB887'],
  'ë¦°ë„¨':['#D2B48C','#BFA37A','#8B7355','#C8A882','#E0C8A0','#F5DEB3'],
  'ì‹¤í¬':['#FFD700','#DA70D6','#9370DB','#87CEEB','#FF69B4','#98FB98'],
  'í˜¼ë°©':['#7B8FA3','#5A6B7A','#3D5166','#9AA8B8','#6B7A8A','#B8C4CE'],
  'ê¸°íƒ€':['#95A5A6','#566573','#7F8C8D','#85929E','#A9B7BF','#BDC3C7'],
};
function getFColor(type,color){
  const p=FCOLORS[type]||FCOLORS['ê¸°íƒ€'];
  const i=Math.abs((color||'').split('').reduce((a,c)=>a+c.charCodeAt(0),0))%p.length;
  return p[i];
}
function getTexture(type){
  const m={'ë©´':'repeating-linear-gradient(45deg,rgba(255,255,255,.06) 0px,rgba(255,255,255,.06) 2px,transparent 2px,transparent 8px)','í´ë¦¬':'repeating-linear-gradient(0deg,rgba(255,255,255,.05) 0px,rgba(255,255,255,.05) 1px,transparent 1px,transparent 4px)','ìš¸':'repeating-linear-gradient(-45deg,rgba(0,0,0,.05) 0px,rgba(0,0,0,.05) 1px,transparent 1px,transparent 6px)','ë¦°ë„¨':'repeating-linear-gradient(90deg,rgba(255,255,255,.07) 0px,rgba(255,255,255,.07) 1px,transparent 1px,transparent 5px),repeating-linear-gradient(0deg,rgba(255,255,255,.07) 0px,rgba(255,255,255,.07) 1px,transparent 1px,transparent 5px)','ì‹¤í¬':'linear-gradient(135deg,rgba(255,255,255,.3) 0%,rgba(255,255,255,0) 50%,rgba(255,255,255,.15) 100%)'};
  return m[type]||'none';
}
function fmtPrice(n){return n.toLocaleString('ko-KR')+'ì›'}

/* ==================== LOCAL STORAGE ==================== */
function lsGet(k,def){try{const v=localStorage.getItem('bium_'+k);return v?JSON.parse(v):def}catch{return def}}
function lsSet(k,v){try{localStorage.setItem('bium_'+k,JSON.stringify(v))}catch{}}

/* ==================== SUPABASE ==================== */
const _SB_URL='https://ygernyfkydqalqmjzjbw.supabase.co';
const _SB_KEY='sb_publishable_CIC03pgTltIAwP24vpZXyQ_6QEajQ2_';
let _sb=null;
try{
  if(typeof window.supabase!=='undefined'){
    _sb=window.supabase.createClient(_SB_URL,_SB_KEY);
    _sb.auth.onAuthStateChange((event)=>{
      if(event==='SIGNED_OUT'&&typeof curUser!=='undefined'&&curUser&&curUser.email!=='admin'){
        curUser=null;lsSet('curUser',null);showView('login');
      }
    });
  }else{
    console.warn('Supabase SDK ë¡œë“œ ì‹¤íŒ¨ â€” ë¡œì»¬ ëª¨ë“œë¡œ ë™ì‘í•©ë‹ˆë‹¤.');
  }
}catch(e){
  console.error('Supabase ì´ˆê¸°í™” ì˜¤ë¥˜:',e);
  _sb=null;
}

/* ==================== USERS ==================== */
const DEFAULT_USERS=[
  {id:'admin',name:'ê´€ë¦¬ì',email:'admin',pw:'1234',type:'admin',loc:'ì„œìš¸ ë™ëŒ€ë¬¸êµ¬',temp:99.9,joinDate:'2024-01-01'},
  {id:'s1',name:'ì—ì´ì›ì›ë‹¨',email:'seller@test.com',pw:'1234',type:'seller',loc:'ì„œìš¸ ì„±ë™êµ¬ ì„±ìˆ˜ë™',temp:38.2,joinDate:'2024-02-15',
   intro:'ë™ëŒ€ë¬¸ 20ë…„ ê²½ë ¥ ì›ë‹¨ ë„ë§¤ì—…ì²´ì…ë‹ˆë‹¤. ë©´/í´ë¦¬ ì¤‘ì‹¬ìœ¼ë¡œ ì¬ê³ ì›ë‹¨ì„ í•©ë¦¬ì ì¸ ê°€ê²©ì— ê³µê¸‰í•©ë‹ˆë‹¤.',
   bizName:'(ì£¼)ì—ì´ì›í…ìŠ¤íƒ€ì¼',ceo:'ê¹€ì—ì´ì›',tel:'02-1234-5678'},
  {id:'b1',name:'íŒ¨ì…˜êµ¬ë§¤íŒ€',email:'buyer@test.com',pw:'1234',type:'buyer',loc:'ì„œìš¸ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™',temp:36.5,joinDate:'2024-03-10'},
];
let users=lsGet('users',DEFAULT_USERS);
let curUser=lsGet('curUser',null);

function findUser(email,pw){return users.find(u=>u.email===email&&u.pw===pw)}

/* ==================== PRODUCTS ==================== */
const SELLERS_SAMPLE=[
  {id:'s1',name:'ì—ì´ì›ì›ë‹¨',temp:38.2,loc:'ì„œìš¸ ì„±ë™êµ¬ ì„±ìˆ˜ë™'},
  {id:'s2',name:'ì§ë¬¼ë‚˜ë¼',temp:36.5,loc:'ì„œìš¸ ì¢…ë¡œêµ¬ ì°½ì‹ ë™'},
  {id:'s3',name:'íŒ¨ì…˜íŒ©í† ë¦¬',temp:42.1,loc:'ë¶€ì‚° ì¤‘êµ¬ ê´‘ë³µë™'},
  {id:'s4',name:'ì‹¤ê³¼ë°”ëŠ˜',temp:35.0,loc:'ëŒ€êµ¬ ì¤‘êµ¬ ë™ì„±ë¡œ'},
  {id:'s5',name:'í…ìŠ¤íƒ€ì¼ë©',temp:44.7,loc:'ì„œìš¸ ë§ˆí¬êµ¬ ë§ì›ë™'},
];
const DEFAULT_PRODUCTS=[
  {id:1,title:'ì†Œí”„íŠ¸ ì•„ì´ë³´ë¦¬ ë©´ ì›ë‹¨ ì¬ê³  ì²˜ë¶„',type:'ë©´',color:'ì•„ì´ë³´ë¦¬',width:150,weight:120,qty:45,price:4500,loc:'ì„œìš¸ ì„±ë™êµ¬ ì„±ìˆ˜ë™',cat:'ì²œì—°ì„¬ìœ ',description:'êµ­ë‚´ ëŒ€í˜• ì˜ë¥˜ ë¸Œëœë“œ OEM ìƒì‚° í›„ ë‚¨ì€ ì¬ê³  ì›ë‹¨ì…ë‹ˆë‹¤. 40ìˆ˜ ë©´ ì†Œì¬ë¡œ ë¶€ë“œëŸ½ê³  ë‚´êµ¬ì„±ì´ ì¢‹ìŠµë‹ˆë‹¤. ì—¬ë¦„ ì˜ë¥˜, ì†ì˜·, ì¹¨êµ¬ë¥˜ ë“± ë‹¤ì–‘í•˜ê²Œ í™œìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.',tags:['ì¬ê³ ì›ë‹¨','ë©´ì›ë‹¨','ì•„ì´ë³´ë¦¬','ì†ŒëŸ‰ê°€ëŠ¥','ì§ê±°ë˜'],seller:SELLERS_SAMPLE[0],imgs:3,likes:12,chats:5,time:'3ì‹œê°„ ì „',liked:false},
  {id:2,title:'ì‹œì›í•œ ë„¤ì´ë¹„ í´ë¦¬ ì‰¬í° ì›ë‹¨ 50m',type:'í´ë¦¬',color:'ë„¤ì´ë¹„',width:110,weight:80,qty:50,price:2800,loc:'ì„œìš¸ ì¢…ë¡œêµ¬ ì°½ì‹ ë™',cat:'í•©ì„±ì„¬ìœ ',description:'ì—¬ë¦„ ë¸”ë¼ìš°ìŠ¤ ìƒì‚°ì— ì‚¬ìš©í•˜ë ¤ë‹¤ ë‚¨ì€ ì¬ê³ ì…ë‹ˆë‹¤. í†µê¸°ì„±ì´ ì¢‹ê³  ê°€ë²¼ìš´ ì‰¬í° ì†Œì¬ë¡œ ë“œë ˆìŠ¤, ìŠ¤ì¹´í”„, ì»¤íŠ¼ ë“±ì— ì í•©í•©ë‹ˆë‹¤.',tags:['í´ë¦¬ì‰¬í°','ë„¤ì´ë¹„','ì—¬ë¦„ì›ë‹¨','50m'],seller:SELLERS_SAMPLE[1],imgs:2,likes:8,chats:3,time:'5ì‹œê°„ ì „',liked:false},
  {id:3,title:'ê³ ê¸‰ ë²„ê±´ë”” ìš¸ ì›ë‹¨ 20m íŠ¹ê°€',type:'ìš¸',color:'ë²„ê±´ë””',width:150,weight:320,qty:20,price:18000,loc:'ë¶€ì‚° ì¤‘êµ¬ ê´‘ë³µë™',cat:'ì²œì—°ì„¬ìœ ',description:'ì´íƒˆë¦¬ì•„ì‚° ìš¸ ì›ë‹¨ ìˆ˜ì… í›„ ë‚¨ì€ ì¬ê³ ì…ë‹ˆë‹¤. ìµœê³ ê¸‰ ë©”ë¦¬ë…¸ ìš¸ ì†Œì¬ë¡œ ê°€ì„Â·ê²¨ìš¸ ì½”íŠ¸, ì¬í‚· ì œì‘ì— ìµœì ì…ë‹ˆë‹¤.',tags:['ìš¸ì›ë‹¨','ë²„ê±´ë””','ê³ ê¸‰ì›ë‹¨','ì´íƒˆë¦¬ì•„ì‚°','ì½”íŠ¸ê°'],seller:SELLERS_SAMPLE[2],imgs:4,likes:24,chats:11,time:'ì–´ì œ',liked:false},
  {id:4,title:'ë‚´ì¶”ëŸ´ ë² ì´ì§€ ë¦°ë„¨ ì›ë‹¨ ì„¸ì¼',type:'ë¦°ë„¨',color:'ë² ì´ì§€',width:140,weight:160,qty:35,price:6000,loc:'ëŒ€êµ¬ ì¤‘êµ¬ ë™ì„±ë¡œ',cat:'ì²œì—°ì„¬ìœ ',description:'ë´„Â·ì—¬ë¦„ ì‹œì¦Œ ì¤€ë¹„ë¡œ ë“¤ì—¬ì˜¨ ë¦°ë„¨ ì›ë‹¨ì…ë‹ˆë‹¤. ì²œì—° ì†Œì¬ íŠ¹ìœ ì˜ ì§ˆê°ê³¼ ì‹œì›í•¨ì´ íŠ¹ì§•ì´ë©°, ì˜ë¥˜ë¿ ì•„ë‹ˆë¼ í™ˆ ì¸í…Œë¦¬ì–´ íŒ¨ë¸Œë¦­ìœ¼ë¡œë„ ì¸ê¸°ê°€ ë§ì€ ì†Œì¬ì…ë‹ˆë‹¤.',tags:['ë¦°ë„¨','ë² ì´ì§€','ë‚´ì¶”ëŸ´','ë´„ì—¬ë¦„'],seller:SELLERS_SAMPLE[3],imgs:2,likes:18,chats:7,time:'1ì¼ ì „',liked:false},
  {id:5,title:'ê´‘íƒ ìƒ´í˜ì¸ ì‹¤í¬ ìƒˆí‹´ 15m',type:'ì‹¤í¬',color:'ìƒ´í˜ì¸ê³¨ë“œ',width:114,weight:90,qty:15,price:35000,loc:'ì„œìš¸ ë§ˆí¬êµ¬ ë§ì›ë™',cat:'ì²œì—°ì„¬ìœ ',description:'ì›¨ë”©ë“œë ˆìŠ¤ ì œì‘ í›„ ë‚¨ì€ ê³ ê¸‰ ì‹¤í¬ ìƒˆí‹´ ì›ë‹¨ì…ë‹ˆë‹¤. ê´‘íƒì´ ìš°ìˆ˜í•˜ê³  ë“œë ˆì´í”„ì„±ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.',tags:['ì‹¤í¬ìƒˆí‹´','ìƒ´í˜ì¸','ì›¨ë”©ì›ë‹¨','ê³ ê¸‰','ì´ë¸Œë‹'],seller:SELLERS_SAMPLE[4],imgs:5,likes:31,chats:15,time:'2ì¼ ì „',liked:false},
  {id:6,title:'ëª¨ë‹¬ í˜¼ë°© ì°¨ì½œ ê¸°ëª¨ ì›ë‹¨ 60m',type:'í˜¼ë°©',color:'ì°¨ì½œê·¸ë ˆì´',width:160,weight:280,qty:60,price:5500,loc:'ì¸ì²œ ë‚¨ë™êµ¬ êµ¬ì›”ë™',cat:'í˜¼ë°©',description:'ëª¨ë‹¬ 60% + í´ë¦¬ 40% í˜¼ë°© ê¸°ëª¨ ì›ë‹¨ì…ë‹ˆë‹¤. ë¶€ë“œëŸ¬ìš´ ì´‰ê°ê³¼ ë³´ì˜¨ì„±ì´ ë›°ì–´ë‚˜ ê²¨ìš¸ìš© ë‚´ì˜, íŠ¸ë ˆì´ë‹ë³µì— ì í•©í•©ë‹ˆë‹¤.',tags:['í˜¼ë°©','ê¸°ëª¨','ëª¨ë‹¬','ê²¨ìš¸ì›ë‹¨','ëŒ€ëŸ‰í• ì¸'],seller:SELLERS_SAMPLE[0],imgs:3,likes:9,chats:4,time:'2ì¼ ì „',liked:false},
  {id:7,title:'ë¹ˆí‹°ì§€ ì¸ë””ê³  ë°ë‹˜ ì›ë‹¨ 25m',type:'ë©´',color:'ì¸ë””ê³ ë¸”ë£¨',width:150,weight:340,qty:25,price:8500,loc:'ì„œìš¸ ë™ëŒ€ë¬¸êµ¬ ì‹ ì„¤ë™',cat:'ì²œì—°ì„¬ìœ ',description:'ì…€ë¹„ì§€ ë°ë‹˜ ëŠë‚Œì˜ ì¸ë””ê³  ë¸”ë£¨ ë©´ ì›ë‹¨ì…ë‹ˆë‹¤. ì²­ë°”ì§€, ì¬í‚·, ê°€ë°© ë“± ë°ë‹˜ ì•„ì´í…œ ì œì‘ì— ì í•©í•©ë‹ˆë‹¤.',tags:['ë°ë‹˜','ì¸ë””ê³ ','ë©´ì›ë‹¨','ì²­ë°”ì§€ê°'],seller:SELLERS_SAMPLE[1],imgs:2,likes:22,chats:9,time:'3ì¼ ì „',liked:false},
  {id:8,title:'íŒŒìŠ¤í…” ë¯¼íŠ¸ ê¸°ëŠ¥ì„± í´ë¦¬ ì—ì–´ë¡œ 80m',type:'í´ë¦¬',color:'ë¯¼íŠ¸',width:155,weight:100,qty:80,price:3200,loc:'ê²½ê¸° ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬',cat:'í•©ì„±ì„¬ìœ ',description:'ìŠ¤í¬ì¸ ì›¨ì–´ ë¸Œëœë“œ ìƒì‚° í›„ ë‚¨ì€ ì—ì–´ë¡œ ê¸°ëŠ¥ì„± ì›ë‹¨ì…ë‹ˆë‹¤. í¡ìŠµì†ê±´ ê¸°ëŠ¥ì´ ìˆì–´ ìš´ë™ë³µ, ì•„ì›ƒë„ì–´ ì˜ë¥˜ì— ì í•©í•©ë‹ˆë‹¤.',tags:['í´ë¦¬','ê¸°ëŠ¥ì„±ì›ë‹¨','í¡ìŠµì†ê±´','ìŠ¤í¬ì¸ ','ëŒ€ëŸ‰'],seller:SELLERS_SAMPLE[2],imgs:3,likes:6,chats:2,time:'3ì¼ ì „',liked:false},
  {id:9,title:'ë¡œì¦ˆ ìš¸ í—¤ë§ë³¸ ì›ë‹¨ ì†ŒëŸ‰ 10m',type:'ìš¸',color:'ë¡œì¦ˆí•‘í¬',width:150,weight:290,qty:10,price:22000,loc:'ì„œìš¸ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™',cat:'ì²œì—°ì„¬ìœ ',description:'ì˜êµ­ì‚° ìš¸ í—¤ë§ë³¸ íŒ¨í„´ ì›ë‹¨ì…ë‹ˆë‹¤. í´ë˜ì‹í•œ í—¤ë§ë³¸ íŒ¨í„´ìœ¼ë¡œ ì½”íŠ¸, ë¸”ë ˆì´ì €, ìŠ¤ì»¤íŠ¸ì— í™œìš©í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.',tags:['ìš¸í—¤ë§ë³¸','ë¡œì¦ˆ','ì˜êµ­ì‚°','ì½”íŠ¸ê°','ì†ŒëŸ‰'],seller:SELLERS_SAMPLE[3],imgs:4,likes:27,chats:13,time:'4ì¼ ì „',liked:false},
  {id:10,title:'ë‚´ì¶”ëŸ´ ê·¸ë ˆì´ ë¦°ë„¨ í˜¼ë°© 40m',type:'ë¦°ë„¨',color:'ë¼ì´íŠ¸ê·¸ë ˆì´',width:135,weight:175,qty:40,price:7500,loc:'ë¶€ì‚° ë™ë˜êµ¬ ì˜¨ì²œë™',cat:'í˜¼ë°©',description:'ë¦°ë„¨ 55% + ë©´ 45% í˜¼ë°© ì›ë‹¨ì…ë‹ˆë‹¤. ë¦°ë„¨ì˜ ì‹œì›í•¨ê³¼ ë©´ì˜ ë¶€ë“œëŸ¬ì›€ì„ í•¨ê»˜ ëŠë‚„ ìˆ˜ ìˆìœ¼ë©° í™ˆì›¨ì–´, ì—¬ë¦„ ì…”ì¸ ì— ì í•©í•©ë‹ˆë‹¤.',tags:['ë¦°ë„¨í˜¼ë°©','ê·¸ë ˆì´','í™ˆì›¨ì–´','ì—¬ë¦„'],seller:SELLERS_SAMPLE[4],imgs:2,likes:14,chats:6,time:'5ì¼ ì „',liked:false},
];
let products=lsGet('products',DEFAULT_PRODUCTS);
function saveProducts(){lsSet('products',products)}
async function loadProductsFromSupabase(){
  if(!_sb)return;
  try{
    const{data,error}=await _sb.from('products').select('*').order('created_at',{ascending:false});
    if(error){console.error('[loadProducts] ì˜¤ë¥˜:',error);return;}
    const likedMap=lsGet('likedMap',{});
    if(!data||data.length===0){
      // Supabase ë¹„ì–´ìˆìœ¼ë©´ ìƒ˜í”Œ ë°ì´í„°ë¥¼ Supabaseì— ìë™ insert
      try{
        const samplePayloads=DEFAULT_PRODUCTS.map(p=>({
          title:p.title,type:p.type,color:p.color,width:p.width,weight:p.weight,
          qty:p.qty,price:p.price,loc:p.loc,cat:p.cat,description:p.description,
          tags:p.tags,seller:p.seller,imgs:p.imgs,likes:p.likes,chats:p.chats,time:p.time
        }));
        console.log('[loadProducts] ìƒ˜í”Œ ë°ì´í„° 10ê°œ Supabase insert ì‹œì‘...');
        const{data:inserted,error:insertErr}=await _sb.from('products').insert(samplePayloads).select();
        if(insertErr){
          console.error('[loadProducts] ìƒ˜í”Œ insert ì˜¤ë¥˜:',insertErr);
          products=DEFAULT_PRODUCTS.map(p=>({...p,liked:!!likedMap[p.id]}));
        }else{
          console.log('[loadProducts] ìƒ˜í”Œ insert ì™„ë£Œ:', inserted?.length,'ê°œ');
          products=(inserted||[]).map(p=>({
            ...p,
            seller:p.seller||{name:'ì•Œìˆ˜ì—†ìŒ',temp:36.5,loc:''},
            tags:Array.isArray(p.tags)?p.tags:(p.tags?p.tags.split(','):[]),
            liked:false,time:p.time||'ë°©ê¸ˆ ì „',likes:p.likes||0,chats:p.chats||0,imgs:p.imgs||1,
          }));
        }
      }catch(insertEx){
        console.error('[loadProducts] ìƒ˜í”Œ insert ì˜ˆì™¸:',insertEx);
        products=DEFAULT_PRODUCTS.map(p=>({...p,liked:!!likedMap[p.id]}));
      }
      lsSet('products',products);
      renderList();
      return;
    }
    products=data.map(p=>({
      ...p,
      seller:p.seller||{name:'ì•Œìˆ˜ì—†ìŒ',temp:36.5,loc:''},
      tags:Array.isArray(p.tags)?p.tags:(p.tags?p.tags.split(','):[]),
      liked:!!likedMap[p.id],
      time:p.time||'ë°©ê¸ˆ ì „',
      likes:p.likes||0,
      chats:p.chats||0,
      imgs:p.imgs||1,
    }));
    lsSet('products',products);
    renderList();
  }catch(e){console.error('[loadProducts] ì˜ˆì™¸:',e);}
}

/* ==================== STATE ==================== */
let curFilter='ì „ì²´';
let curSearch='';
let curProductId=null;
let prevView='list';
let sliderIdx=0;
let sliderTotal=0;
let uploadedImgs=[];
let curResType='visit';
let curSellerData=null;
let selectedUserType='seller';

/* ==================== TOAST ==================== */
function showToast(msg){
  const el=document.getElementById('toast');
  el.textContent=msg;el.classList.add('show');
  clearTimeout(el._t);el._t=setTimeout(()=>el.classList.remove('show'),2200);
}

/* ==================== VIEW ==================== */
function showView(name){
  const prev=document.querySelector('.view.active');
  if(prev)prevView=prev.id.replace('view-','');
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  const target=document.getElementById('view-'+name);
  if(target){target.classList.add('active');window.scrollTo(0,0)}
  if(name==='list')renderList();
  if(name==='mypage')renderMypage();
  if(name==='admin')renderAdmin('overview');
  if(name==='analytics')renderAnalytics();
}
function goBack(){showView(prevView||'list')}

/* ==================== AUTH ==================== */
async function doLogin(){
  const email=document.getElementById('l-email').value.trim();
  const pw=document.getElementById('l-pw').value;
  // ê´€ë¦¬ì ê³„ì • íŠ¹ë³„ ì²˜ë¦¬ (ë¡œì»¬ ê²€ì¦)
  if(email==='admin'){
    const admin=DEFAULT_USERS.find(u=>u.email==='admin'&&u.pw===pw);
    if(!admin){showToast('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”');return;}
    curUser=admin;lsSet('curUser',curUser);showView('admin');return;
  }
  // Supabase ë¯¸ì—°ê²° ì‹œ ë¡œì»¬ fallback
  if(!_sb){
    const user=findUser(email,pw);
    if(!user){showToast('ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”');return;}
    curUser=user;lsSet('curUser',curUser);
    if(user.type==='admin')showView('admin');else showView('list');
    return;
  }
  try{
    const{data,error}=await _sb.auth.signInWithPassword({email,password:pw});
    if(error){showToast('ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”');return;}
    const{data:profile}=await _sb.from('users').select('*').eq('id',data.user.id).single();
    curUser=profile||{id:data.user.id,email,name:email,type:'buyer',temp:36.5,loc:'',joinDate:data.user.created_at?.slice(0,10)||''};
    lsSet('curUser',curUser);
    if(curUser.type==='admin')showView('admin');else{showView('list');loadProductsFromSupabase();}
  }catch(e){showToast('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”');console.error(e);}
}
async function doSignup(){
  const name=document.getElementById('s-name').value.trim();
  const email=document.getElementById('s-email').value.trim();
  const pw=document.getElementById('s-pw').value;
  const loc=document.getElementById('s-loc').value.trim();
  if(!name||!email||!pw){showToast('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');return;}
  if(pw.length<6){showToast('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•´ìš”');return;}
  // Supabase ë¯¸ì—°ê²° ì‹œ ë¡œì»¬ fallback
  if(!_sb){
    if(users.find(u=>u.email===email)){showToast('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì´ì—ìš”');return;}
    const newUser={id:'u'+Date.now(),name,email,pw,type:selectedUserType,loc,temp:36.5,joinDate:new Date().toISOString().slice(0,10)};
    users.push(newUser);lsSet('users',users);
    curUser=newUser;lsSet('curUser',curUser);
    showToast('ê°€ì… ì™„ë£Œ! í™˜ì˜í•´ìš” ğŸ‰');showView('list');return;
  }
  try{
    const{data,error}=await _sb.auth.signUp({email,password:pw});
    if(error){showToast(error.message||'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆì–´ìš”');return;}
    const newProfile={id:data.user.id,name,email,type:selectedUserType,loc,temp:36.5,join_date:new Date().toISOString().slice(0,10)};
    await _sb.from('users').insert(newProfile);
    curUser={...newProfile,joinDate:newProfile.join_date};
    lsSet('curUser',curUser);
    showToast('ê°€ì… ì™„ë£Œ! í™˜ì˜í•´ìš” ğŸ‰');showView('list');loadProductsFromSupabase();
  }catch(e){showToast('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”');console.error(e);}
}
async function doLogout(){
  try{if(_sb&&curUser?.email!=='admin')await _sb.auth.signOut();}catch(e){}
  curUser=null;lsSet('curUser',null);showView('login');
}
function selectType(type,el){
  selectedUserType=type;
  document.querySelectorAll('.type-card').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel');
}

/* ==================== FILTER CHIPS ==================== */
const FILTERS=['ì „ì²´','ë©´','í´ë¦¬','ìš¸','ë¦°ë„¨','ì‹¤í¬','í˜¼ë°©','ê¸°íƒ€'];
function renderChips(){
  const el=document.getElementById('filter-chips');
  el.innerHTML=FILTERS.map(f=>`<button class="chip ${f===curFilter?'on':''}" onclick="setFilter('${f}')">${f}</button>`).join('');
}
function setFilter(f){curFilter=f;renderChips();renderList()}

/* ==================== PRODUCT LIST ==================== */
function renderList(){
  renderChips();
  const list=document.getElementById('product-list');
  const empty=document.getElementById('empty-state');
  const q=curSearch.trim().toLowerCase();
  const filtered=products.filter(p=>{
    const mf=curFilter==='ì „ì²´'||p.type===curFilter;
    const ms=!q||p.title.toLowerCase().includes(q)||p.type.includes(q)||p.color.toLowerCase().includes(q)||(p.tags||[]).some(tg=>tg.toLowerCase().includes(q))||(p.seller&&p.seller.name.toLowerCase().includes(q));
    return mf&&ms;
  });
  if(!filtered.length){
    list.innerHTML='';list.style.display='none';
    empty.style.display='flex';
    document.getElementById('empty-msg').textContent=t('empty_msg');
  }else{
    empty.style.display='none';list.style.display='grid';
    list.innerHTML=filtered.map(renderCard).join('');
  }
}
function renderCard(p){
  const bg=getFColor(p.type,p.color);
  const tex=getTexture(p.type);
  const total=p.qty*p.price;
  const isNew=p.id>10;
  return `<li class="pcard" onclick="openDetail(${p.id})">
    ${isNew?'<div class="badge-new">NEW</div>':''}
    <div class="pthumb" style="background:${bg};background-image:${tex}">
      <span class="fabric-badge">${p.type}</span>
    </div>
    <button class="card-heart" onclick="event.stopPropagation();toggleLike(${p.id})">${p.liked?'â¤ï¸':'ğŸ¤'}</button>
    <div class="pinfo">
      <div class="pname">${p.title}</div>
      <div class="pmeta">${p.color} Â· ${p.width}cm Â· ${p.qty}m</div>
      <div class="pprice">${fmtPrice(total)}<span class="pu"> (${fmtPrice(p.price)}/m)</span></div>
      <div class="pfoot">
        <span class="ploc">ğŸ“${p.loc.split(' ').slice(-1)[0]}</span>
        <span class="pcnt"><span>ğŸ¤${p.likes}</span><span>ğŸ’¬${p.chats}</span></span>
      </div>
    </div>
  </li>`;
}

/* ==================== LIKE ==================== */
function toggleLike(id){
  const p=products.find(x=>x.id===id);if(!p)return;
  p.liked=!p.liked;p.likes+=p.liked?1:-1;saveProducts();
  const likedMap=lsGet('likedMap',{});likedMap[id]=p.liked;lsSet('likedMap',likedMap);
  _sb.from('products').update({likes:p.likes}).eq('id',id).then();
  renderList();
  showToast(p.liked?'ê´€ì‹¬ ëª©ë¡ì— ì¶”ê°€ëì–´ìš” â¤ï¸':'ê´€ì‹¬ ëª©ë¡ì—ì„œ ì œê±°ëì–´ìš”');
}

/* ==================== DETAIL ==================== */
function openDetail(id){
  prevView='list';
  curProductId=id;sliderIdx=0;
  const p=products.find(x=>x.id===id);if(!p)return;
  document.getElementById('d-hdr-title').textContent=p.title;
  document.getElementById('d-scroll').scrollTop=0;
  // slider
  sliderTotal=p.imgs||1;
  const bg=getFColor(p.type,p.color);const tex=getTexture(p.type);
  const track=document.getElementById('s-track');
  const dots=document.getElementById('s-dots');
  const vs=['','filter:brightness(1.1)','filter:brightness(.9)','filter:saturate(1.3)','filter:hue-rotate(15deg)'];
  track.innerHTML=Array.from({length:sliderTotal},(_,i)=>`<div class="s-slide" style="background:${bg};background-image:${tex};${vs[i]||''};flex-shrink:0;width:${100/sliderTotal}%"><div style="font-size:36px">ğŸ§µ</div><div style="font-size:13px;font-weight:600;background:rgba(0,0,0,.25);padding:5px 14px;border-radius:20px;color:rgba(255,255,255,.95)">${p.color} ${p.type}</div><div style="font-size:11px;margin-top:4px;opacity:.8">${i+1}/${sliderTotal}</div></div>`).join('');
  track.style.width=(sliderTotal*100)+'%';
  dots.innerHTML=Array.from({length:sliderTotal},(_,i)=>`<div class="s-dot ${i===0?'on':''}"></div>`).join('');
  document.getElementById('s-prev').style.display=sliderTotal>1?'flex':'none';
  document.getElementById('s-next').style.display=sliderTotal>1?'flex':'none';
  updateSlider();
  // seller
  const av=document.getElementById('d-av');
  av.textContent=p.seller.name[0];av.style.background=bg;
  document.getElementById('d-sname').textContent=p.seller.name;
  document.getElementById('d-sloc').textContent='ğŸ“ '+p.loc;
  document.getElementById('d-temp').textContent=p.seller.temp.toFixed(1)+'Â°C';
  // fabric table
  document.getElementById('d-ftbl').innerHTML=[
    ['ì›ë‹¨ ì¢…ë¥˜',p.type],['ìƒ‰ìƒ',p.color],['í­',p.width+'cm'],
    ['ì¤‘ëŸ‰',p.weight?(p.weight+'g/ã¡'):'ì •ë³´ ì—†ìŒ'],
    ['ìˆ˜ëŸ‰',p.qty+'m'],['ë‹¨ê°€',fmtPrice(p.price)+'/m'],
  ].map(([k,v])=>`<tr><td>${k}</td><td>${v}</td></tr>`).join('');
  document.getElementById('d-desc').textContent=p.description;
  document.getElementById('d-tags').innerHTML=(p.tags||[]).map(tg=>`<span class="tagc">#${tg}</span>`).join('');
  document.getElementById('d-stats').innerHTML=`ê´€ì‹¬ ${p.likes}ëª… &nbsp;Â·&nbsp; ì±„íŒ… ${p.chats}ëª… &nbsp;Â·&nbsp; ${p.time}`;
  // action bar
  document.getElementById('d-tp').textContent=fmtPrice(p.qty*p.price);
  document.getElementById('d-pp').textContent=fmtPrice(p.price)+'/m Â· '+p.qty+'m';
  updateDetailHeart(p);
  // res date default
  document.getElementById('res-date').valueAsDate=new Date();
  curSellerData=p.seller;
  showView('detail');
}
function updateDetailHeart(p){
  const btn=document.getElementById('d-heart');
  const icon=document.getElementById('d-hicon');
  btn.className='heart-btn'+(p.liked?' on':'');
  icon.textContent=p.liked?'â¤ï¸':'ğŸ¤';
  document.getElementById('d-lcnt').textContent=p.likes;
}
function toggleDetailLike(){
  const p=products.find(x=>x.id===curProductId);if(!p)return;
  p.liked=!p.liked;p.likes+=p.liked?1:-1;saveProducts();
  const likedMap=lsGet('likedMap',{});likedMap[p.id]=p.liked;lsSet('likedMap',likedMap);
  _sb.from('products').update({likes:p.likes}).eq('id',p.id).then();
  updateDetailHeart(p);
  showToast(p.liked?'ê´€ì‹¬ ëª©ë¡ì— ì¶”ê°€ëì–´ìš” â¤ï¸':'ê´€ì‹¬ ëª©ë¡ì—ì„œ ì œê±°ëì–´ìš”');
}
function shareProduct(){openModal('modal-share')}
function openSellerPage(){
  const p=products.find(x=>x.id===curProductId);if(!p)return;
  renderSellerPage(p.seller);
}

/* ==================== SLIDER ==================== */
function slideMove(d){sliderIdx=Math.max(0,Math.min(sliderTotal-1,sliderIdx+d));updateSlider()}
function updateSlider(){
  const track=document.getElementById('s-track');
  track.style.transform=`translateX(-${(sliderIdx/sliderTotal)*100}%)`;
  document.querySelectorAll('.s-dot').forEach((d,i)=>d.classList.toggle('on',i===sliderIdx));
}
const slider=document.getElementById('d-slider');
let tX=0;
slider.addEventListener('touchstart',e=>{tX=e.touches[0].clientX},{passive:true});
slider.addEventListener('touchend',e=>{if(Math.abs(e.changedTouches[0].clientX-tX)>40)slideMove(e.changedTouches[0].clientX<tX?1:-1)});

/* ==================== MODALS ==================== */
function openModal(id){document.getElementById(id).classList.add('open')}
function closeModal(id,e){if(!e||e.target===document.getElementById(id)||!e)document.getElementById(id).classList.remove('open')}
function openChatModal(){openModal('modal-chat')}
function openSuggestModal(){openModal('modal-suggest')}
function openResModal(){openModal('modal-res')}
function submitSuggest(){
  const price=document.getElementById('suggest-price').value;
  if(!price){showToast('ì œì•ˆ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');return}
  closeModal('modal-suggest');showToast('ê°€ê²© ì œì•ˆì´ ì „ì†¡ëì–´ìš”! ğŸ’°');
}
function selectRes(type,el){
  curResType=type;
  document.querySelectorAll('.res-card').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel');
  const titles={visit:'ë°©ë¬¸ ì˜ˆì•½',swatch:'ìŠ¤ì™€ì¹˜ ìš”ì²­',inspect:'ì¶œì¥ê°ë³„ ì˜ˆì•½'};
  document.getElementById('res-modal-title').textContent=titles[type]||'ì˜ˆì•½';
}
async function submitReservation(){
  const date=document.getElementById('res-date').value;
  const time=document.getElementById('res-time').value;
  const note=document.getElementById('res-note').value.trim();
  if(curUser&&curProductId){
    const{error}=await _sb.from('reservations').insert({
      product_id:curProductId,
      user_id:curUser.id,
      type:curResType,
      date,time,note,
    });
    if(error)console.error('reservation error:',error);
  }
  closeModal('modal-res');showToast(`${date} ${time} ì˜ˆì•½ì´ ì‹ ì²­ëì–´ìš”! ğŸ“…`);
}

/* ==================== SELLER PAGE ==================== */
function renderSellerPage(seller){
  prevView='detail';
  const bg=getFColor(seller.name,'abc');
  document.getElementById('sh-hero').style.background=`linear-gradient(135deg,${bg},#ff9a6c)`;
  const av=document.getElementById('sh-av');av.textContent=seller.name[0];
  document.getElementById('sh-name').textContent=seller.name;
  document.getElementById('sh-loc').textContent='ğŸ“ '+(seller.loc||'ì„œìš¸');
  const userInfo=users.find(u=>u.id===seller.id||u.name===seller.name)||{};
  document.getElementById('sh-intro').textContent=userInfo.intro||'ì¬ê³ ì›ë‹¨ ì „ë¬¸ ì—…ì²´ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ì†Œì¬ì˜ ì›ë‹¨ì„ í•©ë¦¬ì ì¸ ê°€ê²©ì— ê³µê¸‰í•©ë‹ˆë‹¤.';
  const myProds=products.filter(p=>p.seller.name===seller.name);
  const sl=document.getElementById('sh-stats');
  sl.innerHTML=`
    <div class="sstat"><div class="sv">${myProds.length}</div><div class="sl">ìƒí’ˆ</div></div>
    <div class="sstat"><div class="sv">${seller.temp.toFixed(1)}Â°C</div><div class="sl">ë§¤ë„ˆì˜¨ë„</div></div>
    <div class="sstat"><div class="sv">${myProds.reduce((a,p)=>a+p.likes,0)}</div><div class="sl">ê´€ì‹¬</div></div>
  `;
  document.getElementById('sh-products').innerHTML=myProds.map(renderCard).join('');
  showView('seller');
}

/* ==================== FORM ==================== */
document.getElementById('file-input').addEventListener('change',e=>{
  const files=Array.from(e.target.files);
  const rem=5-uploadedImgs.length;
  files.slice(0,rem).forEach(f=>{
    const r=new FileReader();
    r.onload=ev=>{uploadedImgs.push(ev.target.result);renderImgPreviews()};
    r.readAsDataURL(f);
  });
  if(files.length>rem)showToast('ìµœëŒ€ 5ì¥ê¹Œì§€ ì²¨ë¶€ ê°€ëŠ¥í•´ìš”');
  e.target.value='';
});
function renderImgPreviews(){
  const scroll=document.getElementById('img-scroll');
  const add=scroll.querySelector('.img-add');
  scroll.querySelectorAll('.img-prev').forEach(e=>e.remove());
  uploadedImgs.forEach((src,i)=>{
    const d=document.createElement('div');d.className='img-prev';
    d.innerHTML=`<img src="${src}" alt="preview"/><button class="img-rm" onclick="removeImg(${i})">âœ•</button>`;
    scroll.insertBefore(d,add);
  });
  add.style.display=uploadedImgs.length>=5?'none':'flex';
}
function removeImg(i){uploadedImgs.splice(i,1);renderImgPreviews()}
function calcTotal(){
  const qty=parseFloat(document.getElementById('f-qty').value)||0;
  const price=parseFloat(document.getElementById('f-price').value)||0;
  const el=document.getElementById('f-total');
  el.textContent=qty&&price?`ì´ ${fmtPrice(qty*price)} (${fmtPrice(price)}/m Ã— ${qty}m)`:'ìˆ˜ëŸ‰ê³¼ ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ë©´ ìë™ ê³„ì‚°ë¼ìš”';
  // AI price hint
  const hint=document.getElementById('ai-price-hint');
  const type=document.getElementById('f-type').value;
  if(type&&price){
    const ranges={ë©´:[3000,8000],í´ë¦¬:[2000,6000],ìš¸:[12000,35000],ë¦°ë„¨:[5000,12000],ì‹¤í¬:[20000,80000],í˜¼ë°©:[4000,10000],ê¸°íƒ€:[2000,15000]};
    const [lo,hi]=ranges[type]||[2000,20000];
    const avg=Math.round((lo+hi)/2);
    const diff=price-avg;
    const msg=diff<-avg*.2?'âœ… AI ì˜ˆì¸¡: ì‹œì„¸ë³´ë‹¤ ì €ë ´í•´ìš”! ë¹ ë¥¸ ê±°ë˜ ì˜ˆìƒ':diff>avg*.2?'âš ï¸ AI ì˜ˆì¸¡: ì‹œì„¸ë³´ë‹¤ ë†’ì„ ìˆ˜ ìˆì–´ìš”. ì¡°ì •ì„ ê³ ë ¤í•´ë³´ì„¸ìš”':'ğŸ“Š AI ì˜ˆì¸¡: ì ì • ì‹œì„¸ ë²”ìœ„ì˜ˆìš”! ('+type+' í‰ê·  '+fmtPrice(avg)+'/m)';
    hint.textContent=msg;
  }
}
function updateCat2(){/* 3-tier category hook */}
async function submitForm(){
  const title=document.getElementById('f-title').value.trim();
  const type=document.getElementById('f-type').value;
  const color=document.getElementById('f-color').value.trim();
  const qty=parseFloat(document.getElementById('f-qty').value);
  const price=parseFloat(document.getElementById('f-price').value);
  const loc=document.getElementById('f-loc').value.trim();
  if(!title){showToast('ìƒí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');return;}
  if(!type){showToast('ì›ë‹¨ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');return;}
  if(!color){showToast('ìƒ‰ìƒì„ ì…ë ¥í•´ì£¼ì„¸ìš”');return;}
  if(!qty||qty<=0){showToast('ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');return;}
  if(!price||price<=0){showToast('ë‹¨ê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');return;}
  if(!loc){showToast('ê±°ë˜ ì§€ì—­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');return;}
  const rawTags=document.getElementById('f-tags').value.trim();
  const tags=rawTags?rawTags.split(',').map(tg=>tg.trim().replace(/^#/,'')).filter(Boolean):[];
  const width=parseInt(document.getElementById('f-width').value)||0;
  const weight=parseInt(document.getElementById('f-weight').value)||0;
  const description=document.getElementById('f-desc').value.trim()||'ìƒí’ˆ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.';
  const sellerInfo=curUser?{id:curUser.id,name:curUser.name,temp:curUser.temp||36.5,loc:curUser.loc||loc}:{name:'ë‚˜',temp:36.5,loc};
  const payload={title,type,color,width,weight,qty,price,loc,cat:document.getElementById('f-cat1').value||'ê¸°íƒ€',description,tags,seller:sellerInfo,imgs:Math.max(1,uploadedImgs.length),likes:0,chats:0,time:'ë°©ê¸ˆ ì „'};
  // í¼ ì´ˆê¸°í™” í—¬í¼
  function resetForm(){
    ['f-title','f-color','f-width','f-weight','f-qty','f-price','f-loc','f-desc','f-tags'].forEach(id=>{document.getElementById(id).value=''});
    document.getElementById('f-type').value='';document.getElementById('f-cat1').value='';
    document.getElementById('f-total').textContent='ìˆ˜ëŸ‰ê³¼ ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ë©´ ìë™ ê³„ì‚°ë¼ìš”';
    document.getElementById('ai-price-hint').textContent='ì›ë‹¨ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ AIê°€ ì ì • ê°€ê²©ì„ ì˜ˆì¸¡í•´ë“œë ¤ìš” ğŸ“Š';
    uploadedImgs=[];renderImgPreviews();
  }
  // Supabaseì— ìƒí’ˆ ì €ì¥
  if(!_sb){
    // Supabase ë¯¸ì—°ê²° â€” localStorageì—ë§Œ ì„ì‹œ ì €ì¥
    console.warn('[submitForm] Supabase ë¯¸ì—°ê²° â€” localStorageì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.');
    const newP={...payload,id:Date.now(),liked:false};
    products.unshift(newP);saveProducts();
    resetForm();showView('list');showToast(t('registered'));
    return;
  }
  try{
    console.log('[submitForm] insert ì‹œë„ payload:', JSON.stringify(payload));
    const{data:inserted,error}=await _sb.from('products').insert(payload).select().single();
    if(error){
      console.error('[submitForm] insert ì˜¤ë¥˜ â€” code:',error.code,'message:',error.message,'details:',error.details,'hint:',error.hint);
      showToast('ì €ì¥ ì‹¤íŒ¨: '+error.message);
      return; // insert ì‹¤íŒ¨ ì‹œ ëª©ë¡ì— ì¶”ê°€í•˜ì§€ ì•ŠìŒ
    }
    console.log('[submitForm] insert ì„±ê³µ â€” id:',inserted.id);
    resetForm();
    showView('list');
    showToast(t('registered'));
    await loadProductsFromSupabase(); // Supabase ìµœì‹  ëª©ë¡ìœ¼ë¡œ ê°±ì‹ 
  }catch(e){
    console.error('[submitForm] insert ì˜ˆì™¸:', e);
    showToast('ìƒí’ˆ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”');
  }
}
document.getElementById('search-input').addEventListener('input',e=>{curSearch=e.target.value;renderList()});
document.getElementById('btn-loc').addEventListener('click',()=>showToast('ì§€ì—­ ì„¤ì • ê¸°ëŠ¥ ì¤€ë¹„ì¤‘ì´ì—ìš”'));
document.getElementById('btn-alert').addEventListener('click',()=>showToast('ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ì–´ìš”'));

/* ==================== MYPAGE ==================== */
function renderMypage(){
  const u=curUser||{name:'ê²ŒìŠ¤íŠ¸',type:'guest',temp:36.5};
  const av=document.getElementById('mp-av');av.textContent=u.name[0];
  document.getElementById('mp-name').textContent=u.name;
  const types={seller:'íŒë§¤ì',buyer:'êµ¬ë§¤ì',brand:'ë¸Œëœë“œ',both:'ê²¸ì—…',admin:'ê´€ë¦¬ì',guest:'ê²ŒìŠ¤íŠ¸'};
  document.getElementById('mp-type').textContent=(types[u.type]||'íšŒì›')+' Â· '+(u.loc||'ìœ„ì¹˜ ë¯¸ì„¤ì •');
  document.getElementById('mp-temp').textContent='ë§¤ë„ˆì˜¨ë„ '+u.temp.toFixed(1)+'Â°C ğŸŒ¡ï¸';
  const isSeller=u.type==='seller'||u.type==='both'||u.type==='brand';
  const menus=[
    {section:'ë‚´ ê±°ë˜'},
    {icon:'â¤ï¸',label:'ê´€ì‹¬ ëª©ë¡',action:'showToast("ê´€ì‹¬ ëª©ë¡ ì¤€ë¹„ì¤‘ì´ì—ìš”")'},
    {icon:'ğŸ’¬',label:'ì±„íŒ… ëª©ë¡',action:'showToast("ì±„íŒ… ê¸°ëŠ¥ ì¤€ë¹„ì¤‘ì´ì—ìš”")'},
    {icon:'ğŸ“…',label:'ì˜ˆì•½ ë‚´ì—­',action:'showToast("ì˜ˆì•½ ë‚´ì—­ ì¤€ë¹„ì¤‘ì´ì—ìš”")'},
    ...(isSeller?[
      {section:'íŒë§¤ì ë©”ë‰´'},
      {icon:'ğŸ“¦',label:'ë‚´ ìƒí’ˆ ê´€ë¦¬',action:'showMySales()'},
      {icon:'ğŸ“Š',label:'ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ',action:"showView('analytics')"},
      {icon:'ğŸ ',label:'ë‚´ ë¯¸ë‹ˆí™ˆí”¼',action:'openMySellerPage()'},
    ]:[]),
    {section:'ì„¤ì •'},
    {icon:'ğŸŒ',label:'ì–¸ì–´ ì„¤ì •',action:'showView("list");setTimeout(()=>toggleLangPanel(),200)'},
    {icon:'ğŸ””',label:'ì•Œë¦¼ ì„¤ì •',action:'showToast("ì•Œë¦¼ ì„¤ì • ì¤€ë¹„ì¤‘ì´ì—ìš”")'},
    {icon:'ğŸ‘¤',label:'í”„ë¡œí•„ ìˆ˜ì •',action:'showToast("í”„ë¡œí•„ ìˆ˜ì • ì¤€ë¹„ì¤‘ì´ì—ìš”")'},
    {icon:'ğŸšª',label:'ë¡œê·¸ì•„ì›ƒ',action:'doLogout()'},
  ];
  document.getElementById('menu-list').innerHTML=menus.map(m=>{
    if(m.section)return`<div class="menu-section">${m.section}</div>`;
    return`<div class="menu-item" onclick="${m.action}"><span class="menu-icon">${m.icon}</span><span class="menu-label">${m.label}</span><span class="menu-arrow">â€º</span></div>`;
  }).join('');
}
function showMySales(){
  const u=curUser;if(!u){showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•´ìš”');return}
  const myP=products.filter(p=>p.seller&&(p.seller.id===u.id||p.seller.name===u.name));
  showToast('ë‚´ ìƒí’ˆ '+myP.length+'ê°œ');
}
function openMySellerPage(){
  if(!curUser){showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•´ìš”');return}
  renderSellerPage({id:curUser.id,name:curUser.name,temp:curUser.temp,loc:curUser.loc});
}

/* ==================== ADMIN ==================== */
let curAdminTab='overview';
function renderAdmin(tab){
  curAdminTab=tab;
  const content=document.getElementById('admin-content');
  if(tab==='overview'){
    content.innerHTML=`
      <div class="stat-grid">
        <div class="stat-card"><div class="sv">${users.length}</div><div class="sl">ì´ íšŒì›</div></div>
        <div class="stat-card"><div class="sv">${products.length}</div><div class="sl">ì´ ìƒí’ˆ</div></div>
        <div class="stat-card"><div class="sv">${products.reduce((a,p)=>a+p.likes,0)}</div><div class="sl">ì´ ê´€ì‹¬</div></div>
        <div class="stat-card"><div class="sv">${products.reduce((a,p)=>a+p.chats,0)}</div><div class="sl">ì´ ì±„íŒ…</div></div>
      </div>
      <div style="background:var(--g100);border-radius:var(--r);padding:14px;font-size:13px;line-height:1.8;color:var(--g700)">
        <b>ğŸ“Œ ìµœê·¼ í™œë™</b><br>
        Â· ì‹ ê·œ ìƒí’ˆ ${products.filter(p=>p.id>10).length}ê±´ ë“±ë¡ë¨<br>
        Â· ì‹ ê·œ íšŒì› ${users.length-3}ëª… ê°€ì…<br>
        Â· ì˜¤ëŠ˜ ì ‘ì†ì: 127ëª…<br>
        Â· ì´ë²ˆ ì£¼ ê±°ë˜ì•¡: â‚©18,450,000
      </div>`;
  }else if(tab==='users'){
    content.innerHTML=`<div class="table-wrap"><table class="data-table"><thead><tr><th>ì´ë¦„</th><th>ìœ í˜•</th><th>ì´ë©”ì¼</th><th>ê°€ì…ì¼</th><th>ê´€ë¦¬</th></tr></thead><tbody>`+
    users.map(u=>`<tr><td><b>${u.name}</b></td><td><span class="badge badge-${u.type==='admin'?'orange':u.type==='seller'?'green':'blue'}">${u.type}</span></td><td style="font-size:11px">${u.email}</td><td style="font-size:11px">${u.joinDate||'-'}</td><td><button class="action-btn" onclick="showToast('${u.name} ì •ë³´ ìˆ˜ì • ì¤€ë¹„ì¤‘')">ìˆ˜ì •</button></td></tr>`).join('')+
    '</tbody></table></div>';
  }else if(tab==='products'){
    content.innerHTML=`<div class="table-wrap"><table class="data-table"><thead><tr><th>ìƒí’ˆëª…</th><th>ì¢…ë¥˜</th><th>ìˆ˜ëŸ‰</th><th>ë‹¨ê°€</th><th>ê´€ë¦¬</th></tr></thead><tbody>`+
    products.slice(0,20).map(p=>`<tr><td style="font-size:11px;max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.title}</td><td><span class="badge badge-blue">${p.type}</span></td><td>${p.qty}m</td><td>${fmtPrice(p.price)}</td><td><button class="action-btn del" onclick="adminDeleteProduct(${p.id})">ì‚­ì œ</button></td></tr>`).join('')+
    '</tbody></table></div>';
  }else if(tab==='notices'){
    content.innerHTML=`<div style="margin-bottom:12px"><button class="btn-primary" style="padding:10px 18px;font-size:13px" onclick="showToast('ê³µì§€ ì‘ì„± ê¸°ëŠ¥ ì¤€ë¹„ì¤‘ì´ì—ìš”')">+ ê³µì§€ ì‘ì„±</button></div>
    <div style="display:flex;flex-direction:column;gap:10px">
      ${['[ê³µì§€] ë¹„ì›€ë§ˆì¼“ v18.3 ì—…ë°ì´íŠ¸ ì•ˆë‚´','[ê³µì§€] ì—¬ë¦„ ì›ë‹¨ íŠ¹ê°€ ê¸°íšì „ ì§„í–‰ ì¤‘','[ì•ˆë‚´] ë§¤ë„ˆ ì˜¨ë„ ì‹œìŠ¤í…œ ê°œí¸ ì•ˆë‚´'].map((title,i)=>`<div style="border:1px solid var(--g200);border-radius:var(--rs);padding:12px 14px;cursor:pointer" onclick="showToast('ê³µì§€ ìƒì„¸ ì¤€ë¹„ì¤‘')"><div style="font-size:13px;font-weight:600;margin-bottom:4px">${title}</div><div style="font-size:11px;color:var(--g500)">${['2024.12.01','2024.11.25','2024.11.20'][i]}</div></div>`).join('')}
    </div>`;
  }
}
function switchAdminTab(tab,el){
  document.querySelectorAll('.atab').forEach(t=>t.classList.remove('on'));
  el.classList.add('on');renderAdmin(tab);
}
async function adminDeleteProduct(id){
  if(!confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?'))return;
  const{error}=await _sb.from('products').delete().eq('id',id);
  if(error)console.error('delete error:',error);
  products=products.filter(p=>p.id!==id);saveProducts();renderAdmin('products');showToast('ì‚­ì œëì–´ìš”');
}

/* ==================== ANALYTICS ==================== */
function renderAnalytics(){
  const months=['8ì›”','9ì›”','10ì›”','11ì›”','12ì›”','1ì›”'];
  const vals=[1.2,1.8,2.1,1.6,2.4,2.8];
  const max=Math.max(...vals);
  const chart=document.getElementById('bar-chart');
  chart.innerHTML=vals.map((v,i)=>`<div class="bar-item"><div class="bar-val">â‚©${v}M</div><div class="bar" style="height:${(v/max)*68}px;${i===vals.length-1?'background:var(--P)':''}"></div><div class="bar-lbl">${months[i]}</div></div>`).join('');
  document.getElementById('top-fabrics').innerHTML=[
    {name:'ë©´ ì›ë‹¨',pct:38,color:'#E8D5C4'},
    {name:'í´ë¦¬ ì›ë‹¨',pct:29,color:'#4A90D9'},
    {name:'í˜¼ë°© ì›ë‹¨',pct:18,color:'#7B8FA3'},
  ].map(f=>`<div style="margin-bottom:10px"><div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:4px"><span>${f.name}</span><span style="font-weight:700">${f.pct}%</span></div><div style="height:8px;background:var(--g200);border-radius:4px"><div style="height:100%;width:${f.pct}%;background:${f.color};border-radius:4px"></div></div></div>`).join('');
  document.getElementById('market-price').innerHTML=[
    {type:'ë©´ (40ìˆ˜)',price:'4,200~6,800',trend:'â†‘'},
    {type:'í´ë¦¬ (ì‰¬í°)',price:'2,500~4,500',trend:'â†’'},
    {type:'ìš¸ (ë©”ë¦¬ë…¸)',price:'15,000~28,000',trend:'â†“'},
    {type:'ë¦°ë„¨',price:'5,500~9,500',trend:'â†‘'},
  ].map(f=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid var(--g100);font-size:13px"><span>${f.type}</span><span style="font-weight:600">${f.price}ì›/m <span style="color:${f.trend==='â†‘'?'#e53935':f.trend==='â†“'?'#1565c0':'var(--g500)'}">${f.trend}</span></span></div>`).join('');
}

/* ==================== INIT ==================== */
(async function init(){
  // Supabase ì„¸ì…˜ í™•ì¸ (ìƒˆë¡œê³ ì¹¨ í›„ ìë™ ë¡œê·¸ì¸ ìœ ì§€)
  if(_sb){
    try{
      const{data:{session}}=await _sb.auth.getSession();
      if(session){
        const{data:profile}=await _sb.from('users').select('*').eq('id',session.user.id).single();
        if(profile){curUser={...profile};lsSet('curUser',curUser);}
      }
    }catch(e){console.error('ì„¸ì…˜ ë³µì› ì˜¤ë¥˜:',e);}
  }
  if(curUser){
    if(curUser.type==='admin')showView('admin');
    else{showView('list');loadProductsFromSupabase();}
  }else{
    showView('login');
  }
  renderChips();
})();
</script>
</body>
</html>
