<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ÎπÑÏõÄÎßàÏºì BIUM MARKET ‚Äî Ïû¨Í≥†ÏõêÎã® B2B ÌîåÎû´Ìèº</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@latest/dist/web/static/pretendard.css"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:16px}
body{font-family:'Pretendard','Noto Sans KR',sans-serif;background:#0a0a0f;color:#ffffff;min-height:100vh;display:flex;justify-content:center}
button{cursor:pointer;border:none;background:none;font-family:inherit}
input,select,textarea{font-family:inherit}
ul{list-style:none}
:root{
  --P:#6c63ff;--PL:rgba(108,99,255,0.12);--PD:#5a52e0;
  --pink:#ff6584;
  --bg:#0a0a0f;--card:#12121a;--border:#1e1e2e;
  --purple:#6c63ff;--text:#ffffff;--sub:#8888aa;
  --g50:#0d0d14;--g100:#12121a;--g200:#1e1e2e;--g300:#2a2a3e;
  --g500:#8888aa;--g700:#aaaacc;--g900:#ffffff;
  --r:16px;--rs:12px;
}
#app{width:100%;max-width:430px;background:#0a0a0f;min-height:100vh;position:relative;overflow-x:hidden;box-shadow:0 0 40px rgba(0,0,0,.6)}

/* VIEWS */
.view{display:none;flex-direction:column;min-height:100vh}
.view.active{display:flex;animation:viewIn .2s ease-out}
#view-splash.active,#view-login.active{animation:none}
@keyframes viewIn{from{opacity:0;transform:translateX(10px)}to{opacity:1;transform:translateX(0)}}
@keyframes cardIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}

/* SPLASH */
#view-splash{background:#0a0a0f;align-items:center;justify-content:center;flex-direction:column;gap:12px}
.splash-logo{font-size:34px;font-weight:900;background:linear-gradient(135deg,#6c63ff,#ff6584);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-0.5px}
.splash-sub{font-size:13px;color:#8888aa}
.splash-progress{width:200px;height:3px;background:#1e1e2e;border-radius:4px;overflow:hidden;margin-top:32px}
.splash-bar{height:100%;background:linear-gradient(90deg,#6c63ff,#ff6584);border-radius:4px;animation:splash-load 2s ease-in-out forwards}
@keyframes splash-load{from{width:0}to{width:100%}}

/* HEADER */
.hdr{position:sticky;top:0;z-index:100;background:#12121a;border-bottom:1px solid #1e1e2e;padding:0 14px;height:56px;display:flex;align-items:center;gap:8px}
.hdr-logo{font-size:18px;font-weight:900;background:linear-gradient(135deg,#6c63ff,#ff6584);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;flex:1;text-align:center}
.hdr-logo small{font-size:10px;font-weight:400;color:#8888aa;margin-left:4px}
.hdr-btn{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;color:#aaaacc;transition:background .15s}
.hdr-btn:hover{background:#1e1e2e}
.hdr-back{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;color:#ffffff}
.hdr-title{font-size:16px;font-weight:700;flex:1;text-align:center;color:#ffffff}
.hdr-loc{display:flex;align-items:center;gap:3px;font-size:13px;font-weight:600;padding:5px 10px;border-radius:20px;background:#1e1e2e;color:#8888aa}

/* TAB BAR */
.tabbar{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;height:64px;background:#12121a;border-top:1px solid #1e1e2e;display:flex;align-items:center;justify-content:space-around;z-index:200}
.tab{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 12px;color:#8888aa;font-size:10px;font-weight:500}
.tab .ti{font-size:20px;line-height:1}
.tab.on{color:#6c63ff}
.tab-fab{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#6c63ff,#ff6584);color:#fff;font-size:24px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(108,99,255,.4)}

/* HERO */
.hero-card{margin:16px 14px;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 60%,#1a1a2e 100%);border:1px solid #1e1e2e;border-radius:20px;padding:24px 20px;position:relative;overflow:hidden}
.hero-card::before{content:'';position:absolute;top:-40px;right:-40px;width:160px;height:160px;border-radius:50%;background:rgba(108,99,255,.12);pointer-events:none}
.hero-card::after{content:'';position:absolute;bottom:-30px;right:20px;width:100px;height:100px;border-radius:50%;background:rgba(255,101,132,.08);pointer-events:none}
.hero-title{font-size:20px;font-weight:800;color:#ffffff;line-height:1.35;margin-bottom:6px;position:relative;z-index:1}
.hero-sub{font-size:13px;color:#8888aa;margin-bottom:20px;position:relative;z-index:1}
.hero-btns{display:flex;gap:10px;position:relative;z-index:1}
.hero-btn-primary{flex:1;padding:12px 0;background:linear-gradient(135deg,#6c63ff,#ff6584);color:#fff;border-radius:12px;font-size:13px;font-weight:700;cursor:pointer;border:none}
.hero-btn-outline{flex:1;padding:12px 0;background:transparent;color:#6c63ff;border:1.5px solid #6c63ff;border-radius:12px;font-size:13px;font-weight:700;cursor:pointer}
.hero-btn-outline:hover{background:rgba(108,99,255,.12)}

/* SEARCH */
.srch-wrap{padding:10px 14px 6px;background:#12121a;border-bottom:1px solid #1e1e2e}
.srch-bar{display:flex;align-items:center;gap:8px;background:#1e1e2e;border-radius:22px;padding:9px 14px;margin-bottom:8px}
.srch-bar input{flex:1;border:none;background:transparent;font-size:14px;outline:none;color:#ffffff}
.srch-bar input::placeholder{color:#8888aa}
.chips{display:flex;gap:6px;overflow-x:auto;padding-bottom:2px;scrollbar-width:none}
.chips::-webkit-scrollbar{display:none}
.chip{flex-shrink:0;padding:5px 13px;border-radius:20px;font-size:12px;font-weight:500;border:1.5px solid #2a2a3e;color:#8888aa;background:#0a0a0f}
.chip.on{border-color:#6c63ff;color:#6c63ff;background:rgba(108,99,255,.12)}

/* PRODUCT LIST */
.plist{flex:1;padding:10px 10px 80px;display:grid;grid-template-columns:1fr 1fr;gap:10px}
.pcard{border-radius:16px;overflow:hidden;background:#12121a;border:1px solid #1e1e2e;cursor:pointer;transition:transform .15s,box-shadow .15s;position:relative;animation:cardIn .35s ease-out both}
.pcard:hover{transform:translateY(-2px);box-shadow:0 4px 24px rgba(108,99,255,.15)}
.pthumb{width:100%;aspect-ratio:1;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.pthumb::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.08) 0%,transparent 60%)}
.fabric-badge{position:relative;z-index:1;background:rgba(0,0,0,.35);padding:3px 9px;border-radius:20px;font-size:11px;font-weight:600;color:rgba(255,255,255,.9)}
.card-heart{position:absolute;top:7px;right:7px;z-index:2;width:30px;height:30px;border-radius:50%;background:rgba(18,18,26,.85);display:flex;align-items:center;justify-content:center;font-size:14px;box-shadow:0 1px 4px rgba(0,0,0,.3)}
.pinfo{padding:9px 9px 7px}
.pname{font-size:12px;font-weight:600;line-height:1.4;margin-bottom:3px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;color:#ffffff}
.pmeta{font-size:11px;color:#8888aa;margin-bottom:5px}
.pprice{font-size:13px;font-weight:700;color:#6c63ff}
.pprice .pu{font-size:10px;font-weight:400;color:#8888aa}
.pfoot{display:flex;justify-content:space-between;align-items:center;margin-top:5px;padding-top:5px;border-top:1px solid #1e1e2e}
.ploc{font-size:10px;color:#8888aa;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.pcnt{display:flex;gap:5px;font-size:10px;color:#8888aa;flex-shrink:0}
.badge-new{position:absolute;top:7px;left:7px;z-index:2;background:linear-gradient(135deg,#6c63ff,#ff6584);color:#fff;font-size:9px;font-weight:700;padding:2px 6px;border-radius:10px}

/* EMPTY */
.empty{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;color:#8888aa;padding:40px;text-align:center}
.empty .ei{font-size:44px}

/* LOGIN */
#view-login{background:#0a0a0f;align-items:center;justify-content:center;padding:32px 24px}
.login-logo{font-size:32px;font-weight:700;color:#6c63ff;margin-bottom:4px;text-align:center}
.login-sub{font-size:13px;color:#8888aa;text-align:center;margin-bottom:32px;line-height:1.6}
.login-box{width:100%}
.fi{width:100%;border:1.5px solid #2a2a3e;border-radius:12px;padding:12px 14px;font-size:15px;color:#ffffff;outline:none;transition:border-color .15s;background:#12121a}
.fi:focus{border-color:#6c63ff}
.fi::placeholder{color:#8888aa}
.fg{margin-bottom:14px}
.fg label{display:block;font-size:13px;font-weight:600;color:#aaaacc;margin-bottom:6px}
.fg .req{color:#6c63ff}
.btn-primary{width:100%;padding:14px;background:linear-gradient(135deg,#6c63ff,#ff6584);color:#fff;border-radius:12px;font-size:15px;font-weight:700;transition:opacity .15s}
.btn-primary:hover{opacity:.9}
.btn-secondary{width:100%;padding:13px;border:1.5px solid #6c63ff;border-radius:12px;font-size:14px;font-weight:600;color:#6c63ff;background:transparent;transition:all .15s}
.btn-secondary:hover{background:rgba(108,99,255,.12)}
.divider-text{text-align:center;color:#8888aa;font-size:12px;margin:16px 0;position:relative}
.divider-text::before,.divider-text::after{content:'';position:absolute;top:50%;width:40%;height:1px;background:#1e1e2e}
.divider-text::before{left:0}.divider-text::after{right:0}
.type-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px}
.type-card{border:1.5px solid #2a2a3e;border-radius:12px;padding:12px 10px;text-align:center;cursor:pointer;transition:all .15s;background:#12121a}
.type-card:hover{border-color:#6c63ff;background:rgba(108,99,255,.08)}
.type-card.sel{border-color:#6c63ff;background:rgba(108,99,255,.12);color:#6c63ff}
.type-card .tc-icon{font-size:24px;margin-bottom:4px}
.type-card .tc-name{font-size:13px;font-weight:600;color:#ffffff}
.type-card .tc-desc{font-size:10px;color:#8888aa;margin-top:2px}
.type-card.sel .tc-desc{color:#aaaacc}

/* DETAIL */
.d-scroll{flex:1;overflow-y:auto;padding-bottom:88px}
.d-slider{position:relative;width:100%;aspect-ratio:1;overflow:hidden;background:#1e1e2e}
.s-track{display:flex;height:100%;transition:transform .35s cubic-bezier(.4,0,.2,1)}
.s-slide{flex-shrink:0;width:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:8px;color:rgba(255,255,255,.9)}
.s-dots{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:5px}
.s-dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.35);transition:all .2s}
.s-dot.on{background:#fff;transform:scale(1.3)}
.s-nav{position:absolute;top:50%;transform:translateY(-50%);width:34px;height:34px;border-radius:50%;background:rgba(0,0,0,.45);color:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;z-index:2}
.s-prev{left:10px}.s-next{right:10px}

.sel-sec{padding:14px;border-bottom:8px solid #0d0d14;display:flex;align-items:center;gap:12px;background:#12121a}
.sel-av{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:17px;color:#fff;font-weight:700;flex-shrink:0}
.sel-info{flex:1}
.sel-name{font-size:14px;font-weight:700;margin-bottom:1px;color:#ffffff}
.sel-loc{font-size:12px;color:#8888aa}
.temp-box{text-align:right}
.temp-val{font-size:16px;font-weight:700;color:#6c63ff}
.temp-lbl{font-size:10px;color:#8888aa}

.d-sec{padding:14px;border-bottom:8px solid #0d0d14;background:#12121a}
.d-sec h3{font-size:15px;font-weight:700;margin-bottom:10px;color:#ffffff}
.ftbl{width:100%;border-collapse:collapse}
.ftbl tr:not(:last-child) td{border-bottom:1px solid #1e1e2e}
.ftbl td{padding:9px 4px;font-size:13px}
.ftbl td:first-child{color:#8888aa;width:72px;font-weight:500}
.ftbl td:last-child{font-weight:600;color:#ffffff}
.d-desc p{font-size:13px;line-height:1.7;color:#aaaacc}
.tag-row{display:flex;flex-wrap:wrap;gap:7px}
.tagc{padding:4px 11px;border-radius:20px;background:rgba(108,99,255,.12);color:#6c63ff;font-size:12px;font-weight:500}
.d-stats{padding:10px 14px;font-size:11px;color:#8888aa;display:flex;gap:14px;background:#12121a}

.d-action{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;height:76px;background:#12121a;border-top:1px solid #1e1e2e;display:flex;align-items:center;gap:10px;padding:0 14px;z-index:200}
.heart-btn{display:flex;flex-direction:column;align-items:center;gap:2px;font-size:10px;color:#8888aa;padding:6px 8px}
.heart-btn .hicon{font-size:21px}
.heart-btn.on{color:#6c63ff}
.price-area{flex:1}
.price-area .tp{font-size:17px;font-weight:700;color:#ffffff}
.price-area .pp{font-size:11px;color:#8888aa}
.chat-btn{background:linear-gradient(135deg,#6c63ff,#ff6584);color:#fff;border-radius:12px;padding:11px 20px;font-size:14px;font-weight:700}
.suggest-btn{border:1.5px solid #6c63ff;color:#6c63ff;border-radius:12px;padding:11px 14px;font-size:13px;font-weight:600;background:transparent}

/* FORM */
.f-scroll{flex:1;overflow-y:auto;padding:14px 14px 96px;background:#0a0a0f}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.total-disp{padding:11px 14px;background:rgba(108,99,255,.12);border-radius:12px;border:1.5px solid rgba(108,99,255,.2);font-size:14px;font-weight:700;color:#6c63ff}
.img-scroll{display:flex;gap:8px;overflow-x:auto;scrollbar-width:none;padding-bottom:2px}
.img-scroll::-webkit-scrollbar{display:none}
.img-add{flex-shrink:0;width:76px;height:76px;border-radius:12px;border:2px dashed #2a2a3e;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;color:#8888aa;font-size:11px;background:#12121a}
.img-add:hover{border-color:#6c63ff;color:#6c63ff}
.img-prev{flex-shrink:0;width:76px;height:76px;border-radius:12px;overflow:hidden;position:relative}
.img-prev img{width:100%;height:100%;object-fit:cover}
.img-rm{position:absolute;top:3px;right:3px;width:18px;height:18px;border-radius:50%;background:rgba(0,0,0,.6);color:#fff;font-size:11px;display:flex;align-items:center;justify-content:center}
select.fi{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238888aa' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 13px center;padding-right:34px}
textarea.fi{resize:vertical;min-height:90px;line-height:1.6}
.submit-btn{width:100%;padding:15px;background:linear-gradient(135deg,#6c63ff,#ff6584);color:#fff;border-radius:16px;font-size:15px;font-weight:700;margin-top:8px}
.submit-btn:hover{opacity:.9}
.form-divider{height:1px;background:#1e1e2e;margin:16px 0}
.ai-hint{background:rgba(108,99,255,.08);border:1px solid rgba(108,99,255,.2);border-radius:12px;padding:10px 12px;font-size:12px;color:#aaaacc;line-height:1.6;margin-bottom:14px;display:flex;gap:8px;align-items:flex-start}
.ai-hint .ai-icon{font-size:18px;flex-shrink:0}

/* ADMIN */
.admin-tabs{display:flex;border-bottom:1px solid #1e1e2e;background:#12121a;position:sticky;top:56px;z-index:50}
.atab{flex:1;padding:12px 4px;text-align:center;font-size:12px;font-weight:600;color:#8888aa;border-bottom:2px solid transparent;transition:all .15s}
.atab.on{color:#6c63ff;border-bottom-color:#6c63ff}
.admin-content{flex:1;overflow-y:auto;padding:14px 14px 80px;background:#0a0a0f}
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:18px}
.stat-card{background:#12121a;border:1px solid #1e1e2e;border-radius:16px;padding:14px;text-align:center}
.stat-card .sv{font-size:22px;font-weight:700;color:#6c63ff}
.stat-card .sl{font-size:11px;color:#8888aa;margin-top:3px}
.table-wrap{overflow-x:auto}
.data-table{width:100%;border-collapse:collapse;font-size:12px}
.data-table th{padding:8px 10px;text-align:left;background:#1e1e2e;color:#aaaacc;font-weight:600;white-space:nowrap}
.data-table td{padding:8px 10px;border-bottom:1px solid #1e1e2e;vertical-align:middle;color:#ffffff}
.data-table tr:hover td{background:#12121a}
.badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:10px;font-weight:600}
.badge-green{background:rgba(46,125,50,.2);color:#66bb6a}
.badge-blue{background:rgba(21,101,192,.2);color:#42a5f5}
.badge-orange{background:rgba(108,99,255,.15);color:#6c63ff}
.badge-gray{background:#1e1e2e;color:#8888aa}
.action-btn{padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;border:1px solid #2a2a3e;color:#aaaacc;background:#12121a}
.action-btn.del{border-color:rgba(198,40,40,.3);color:#ef5350;background:rgba(198,40,40,.08)}

/* SELLER PAGE */
.seller-cover{height:180px;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);position:relative;display:flex;align-items:flex-end;padding:16px}
.seller-cover-overlay{position:absolute;inset:0;pointer-events:none}
.seller-av-row{display:flex;align-items:flex-end;gap:12px;position:relative;z-index:1;width:100%}
.seller-big-av{width:64px;height:64px;border-radius:50%;border:3px solid #12121a;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:700;color:#fff;flex-shrink:0;box-shadow:0 4px 16px rgba(0,0,0,.5)}
.seller-av-info{flex:1;min-width:0}
.seller-hero-name{font-size:17px;font-weight:800;color:#ffffff;margin-bottom:2px}
.seller-hero-sub{font-size:12px;color:rgba(255,255,255,.7)}
.seller-follow-btn{padding:8px 16px;border-radius:20px;background:linear-gradient(135deg,#6c63ff,#ff6584);color:#fff;font-size:12px;font-weight:700;flex-shrink:0}
.seller-stats{display:flex;gap:0;border-bottom:8px solid #0d0d14;background:#12121a}
.sstat{flex:1;padding:14px;text-align:center;border-right:1px solid #1e1e2e}
.sstat:last-child{border-right:none}
.sstat .sv{font-size:17px;font-weight:700;color:#ffffff}
.sstat .sl{font-size:11px;color:#8888aa;margin-top:2px}
.seller-tabs{display:flex;background:#12121a;border-bottom:1px solid #1e1e2e;position:sticky;top:56px;z-index:50}
.seller-tab{flex:1;padding:13px 4px;text-align:center;font-size:13px;font-weight:600;color:#8888aa;border-bottom:2px solid transparent;cursor:pointer;transition:all .15s}
.seller-tab.on{color:#6c63ff;border-bottom-color:#6c63ff}
.seller-intro{padding:14px 16px;font-size:13px;color:#aaaacc;line-height:1.7;background:#12121a;border-bottom:6px solid #0d0d14}

/* MYPAGE */
.mp-profile-card{margin:16px 14px;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 60%,#1a1a2e 100%);border:1px solid rgba(108,99,255,.2);border-radius:20px;padding:24px 20px;position:relative;overflow:hidden}
.mp-profile-card::before{content:'';position:absolute;top:-40px;right:-40px;width:140px;height:140px;border-radius:50%;background:rgba(108,99,255,.12);pointer-events:none}
.mp-card-top{display:flex;align-items:center;gap:14px}
.mp-av{width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#6c63ff,#ff6584);display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:700;color:#fff;flex-shrink:0;box-shadow:0 4px 16px rgba(108,99,255,.4)}
.mp-card-info{}
.mp-name{font-size:17px;font-weight:800;margin-bottom:4px;color:#ffffff}
.mp-type-badge{display:inline-flex;align-items:center;padding:3px 10px;background:rgba(108,99,255,.15);border-radius:20px;font-size:11px;font-weight:600;color:#6c63ff;margin-bottom:4px}
.mp-email{font-size:12px;color:#8888aa}
.mp-temp-row{display:flex;align-items:center;gap:8px;margin-top:14px}
.mp-temp-label{font-size:12px;color:#8888aa;flex-shrink:0}
.mp-temp-gauge{flex:1;height:6px;background:#1e1e2e;border-radius:3px;overflow:hidden}
.mp-temp-fill{height:100%;background:linear-gradient(90deg,#6c63ff,#ff6584);border-radius:3px;transition:width .5s}
.mp-temp-val{font-size:13px;font-weight:700;color:#6c63ff;flex-shrink:0}
.mp-stats{display:flex;margin:0 14px 16px;background:#12121a;border-radius:16px;border:1px solid #1e1e2e;overflow:hidden}
.mp-stat{flex:1;padding:16px 8px;text-align:center;border-right:1px solid #1e1e2e}
.mp-stat:last-child{border-right:none}
.mp-stat-val{font-size:18px;font-weight:700;color:#ffffff;margin-bottom:2px}
.mp-stat-lbl{font-size:11px;color:#8888aa}
.menu-list{padding:0 0 80px;background:#0a0a0f}
.menu-item{display:flex;align-items:center;gap:12px;padding:15px 16px;border-bottom:1px solid #1e1e2e;cursor:pointer;background:#0a0a0f}
.menu-item:hover{background:#12121a}
.menu-icon{font-size:20px;width:28px;text-align:center}
.menu-label{flex:1;font-size:14px;font-weight:500;color:#ffffff}
.menu-arrow{color:#2a2a3e;font-size:14px}
.menu-section{padding:12px 16px 6px;font-size:11px;font-weight:700;color:#8888aa;letter-spacing:.5px;background:#0a0a0f}

/* ANALYTICS */
.ana-sec{padding:14px;border-bottom:6px solid #0d0d14;background:#12121a}
.ana-sec h3{font-size:14px;font-weight:700;margin-bottom:10px;color:#ffffff}
.bar-chart{display:flex;align-items:flex-end;gap:6px;height:80px}
.bar-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px}
.bar{border-radius:4px 4px 0 0;width:100%;background:#1e1e2e;transition:height .5s;position:relative}
.bar.active{background:#6c63ff}
.bar-lbl{font-size:9px;color:#8888aa}
.bar-val{font-size:9px;font-weight:600;color:#aaaacc}

/* LANG SELECTOR */
.lang-sel{display:flex;gap:2px;padding:0 14px}
.lang-btn{padding:4px 8px;border-radius:14px;font-size:11px;font-weight:600;color:#8888aa;border:1px solid transparent;transition:all .15s}
.lang-btn.on{background:#6c63ff;color:#fff}

/* RESERVATION */
.res-type-row{display:flex;gap:8px;margin-bottom:16px}
.res-card{flex:1;border:1.5px solid #2a2a3e;border-radius:12px;padding:12px 8px;text-align:center;cursor:pointer;transition:all .15s;background:#12121a}
.res-card:hover,.res-card.sel{border-color:#6c63ff;background:rgba(108,99,255,.12)}
.res-card .ri{font-size:22px;margin-bottom:5px}
.res-card .rn{font-size:12px;font-weight:600;color:#ffffff}
.res-card .rd{font-size:10px;color:#8888aa;margin-top:2px}

/* TOAST */
.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(16px);background:#1e1e2e;border:1px solid #2a2a3e;color:#fff;padding:11px 20px;border-radius:22px;font-size:13px;font-weight:500;opacity:0;transition:opacity .3s,transform .3s;z-index:999;white-space:nowrap;pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* MODAL */
.mover{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:500;display:none;align-items:flex-end;justify-content:center}
.mover.open{display:flex}
.msheet{width:100%;max-width:430px;background:#12121a;border:1px solid #1e1e2e;border-radius:20px 20px 0 0;padding:20px 18px 36px}
.mhandle{width:34px;height:4px;border-radius:2px;background:#2a2a3e;margin:0 auto 16px}
.mtitle{font-size:17px;font-weight:700;margin-bottom:8px;text-align:center;color:#ffffff}
.mdesc{font-size:13px;color:#8888aa;line-height:1.6;text-align:center}
.mclose{margin-top:18px;padding:12px 32px;background:linear-gradient(135deg,#6c63ff,#ff6584);color:#fff;border-radius:12px;font-size:14px;font-weight:600;width:100%}

/* PRICE SUGGEST MODAL */
.suggest-form{padding:0 0 8px}
.suggest-form .fg{margin-bottom:12px}
.suggest-form .fg label{font-size:13px;font-weight:600;color:#aaaacc;display:block;margin-bottom:5px}

/* SCROLLBAR */
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:#2a2a3e;border-radius:4px}

@media(min-width:430px){
  .tabbar,.d-action,.toast,.chat-input-bar{left:50%}
}

/* CHAT LIST */
.chat-list-wrap{flex:1;overflow-y:auto;padding-bottom:72px;background:#0a0a0f}
.chat-room-item{display:flex;align-items:center;gap:12px;padding:13px 16px;border-bottom:1px solid #1e1e2e;cursor:pointer;transition:background .15s;background:#0a0a0f}
.chat-room-item:active,.chat-room-item:hover{background:#12121a}
.cr-av{width:46px;height:46px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;color:#fff;flex-shrink:0}
.cr-info{flex:1;min-width:0}
.cr-name{font-size:13px;font-weight:600;margin-bottom:3px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#ffffff}
.cr-preview{font-size:12px;color:#8888aa;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.cr-meta{text-align:right;flex-shrink:0;padding-left:8px}
.cr-time{font-size:10px;color:#8888aa}
.cr-unread{display:inline-block;min-width:18px;background:#6c63ff;color:#fff;border-radius:10px;padding:1px 6px;font-size:10px;font-weight:700;margin-top:3px;text-align:center}

/* CHAT ROOM */
.croom-body{flex:1;overflow-y:auto;padding:12px 14px 80px;display:flex;flex-direction:column;gap:10px;background:#0a0a0f}
.msg-row{display:flex;gap:8px;align-items:flex-end}
.msg-row.me{flex-direction:row-reverse}
.msg-av{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;flex-shrink:0}
.msg-col{display:flex;flex-direction:column}
.msg-row.me .msg-col{align-items:flex-end}
.msg-row.other .msg-col{align-items:flex-start}
.msg-bubble{max-width:230px;padding:10px 14px;border-radius:18px;font-size:14px;line-height:1.5;word-break:break-word}
.msg-row.me .msg-bubble{background:linear-gradient(135deg,#6c63ff,#7c73ff);color:#fff;border-bottom-right-radius:4px}
.msg-row.other .msg-bubble{background:#1e1e2e;color:#ffffff;border-bottom-left-radius:4px}
.msg-time{font-size:10px;color:#8888aa;margin-top:3px;padding:0 4px}
.chat-input-bar{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;background:#12121a;border-top:1px solid #1e1e2e;padding:10px 12px;display:flex;gap:8px;z-index:200}
.chat-input-bar input{flex:1;border:1.5px solid #2a2a3e;border-radius:22px;padding:9px 16px;font-size:14px;outline:none;font-family:inherit;transition:border-color .15s;background:#1e1e2e;color:#ffffff}
.chat-input-bar input:focus{border-color:#6c63ff}
.chat-send{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#6c63ff,#ff6584);color:#fff;font-size:18px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.chat-product-bar{padding:10px 14px;background:rgba(108,99,255,.08);border-bottom:1px solid rgba(108,99,255,.15);display:flex;align-items:center;gap:10px;cursor:pointer}
.cpb-thumb{width:36px;height:36px;border-radius:8px;flex-shrink:0}
.cpb-info{flex:1;min-width:0}
.cpb-title{font-size:12px;font-weight:600;color:#6c63ff;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.cpb-price{font-size:11px;color:#8888aa;margin-top:1px}

/* TOGGLE SWITCH */
.toggle-row{display:flex;align-items:center;gap:12px;padding:15px 16px;border-bottom:1px solid #1e1e2e;background:#0a0a0f}
.toggle-label{flex:1}
.toggle-title{font-size:14px;font-weight:600;margin-bottom:2px;color:#ffffff}
.toggle-desc{font-size:12px;color:#8888aa;line-height:1.4}
.toggle-switch{position:relative;width:46px;height:26px;flex-shrink:0}
.toggle-switch input{opacity:0;width:0;height:0;position:absolute}
.toggle-slider{position:absolute;inset:0;background:#2a2a3e;border-radius:26px;transition:.25s;cursor:pointer}
.toggle-slider::before{content:'';position:absolute;width:20px;height:20px;left:3px;bottom:3px;background:#fff;border-radius:50%;transition:.25s;box-shadow:0 1px 3px rgba(0,0,0,.3)}
.toggle-switch input:checked+.toggle-slider{background:#6c63ff}
.toggle-switch input:checked+.toggle-slider::before{transform:translateX(20px)}

/* RESERVATION CARD */
.res-item{padding:14px 16px;border-bottom:1px solid #1e1e2e;background:#0a0a0f}
.res-item-head{display:flex;align-items:center;gap:10px;margin-bottom:6px}
.res-item-icon{font-size:22px;width:32px;text-align:center}
.res-item-info{flex:1}
.res-item-type{font-size:14px;font-weight:700;color:#ffffff}
.res-item-dt{font-size:12px;color:#8888aa;margin-top:1px}
.res-item-note{font-size:12px;color:#aaaacc;background:#1e1e2e;padding:8px 12px;border-radius:12px;margin-top:6px;line-height:1.5}

/* LANG MODAL BUTTONS */
.lang-modal-btn{display:flex;align-items:center;gap:12px;padding:13px 16px;border-radius:16px;border:2px solid #1e1e2e;background:#12121a;width:100%;text-align:left;margin-bottom:8px;transition:all .15s}
.lang-modal-btn.on{border-color:#6c63ff;background:rgba(108,99,255,.12)}
.lang-modal-btn .lm-flag{font-size:24px}
.lang-modal-btn .lm-name{font-size:15px;font-weight:600;flex:1;color:#ffffff}
.lang-modal-btn .lm-check{color:#6c63ff;font-size:16px;font-weight:700}

/* PROFILE EDIT */
.pe-av-wrap{text-align:center;padding:24px 0 8px;background:#0a0a0f}
.pe-av-circle{width:76px;height:76px;border-radius:50%;background:linear-gradient(135deg,#6c63ff,#ff6584);display:flex;align-items:center;justify-content:center;font-size:30px;font-weight:700;color:#fff;margin:0 auto 8px}
.pe-av-hint{font-size:11px;color:#8888aa}

/* ===================== SEARCH VIEW ===================== */
.sv-top{padding:12px 14px 10px;background:#12121a;border-bottom:1px solid #1e1e2e;position:sticky;top:56px;z-index:50}
.sv-bar{display:flex;align-items:center;gap:10px;background:#1e1e2e;border-radius:14px;padding:10px 14px;border:1.5px solid #2a2a3e;transition:border-color .2s}
.sv-bar:focus-within{border-color:#6c63ff}
.sv-bar input{flex:1;border:none;background:transparent;font-size:15px;outline:none;color:#ffffff}
.sv-bar input::placeholder{color:#8888aa}
.sv-clear{font-size:13px;color:#8888aa;padding:2px 6px;border-radius:6px}
.sv-filter-row{display:flex;gap:8px;padding:10px 14px;background:#0a0a0f;border-bottom:1px solid #1e1e2e;overflow-x:auto;scrollbar-width:none}
.sv-filter-row::-webkit-scrollbar{display:none}
.sv-filter-btn{flex-shrink:0;padding:7px 14px;border-radius:20px;font-size:12px;font-weight:600;border:1.5px solid #2a2a3e;color:#8888aa;background:#12121a;transition:all .15s}
.sv-filter-btn.on{border-color:#6c63ff;color:#6c63ff;background:rgba(108,99,255,.1)}
.sv-section{padding:16px 14px 8px}
.sv-section-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.sv-section-title{font-size:11px;font-weight:700;color:#8888aa;letter-spacing:.6px;text-transform:uppercase}
.sv-section-clear{font-size:11px;color:#6c63ff;font-weight:600}
.sv-recent-row{display:flex;flex-wrap:wrap;gap:7px;padding:0 14px 14px}
.sv-recent-chip{display:inline-flex;align-items:center;gap:5px;padding:6px 10px 6px 12px;border-radius:20px;background:#12121a;border:1px solid #1e1e2e;font-size:12px;color:#aaaacc;cursor:pointer;transition:border-color .15s}
.sv-recent-chip:hover{border-color:#6c63ff;color:#6c63ff}
.sv-recent-del{font-size:11px;color:#555577;line-height:1;padding:1px 3px;border-radius:4px}
.sv-recent-del:hover{color:#ff6584}
.sv-result-hd{padding:10px 14px 4px;font-size:12px;color:#8888aa;font-weight:600}

/* ===================== FORM SECTIONS ===================== */
.form-sec-hd{display:flex;align-items:center;gap:10px;padding:18px 0 10px}
.form-sec-hd::after{content:'';flex:1;height:1px;background:#1e1e2e}
.form-sec-label{font-size:10px;font-weight:800;color:#6c63ff;letter-spacing:1px;white-space:nowrap}
.img-upload-box{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;width:100%;height:140px;border:2px dashed #2a2a3e;border-radius:16px;background:#12121a;cursor:pointer;transition:all .2s;margin-bottom:12px}
.img-upload-box:hover{border-color:#6c63ff;background:rgba(108,99,255,.04)}
.img-upload-icon{font-size:30px;opacity:.55}
.img-upload-text{font-size:13px;font-weight:600;color:#aaaacc}
.img-upload-sub{font-size:11px;color:#8888aa}
.ai-price-box{background:rgba(46,204,113,.06);border:1px solid rgba(46,204,113,.2);border-radius:12px;padding:10px 12px;font-size:12px;color:#66bb6a;line-height:1.6}

/* BUTTON HOVER EFFECTS */
.btn-primary,.submit-btn,.hero-btn-primary{transition:transform .15s,box-shadow .15s,opacity .15s}
.btn-primary:hover,.submit-btn:hover,.hero-btn-primary:hover{transform:scale(1.02);box-shadow:0 6px 20px rgba(108,99,255,.35)}
.chat-btn,.seller-follow-btn{transition:transform .15s,box-shadow .15s}
.chat-btn:hover,.seller-follow-btn:hover{transform:scale(1.02);box-shadow:0 4px 14px rgba(108,99,255,.25)}
.tab-fab{transition:transform .15s,box-shadow .15s}
.tab-fab:hover{transform:scale(1.06);box-shadow:0 6px 20px rgba(108,99,255,.45)}
.ai-analyze-btn{transition:transform .15s,box-shadow .15s,opacity .15s}
.ai-analyze-btn:not(:disabled):hover{transform:scale(1.02);box-shadow:0 6px 20px rgba(108,99,255,.35)}

/* SKELETON */
.skeleton{background:linear-gradient(90deg,#12121a 25%,#2a2a3e 50%,#12121a 75%);background-size:200% 100%;animation:shimmer 1.5s infinite}
.skel-card{border-radius:16px;overflow:hidden;background:#12121a;border:1px solid #1e1e2e}
.skel-thumb{aspect-ratio:1;width:100%}
.skel-line{height:11px;border-radius:6px;margin:8px 10px}
.skel-line.sm{width:60%}
.skel-line.xs{width:38%;height:9px}

/* INFINITE SCROLL SENTINEL */
#list-sentinel{height:60px}

/* HOME REDESIGN */
.home-hdr{position:sticky;top:0;z-index:100;background:#12121a;border-bottom:1px solid #1e1e2e;padding:0 12px;height:56px;display:flex;align-items:center;gap:8px}
.home-search-bar{flex:1;display:flex;align-items:center;gap:8px;background:#1e1e2e;border-radius:22px;padding:9px 14px;cursor:pointer;transition:background .15s}
.home-search-bar:hover{background:#2a2a3e}
.home-scroll{flex:1;overflow-y:auto;padding-bottom:72px}
.notice-banner{margin:12px 14px 0;background:linear-gradient(135deg,#1f1c38,#1a1a2e);border:1px solid rgba(108,99,255,.25);border-radius:14px;padding:11px 14px;display:flex;align-items:center;gap:8px;cursor:pointer;font-size:13px;font-weight:600;color:#aaaacc}
.notice-banner:hover{border-color:rgba(108,99,255,.5)}
.notice-banner .nb-arrow{margin-left:auto;color:#6c63ff;font-size:14px}
.home-cats{display:flex;gap:8px;overflow-x:auto;padding:12px 14px 4px;scrollbar-width:none}
.home-cats::-webkit-scrollbar{display:none}
.home-cat{flex-shrink:0;padding:7px 15px;border-radius:20px;font-size:12px;font-weight:600;background:#1e1e2e;color:#8888aa;border:1.5px solid #1e1e2e;cursor:pointer;transition:all .15s;white-space:nowrap}
.home-cat.on{background:#ffffff;color:#0a0a0f;border-color:#ffffff}
.premium-banner{margin:14px 14px 0;background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);border:1px solid rgba(180,150,80,.3);border-radius:18px;padding:18px 20px;position:relative;overflow:hidden;cursor:pointer}
.premium-banner::before{content:'';position:absolute;top:-30px;right:-30px;width:120px;height:120px;border-radius:50%;background:rgba(180,150,80,.08)}
.premium-badge{display:inline-flex;align-items:center;gap:5px;background:linear-gradient(135deg,#b49650,#e8c97e);color:#0a0a0f;font-size:10px;font-weight:800;padding:4px 10px;border-radius:20px;letter-spacing:0.5px;margin-bottom:8px}
.premium-title{font-size:16px;font-weight:800;color:#ffffff;margin-bottom:4px;position:relative;z-index:1}
.premium-sub{font-size:12px;color:#8888aa;position:relative;z-index:1}
.ai-section{margin:16px 14px 0}
.ai-section-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.ai-section-title{font-size:14px;font-weight:800;color:#ffffff}
.ai-section-more{font-size:12px;color:#6c63ff;font-weight:600}
.ai-scroll{display:flex;gap:10px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none}
.ai-scroll::-webkit-scrollbar{display:none}
.ai-card{flex-shrink:0;width:130px;background:#12121a;border:1px solid #1e1e2e;border-radius:14px;overflow:hidden;cursor:pointer;transition:transform .15s}
.ai-card:hover{transform:translateY(-2px)}
.ai-card-thumb{height:90px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.ai-card-thumb img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0}
.ai-badge-gold{position:absolute;top:6px;left:6px;background:linear-gradient(135deg,#b49650,#e8c97e);color:#0a0a0f;font-size:9px;font-weight:800;padding:2px 7px;border-radius:10px;z-index:2}
.ai-card-info{padding:8px 8px 9px}
.ai-card-name{font-size:11px;font-weight:600;color:#ffffff;margin-bottom:3px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical}
.ai-card-price{font-size:12px;font-weight:700;color:#6c63ff}
.ai-card-disc{font-size:10px;color:#ff6584;font-weight:600;margin-left:4px}
.cat-section{margin:18px 0 0}
.cat-section-hd{display:flex;align-items:center;justify-content:space-between;padding:0 14px;margin-bottom:10px}
.cat-section-title{font-size:14px;font-weight:800;color:#ffffff}
.cat-section-more{font-size:12px;color:#6c63ff;font-weight:600;cursor:pointer}
.h-product-card{display:flex;gap:12px;padding:12px 14px;border-bottom:1px solid #1e1e2e;cursor:pointer;transition:background .15s}
.h-product-card:hover{background:#12121a}
.h-product-img{width:80px;height:80px;border-radius:12px;overflow:hidden;flex-shrink:0;background:#1e1e2e;display:flex;align-items:center;justify-content:center;position:relative}
.h-product-img img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0}
.h-product-body{flex:1;min-width:0;display:flex;flex-direction:column;justify-content:space-between}
.h-badge-urgent{display:inline-flex;align-items:center;background:rgba(255,101,132,.15);color:#ff6584;font-size:9px;font-weight:700;padding:2px 7px;border-radius:10px;margin-bottom:4px;width:fit-content}
.h-product-name{font-size:13px;font-weight:600;color:#ffffff;overflow:hidden;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;margin-bottom:3px}
.h-badges{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:5px}
.h-fabric-badge{font-size:10px;padding:2px 7px;border-radius:10px;background:#1e1e2e;color:#aaaacc;font-weight:500}
.h-weight-badge{font-size:10px;padding:2px 7px;border-radius:10px;background:rgba(108,99,255,.12);color:#6c63ff;font-weight:500}
.h-price{font-size:14px;font-weight:700;color:#6c63ff}
.h-price .h-pu{font-size:10px;font-weight:400;color:#8888aa;margin-left:3px}
.h-bottom{display:flex;justify-content:space-between;align-items:center;margin-top:4px}
.h-seller{font-size:11px;color:#8888aa}
.h-counts{display:flex;gap:8px;font-size:10px;color:#8888aa}

/* AI VIEW */
#view-ai{background:#0a0a0f}
.ai-view-scroll{flex:1;overflow-y:auto;padding:16px 14px 80px}
.ai-upload-area{border:2px dashed #2a2a3e;border-radius:20px;background:#12121a;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;min-height:180px;cursor:pointer;transition:all .2s;margin-bottom:16px}
.ai-upload-area:hover{border-color:#6c63ff;background:rgba(108,99,255,.04)}
.ai-upload-area.has-img{border:none;padding:0;overflow:hidden;min-height:220px}
.ai-upload-area.has-img img{width:100%;height:220px;object-fit:cover;border-radius:18px}
.ai-camera-icon{font-size:40px;opacity:.5}
.ai-upload-hint{font-size:13px;font-weight:600;color:#aaaacc}
.ai-upload-sub{font-size:11px;color:#8888aa}
.ai-analyze-btn{width:100%;padding:15px;background:linear-gradient(135deg,#6c63ff,#ff6584);color:#fff;border-radius:16px;font-size:15px;font-weight:700;margin-bottom:16px;transition:opacity .15s}
.ai-analyze-btn:disabled{opacity:.45;cursor:not-allowed}
.ai-result-card{background:#12121a;border:1px solid #1e1e2e;border-radius:20px;padding:18px;display:none}
.ai-result-card.show{display:block}
.ai-result-title{font-size:14px;font-weight:700;color:#ffffff;margin-bottom:14px}
.ai-result-row{display:flex;align-items:center;padding:11px 0;border-bottom:1px solid #1e1e2e}
.ai-result-row:last-child{border-bottom:none}
.ai-result-label{font-size:12px;color:#8888aa;width:80px;flex-shrink:0}
.ai-result-val{font-size:13px;font-weight:600;color:#ffffff;flex:1}
.ai-result-highlight{color:#6c63ff}
.ai-gauge-wrap{flex:1;display:flex;align-items:center;gap:8px}
.ai-gauge{flex:1;height:6px;background:#1e1e2e;border-radius:3px;overflow:hidden}
.ai-gauge-fill{height:100%;background:linear-gradient(90deg,#6c63ff,#ff6584);border-radius:3px;transition:width .6s}
.ai-loading{text-align:center;padding:28px;color:#8888aa;font-size:13px}
.ai-strategy-box{background:rgba(108,99,255,.08);border:1px solid rgba(108,99,255,.2);border-radius:12px;padding:12px 14px;margin-top:12px}
.ai-strategy-title{font-size:11px;font-weight:700;color:#6c63ff;letter-spacing:.5px;margin-bottom:6px}
.ai-strategy-text{font-size:13px;color:#aaaacc;line-height:1.7}

/* RESERVATION MODAL ENHANCED */
.res-type-row-modal{display:flex;gap:8px;margin-bottom:16px}
.res-type-card{flex:1;border:1.5px solid #2a2a3e;border-radius:16px;padding:14px 6px;text-align:center;cursor:pointer;transition:all .2s;background:#1e1e2e}
.res-type-card:hover,.res-type-card.sel{border-color:#6c63ff;background:rgba(108,99,255,.15)}
.res-type-card .ri{font-size:26px;margin-bottom:5px}
.res-type-card .rn{font-size:12px;font-weight:700;color:#ffffff}
.res-type-card .rd{font-size:9px;color:#8888aa;margin-top:2px;line-height:1.3}
.res-date-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
</head>
<body>
<div id="app">

<!-- ========== SPLASH ========== -->
<div id="view-splash" class="view">
  <div class="splash-logo">BIUM MARKET</div>
  <div class="splash-sub">B2B Ïû¨Í≥†ÏõêÎã® Í±∞Îûò ÌîåÎû´Ìèº</div>
  <div class="splash-progress">
    <div class="splash-bar"></div>
  </div>
</div>

<!-- ========== LOGIN ========== -->
<div id="view-login" class="view">
  <div style="padding:48px 24px 0;width:100%">
    <div class="login-logo">üßµ ÎπÑÏõÄÎßàÏºì</div>
    <div class="login-logo" style="font-size:13px;font-weight:400;color:var(--g500);margin-bottom:28px">BIUM MARKET ‚Äî B2B Ïû¨Í≥†ÏõêÎã® Í±∞Îûò ÌîåÎû´Ìèº</div>
    <div class="login-box">
      <div class="fg">
        <label data-i18n="login_id_label">ÏïÑÏù¥Îîî (Ïù¥Î©îÏùº)</label>
        <input type="email" class="fi" id="l-email" placeholder="example@bium.market" />
      </div>
      <div class="fg">
        <label data-i18n="login_pw_label">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
        <input type="password" class="fi" id="l-pw" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†•" onkeydown="if(event.key==='Enter')doLogin()" />
      </div>
      <button class="btn-primary" data-i18n="btn_login" onclick="doLogin()" style="margin-bottom:12px">Î°úÍ∑∏Ïù∏</button>
      <button class="btn-secondary" data-i18n="btn_to_signup" onclick="showView('signup')">ÌöåÏõêÍ∞ÄÏûÖ</button>
      <div class="divider-text" data-i18n="test_account">ÌÖåÏä§Ìä∏ Í≥ÑÏ†ï</div>
      <div style="background:#12121a;border:1px solid #1e1e2e;border-radius:12px;padding:12px 14px;font-size:12px;color:#aaaacc;line-height:1.8">
        Í¥ÄÎ¶¨Ïûê: <b style="color:#6c63ff">admin</b> / <b style="color:#6c63ff">1234</b><br>
        ÌåêÎß§Ïûê: <b style="color:#6c63ff">seller@test.com</b> / <b style="color:#6c63ff">1234</b><br>
        Íµ¨Îß§Ïûê: <b style="color:#6c63ff">buyer@test.com</b> / <b style="color:#6c63ff">1234</b>
      </div>
    </div>
  </div>
  <div style="margin-top:auto;padding:20px;text-align:center;font-size:11px;color:var(--g500)">
    ‚ìí 2024 LOWHIGH MARKET ¬∑ ÏÑúÏö∏ ÎèôÎåÄÎ¨∏Íµ¨ ¬∑ ÎåÄÌëú ÏÜêÏ†ïÌòÑ
  </div>
</div>

<!-- ========== SIGNUP ========== -->
<div id="view-signup" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="showView('login')">‚Üê</button>
    <div class="hdr-title" data-i18n="signup_title">ÌöåÏõêÍ∞ÄÏûÖ</div>
    <div style="width:38px"></div>
  </header>
  <div class="f-scroll">
    <div style="margin-bottom:16px">
      <div class="fg"><label><span data-i18n="signup_type_label">ÌöåÏõê Ïú†Ìòï ÏÑ†ÌÉù</span> <span class="req">*</span></label></div>
      <div class="type-grid">
        <div class="type-card sel" data-type="seller" onclick="selectType('seller',this)">
          <div class="tc-icon">üè≠</div>
          <div class="tc-name" data-i18n="type_seller">ÌåêÎß§Ïûê</div>
          <div class="tc-desc" data-i18n="type_seller_sub">ÏõêÎã® ÎèÑÎß§ ¬∑ Ïû¨Í≥† ÌåêÎß§</div>
        </div>
        <div class="type-card" data-type="buyer" onclick="selectType('buyer',this)">
          <div class="tc-icon">üõí</div>
          <div class="tc-name" data-i18n="type_buyer">Íµ¨Îß§Ïûê</div>
          <div class="tc-desc" data-i18n="type_buyer_sub">ÏõêÎã® ÏÜåÏã± ¬∑ Íµ¨Îß§</div>
        </div>
        <div class="type-card" data-type="brand" onclick="selectType('brand',this)">
          <div class="tc-icon">üëó</div>
          <div class="tc-name" data-i18n="type_brand">Î∏åÎûúÎìú</div>
          <div class="tc-desc" data-i18n="type_brand_sub">Ìå®ÏÖò Î∏åÎûúÎìú ¬∑ Ï†úÏ°∞ÏÇ¨</div>
        </div>
        <div class="type-card" data-type="both" onclick="selectType('both',this)">
          <div class="tc-icon">üîÑ</div>
          <div class="tc-name" data-i18n="type_both">Í≤∏ÏóÖ</div>
          <div class="tc-desc" data-i18n="type_both_sub">ÌåêÎß§ + Íµ¨Îß§ Î™®Îëê</div>
        </div>
      </div>
    </div>
    <div class="fg"><label><span data-i18n="login_id_label">ÏïÑÏù¥Îîî (Ïù¥Î©îÏùº)</span> <span class="req">*</span></label><input type="text" class="fi" id="s-name" placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÏóÖÏ≤¥Î™Ö"/></div>
    <div class="fg"><label>Ïù¥Î©îÏùº <span class="req">*</span></label><input type="email" class="fi" id="s-email" placeholder="example@bium.market"/></div>
    <div class="fg"><label><span data-i18n="login_pw_label">ÎπÑÎ∞ÄÎ≤àÌò∏</span> <span class="req">*</span></label><input type="password" class="fi" id="s-pw" placeholder="6Ïûê Ïù¥ÏÉÅ"/></div>
    <div class="fg"><label>ÏÇ¨ÏóÖÏû• ÏúÑÏπò</label><input type="text" class="fi" id="s-loc" placeholder="Ïòà) ÏÑúÏö∏ ÎèôÎåÄÎ¨∏Íµ¨ Ïã†ÏÑ§Îèô"/></div>
    <button class="submit-btn" data-i18n="btn_join" onclick="doSignup()">Í∞ÄÏûÖÌïòÍ∏∞</button>
  </div>
</div>

<!-- ========== LIST ========== -->
<div id="view-list" class="view">
  <header class="home-hdr">
    <div class="hdr-logo" style="flex:none;font-size:16px">ÎπÑÏõÄ</div>
    <div class="home-search-bar" onclick="showView('search-view')">
      <span style="font-size:14px;color:#8888aa">üîç</span>
      <span style="flex:1;font-size:13px;color:#8888aa">ÏõêÎã®Î™Ö, ÏÉâÏÉÅ, Ï¢ÖÎ•ò Í≤ÄÏÉâ...</span>
    </div>
    <button class="hdr-btn" onclick="showView('ai')" title="AIÎ∂ÑÏÑù">üì∑</button>
    <button class="hdr-btn" id="btn-alert" title="ÏïåÎ¶º">üîî</button>
  </header>
  <!-- Î†àÍ±∞Ïãú Ìò∏ÌôòÏö© Ïà®ÍπÄ ÏöîÏÜå -->
  <input type="text" id="search-input" placeholder="ÏõêÎã® Ï¢ÖÎ•ò, ÏÉâÏÉÅ, ÏóÖÏ≤¥Î™Ö Í≤ÄÏÉâ" autocomplete="off" style="display:none"/>
  <div id="filter-chips" style="display:none"></div>
  <div class="home-scroll">
    <!-- Í≥µÏßÄ Î∞∞ÎÑà -->
    <div class="notice-banner" onclick="openNoticeModal()">
      <span>üì¢</span>
      <span>[Í≥µÏßÄ] ÎπÑÏõÄÎßàÏºì Î≤†ÌÉÄ Ïò§Ìîà ÏïàÎÇ¥</span>
      <span class="nb-arrow">‚Ä∫</span>
    </div>
    <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ Ïπ© -->
    <div class="home-cats" id="home-cats"></div>
    <!-- ÌîÑÎ¶¨ÎØ∏ÏóÑ Î∞∞ÎÑà -->
    <div class="premium-banner" onclick="showView('form')">
      <div class="premium-badge">‚òÖ PREMIUM</div>
      <div class="premium-title">ÎèôÎåÄÎ¨∏ Ïû¨Í≥†ÏõêÎã® ÌîÑÎ¶¨ÎØ∏ÏóÑ Í±∞Îûò</div>
      <div class="premium-sub">Í≤ÄÏ¶ùÎêú ÏÖÄÎü¨Ïùò Í≥†ÌíàÏßà ÏõêÎã®ÏùÑ ÎßåÎÇòÎ≥¥ÏÑ∏Ïöî</div>
    </div>
    <!-- AI Ï∂îÏ≤ú ÏÑπÏÖò -->
    <div class="ai-section">
      <div class="ai-section-hd">
        <span class="ai-section-title">‚ú® AI Ï∂îÏ≤ú ÏõêÎã®</span>
        <span class="ai-section-more" onclick="showView('ai')">AI Î∂ÑÏÑùÌïòÍ∏∞ ‚Üí</span>
      </div>
      <div class="ai-scroll" id="ai-rec-scroll"></div>
    </div>
    <!-- Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÉÅÌíà ÏÑπÏÖò -->
    <div id="home-category-sections"></div>
    <!-- Î†àÍ±∞Ïãú Ìò∏ÌôòÏö© Ïà®ÍπÄ ÏöîÏÜå -->
    <ul class="plist" id="product-list" style="display:none"></ul>
    <div id="list-sentinel"></div>
    <div class="empty" id="empty-state" style="display:none">
      <div class="ei">üßµ</div>
      <p id="empty-msg">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏñ¥Ïöî</p>
    </div>
  </div>
  <nav class="tabbar">
    <button class="tab on" onclick="showView('list')"><span class="ti">üè†</span><span>Ìôà</span></button>
    <button class="tab" onclick="openCategorySheet()"><span class="ti">üìã</span><span>Ïπ¥ÌÖåÍ≥†Î¶¨</span></button>
    <button class="tab" onclick="showView('chat')"><span class="ti">üí¨</span><span>Ï±ÑÌåÖ</span></button>
    <button class="tab" onclick="showView('mypage')"><span class="ti">üë§</span><span>MY</span></button>
  </nav>
</div>

<!-- ========== DETAIL ========== -->

<div id="view-detail" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚Üê</button>
    <div class="hdr-title" id="d-hdr-title">ÏÉÅÌíà ÏÉÅÏÑ∏</div>
    <button class="hdr-btn" onclick="shareProduct()">‚ãØ</button>
  </header>
  <div class="d-scroll" id="d-scroll">
    <div class="d-slider" id="d-slider">
      <div class="s-track" id="s-track"></div>
      <div class="s-dots" id="s-dots"></div>
      <button class="s-nav s-prev" id="s-prev" onclick="slideMove(-1)">‚Äπ</button>
      <button class="s-nav s-next" id="s-next" onclick="slideMove(1)">‚Ä∫</button>
    </div>
    <div class="sel-sec">
      <div class="sel-av" id="d-av"></div>
      <div class="sel-info">
        <div class="sel-name" id="d-sname"></div>
        <div class="sel-loc" id="d-sloc"></div>
      </div>
      <div class="temp-box">
        <div class="temp-val" id="d-temp"></div>
        <div class="temp-lbl" data-i18n="manner_temp">Îß§ÎÑàÏò®ÎèÑ</div>
        <button style="font-size:11px;color:var(--P);margin-top:3px" onclick="openSellerPage()">ÎØ∏ÎãàÌôàÌîº ‚Üí</button>
      </div>
    </div>
    <div class="d-sec">
      <h3 data-i18n="fabric_info">ÏõêÎã® Ï†ïÎ≥¥</h3>
      <table class="ftbl" id="d-ftbl"></table>
    </div>
    <div class="d-sec d-desc">
      <h3 data-i18n="product_desc">ÏÉÅÌíà ÏÑ§Î™Ö</h3>
      <p id="d-desc"></p>
    </div>
    <div class="d-sec">
      <div class="tag-row" id="d-tags"></div>
    </div>
    <div class="d-stats" id="d-stats"></div>
    <!-- ÏòàÏïΩ ÏÑπÏÖò -->
    <div class="d-sec">
      <h3 data-i18n="res_title">ÏòàÏïΩ Ïã†Ï≤≠</h3>
      <div class="res-type-row">
        <div class="res-card sel" onclick="selectRes('visit',this)">
          <div class="ri">üè≠</div>
          <div class="rn">Î∞©Î¨∏ Í∞êÎ≥Ñ</div>
          <div class="rd">Í≥µÏû• ÏßÅÏ†ë Î∞©Î¨∏</div>
        </div>
        <div class="res-card" onclick="selectRes('swatch',this)">
          <div class="ri">üì¶</div>
          <div class="rn">Ïä§ÏôÄÏπò ÏöîÏ≤≠</div>
          <div class="rd">ÏÉòÌîå Î∞õÍ∏∞</div>
        </div>
        <div class="res-card" onclick="selectRes('inspect',this)">
          <div class="ri">üöó</div>
          <div class="rn">Ï∂úÏû• Í∞êÎ≥Ñ</div>
          <div class="rd">Ï†ÑÎ¨∏Í∞Ä ÌååÍ≤¨</div>
        </div>
      </div>
      <button class="btn-secondary" data-i18n="btn_reserve" style="font-size:13px;padding:10px" onclick="openResModal()">ÏòàÏïΩÌïòÍ∏∞</button>
    </div>
  </div>
  <div class="d-action">
    <button class="heart-btn" id="d-heart" onclick="toggleDetailLike()">
      <span class="hicon" id="d-hicon">ü§ç</span>
      <span id="d-lcnt">0</span>
    </button>
    <div class="price-area">
      <div class="tp" id="d-tp"></div>
      <div class="pp" id="d-pp"></div>
    </div>
    <button class="suggest-btn" data-i18n="btn_suggest" onclick="openSuggestModal()">Í∞ÄÍ≤©Ï†úÏïà</button>
    <button class="chat-btn" data-i18n="btn_chat" onclick="openChatModal()">Ï±ÑÌåÖ</button>
  </div>
</div>

<!-- ========== FORM ========== -->
<div id="view-form" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚úï</button>
    <div class="hdr-title" data-i18n="form_title">ÏõêÎã® ÌåêÎß§ Îì±Î°ù</div>
    <div style="width:38px"></div>
  </header>
  <div class="f-scroll">

    <!-- AI ÌûåÌä∏ Î∞∞ÎÑà -->
    <div class="ai-hint">
      <span class="ai-icon">ü§ñ</span>
      <span id="ai-hint-text">AI ÏûêÎèô ÏûÖÎ†•: ÏÇ¨ÏßÑÏùÑ Ï≤®Î∂ÄÌïòÎ©¥ ÏÜåÏû¨¬∑ÏÉâÏÉÅ¬∑Ï§ëÎüâÏùÑ ÏûêÎèôÏúºÎ°ú Ïù∏ÏãùÌï¥ÎìúÎ†§Ïöî!</span>
    </div>

    <!-- ‚îÄ‚îÄ Í∏∞Î≥∏ Ï†ïÎ≥¥ ‚îÄ‚îÄ -->
    <div class="form-sec-hd"><span class="form-sec-label">Í∏∞Î≥∏ Ï†ïÎ≥¥</span></div>

    <input type="file" id="file-input" accept="image/*" multiple style="display:none"/>
    <div class="img-upload-box" id="img-upload-box" onclick="document.getElementById('file-input').click()">
      <div class="img-upload-icon">üì∑</div>
      <div class="img-upload-text">ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</div>
      <div class="img-upload-sub">ÏµúÎåÄ 5Ïû• ¬∑ JPG / PNG</div>
    </div>
    <div class="img-scroll" id="img-scroll" style="display:none;margin-bottom:14px">
      <button class="img-add" onclick="document.getElementById('file-input').click()">
        <span style="font-size:20px">Ôºã</span><span>Ï∂îÍ∞Ä</span>
      </button>
    </div>

    <div class="fg"><label><span data-i18n="form_name_label">ÏÉÅÌíàÎ™Ö</span> <span class="req">*</span></label><input type="text" class="fi" id="f-title" placeholder="Ïòà) ÏïÑÏù¥Î≥¥Î¶¨ Î©¥ ÏõêÎã® Ïû¨Í≥† 45m"/></div>

    <!-- ‚îÄ‚îÄ ÏõêÎã® Ï†ïÎ≥¥ ‚îÄ‚îÄ -->
    <div class="form-sec-hd"><span class="form-sec-label">ÏõêÎã® Ï†ïÎ≥¥</span></div>

    <div class="fg"><label data-i18n="form_cat_label">Ïπ¥ÌÖåÍ≥†Î¶¨ (ÎåÄÎ∂ÑÎ•ò)</label>
      <select class="fi" id="f-cat1" onchange="updateCat2()">
        <option value="">ÏÑ†ÌÉù</option>
        <option value="Ï≤úÏó∞ÏÑ¨Ïú†">Ï≤úÏó∞ÏÑ¨Ïú†</option>
        <option value="Ìï©ÏÑ±ÏÑ¨Ïú†">Ìï©ÏÑ±ÏÑ¨Ïú†</option>
        <option value="ÌòºÎ∞©">ÌòºÎ∞©</option>
        <option value="ÌäπÏàòÏõêÎã®">ÌäπÏàòÏõêÎã®</option>
      </select>
    </div>
    <div class="fg"><label><span data-i18n="form_type_label">ÏõêÎã® Ï¢ÖÎ•ò</span> <span class="req">*</span></label>
      <select class="fi" id="f-type">
        <option value="">ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</option>
        <option value="Î©¥">Î©¥</option>
        <option value="Ìè¥Î¶¨">Ìè¥Î¶¨</option>
        <option value="Ïö∏">Ïö∏</option>
        <option value="Î¶∞ÎÑ®">Î¶∞ÎÑ®</option>
        <option value="Ïã§ÌÅ¨">Ïã§ÌÅ¨</option>
        <option value="ÌòºÎ∞©">ÌòºÎ∞©</option>
        <option value="Í∏∞ÌÉÄ">Í∏∞ÌÉÄ</option>
      </select>
    </div>
    <div class="form-row">
      <div class="fg"><label><span data-i18n="form_color_label">ÏÉâÏÉÅ</span> <span class="req">*</span></label><input type="text" class="fi" id="f-color" placeholder="Ïòà) ÏïÑÏù¥Î≥¥Î¶¨"/></div>
      <div class="fg"><label data-i18n="form_width_label">Ìè≠ (cm)</label><input type="number" class="fi" id="f-width" placeholder="Ïòà) 150" min="0"/></div>
    </div>
    <div class="fg"><label data-i18n="form_weight_label">Ï§ëÎüâ (g/„é°)</label><input type="number" class="fi" id="f-weight" placeholder="Ïòà) 180"/></div>

    <!-- ‚îÄ‚îÄ ÌåêÎß§ Ï†ïÎ≥¥ ‚îÄ‚îÄ -->
    <div class="form-sec-hd"><span class="form-sec-label">ÌåêÎß§ Ï†ïÎ≥¥</span></div>

    <div class="form-row">
      <div class="fg"><label><span data-i18n="form_qty_label">Ïû¨Í≥† (m)</span> <span class="req">*</span></label><input type="number" class="fi" id="f-qty" placeholder="Ïòà) 30" min="0" step="0.1" oninput="calcTotal()"/></div>
      <div class="fg"><label><span data-i18n="form_price_label">Í∞ÄÍ≤© (Ïõê/m)</span> <span class="req">*</span></label><input type="number" class="fi" id="f-price" placeholder="Ïòà) 5000" min="0" oninput="calcTotal()"/></div>
    </div>
    <div class="fg"><label data-i18n="form_total_label">Ï¥ù Í∏àÏï° (ÏûêÎèô Í≥ÑÏÇ∞)</label><div class="total-disp" id="f-total">ÏàòÎüâÍ≥º Îã®Í∞ÄÎ•º ÏûÖÎ†•ÌïòÎ©¥ ÏûêÎèô Í≥ÑÏÇ∞ÎèºÏöî</div></div>
    <div class="fg"><label><span data-i18n="form_loc_label">Í±∞Îûò ÏßÄÏó≠</span> <span class="req">*</span></label><input type="text" class="fi" id="f-loc" placeholder="Ïòà) ÏÑúÏö∏ ÎèôÎåÄÎ¨∏Íµ¨ Ïã†ÏÑ§Îèô"/></div>
    <div class="fg"><label data-i18n="form_desc_label">ÏÉÅÏÑ∏ ÏÑ§Î™Ö</label><textarea class="fi" id="f-desc" placeholder="ÏõêÎã® ÏÉÅÌÉú, Íµ¨Îß§ Í≤ΩÏúÑ, Í±∞Îûò Î∞©Î≤ï Îì±ÏùÑ ÏûêÏú†Î°≠Í≤å Ï†ÅÏñ¥Ï£ºÏÑ∏Ïöî."></textarea></div>
    <div class="fg"><label><span data-i18n="form_tags_label">Ìï¥ÏãúÌÉúÍ∑∏</span> <span style="color:#8888aa;font-weight:400">(ÏâºÌëú Íµ¨Î∂Ñ)</span></label><input type="text" class="fi" id="f-tags" placeholder="Ïû¨Í≥†ÏõêÎã®, Ìï†Ïù∏, ÏÜåÎüâÍ∞ÄÎä•"/></div>
    <div class="fg"><label data-i18n="form_ai_label">AI Í∞ÄÍ≤© ÏòàÏ∏°</label>
      <div class="ai-price-box" id="ai-price-hint">ÏõêÎã® Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÎ©¥ AIÍ∞Ä Ï†ÅÏ†ï Í∞ÄÍ≤©ÏùÑ ÏòàÏ∏°Ìï¥ÎìúÎ†§Ïöî üìä</div>
    </div>

    <button class="submit-btn" data-i18n="btn_register" onclick="submitForm()">Îì±Î°ùÌïòÍ∏∞</button>
  </div>
</div>

<!-- ========== ADMIN ========== -->
<div id="view-admin" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚Üê</button>
    <div class="hdr-title">Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú</div>
    <button class="hdr-btn" onclick="doLogout()">üö™</button>
  </header>
  <div class="admin-tabs" id="admin-tabs">
    <button class="atab on" onclick="switchAdminTab('overview',this)">Í∞úÏöî</button>
    <button class="atab" onclick="switchAdminTab('users',this)">ÌöåÏõê</button>
    <button class="atab" onclick="switchAdminTab('products',this)">ÏÉÅÌíà</button>
    <button class="atab" onclick="switchAdminTab('notices',this)">Í≥µÏßÄ</button>
  </div>
  <div class="admin-content" id="admin-content"></div>
</div>

<!-- ========== SELLER PAGE ========== -->
<div id="view-seller" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚Üê</button>
    <div class="hdr-title">ÌåêÎß§Ïûê</div>
    <button class="hdr-btn" onclick="showToast('Í≥µÏú†ÎêêÏñ¥Ïöî!')">‚ãØ</button>
  </header>
  <div style="flex:1;overflow-y:auto;padding-bottom:20px">
    <div class="seller-cover" id="sh-cover">
      <div class="seller-cover-overlay" id="sh-cover-overlay"></div>
      <div class="seller-av-row">
        <div class="seller-big-av" id="sh-av"></div>
        <div class="seller-av-info">
          <div class="seller-hero-name" id="sh-name"></div>
          <div class="seller-hero-sub" id="sh-loc"></div>
        </div>
        <button class="seller-follow-btn" onclick="showToast('ÌåîÎ°úÏö∞ÌñàÏñ¥Ïöî! ‚≠ê')">ÌåîÎ°úÏö∞</button>
      </div>
    </div>
    <div class="seller-stats" id="sh-stats"></div>
    <div class="seller-tabs">
      <div class="seller-tab on" onclick="switchSellerTab('onsale',this)">ÌåêÎß§Ï§ë</div>
      <div class="seller-tab" onclick="switchSellerTab('sold',this)">Í±∞ÎûòÏôÑÎ£å</div>
      <div class="seller-tab" onclick="switchSellerTab('review',this)">Î¶¨Î∑∞</div>
    </div>
    <div id="sh-tab-content"></div>
  </div>
</div>

<!-- ========== MYPAGE ========== -->
<div id="view-mypage" class="view">
  <header class="hdr">
    <div class="hdr-logo">ÎπÑÏõÄÎßàÏºì</div>
    <button class="hdr-btn" onclick="doLogout()">üö™</button>
  </header>
  <div style="flex:1;overflow-y:auto">
    <div class="mp-profile-card">
      <div class="mp-card-top">
        <div class="mp-av" id="mp-av"></div>
        <div class="mp-card-info">
          <div class="mp-name" id="mp-name"></div>
          <div class="mp-type-badge" id="mp-type"></div>
          <div class="mp-email" id="mp-email"></div>
        </div>
      </div>
      <div class="mp-temp-row">
        <span class="mp-temp-label">Îß§ÎÑàÏò®ÎèÑ</span>
        <div class="mp-temp-gauge"><div class="mp-temp-fill" id="mp-temp-fill"></div></div>
        <span class="mp-temp-val" id="mp-temp"></span>
      </div>
    </div>
    <div class="mp-stats">
      <div class="mp-stat"><div class="mp-stat-val" id="mp-stat-sell">0</div><div class="mp-stat-lbl">ÌåêÎß§</div></div>
      <div class="mp-stat"><div class="mp-stat-val" id="mp-stat-buy">0</div><div class="mp-stat-lbl">Íµ¨Îß§</div></div>
      <div class="mp-stat"><div class="mp-stat-val" id="mp-stat-wish">0</div><div class="mp-stat-lbl">Ï∞ú</div></div>
    </div>
    <div class="menu-list" id="menu-list"></div>
  </div>
  <nav class="tabbar">
    <button class="tab" onclick="showView('list')"><span class="ti">üè†</span><span data-i18n="tab_home">Ìôà</span></button>
    <button class="tab" onclick="showView('search-view')"><span class="ti">üîç</span><span data-i18n="tab_search">Í≤ÄÏÉâ</span></button>
    <button class="tab-fab" onclick="showView('form')">Ôºã</button>
    <button class="tab" onclick="showView('chat')"><span class="ti">üí¨</span><span data-i18n="tab_chat">Ï±ÑÌåÖ</span></button>
    <button class="tab on" onclick="showView('mypage')"><span class="ti">üë§</span><span data-i18n="tab_me">MY</span></button>
  </nav>
</div>

<!-- ========== ANALYTICS ========== -->
<div id="view-analytics" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚Üê</button>
    <div class="hdr-title">Îß§Ï∂ú ÎåÄÏãúÎ≥¥Îìú</div>
    <div style="width:38px"></div>
  </header>
  <div style="flex:1;overflow-y:auto;padding-bottom:20px">
    <div class="ana-sec">
      <h3>Ïù¥Î≤à Îã¨ ÏöîÏïΩ</h3>
      <div class="stat-grid">
        <div class="stat-card"><div class="sv">‚Ç©2.4M</div><div class="sl">Ï¥ù Îß§Ï∂ú</div></div>
        <div class="stat-card"><div class="sv">8Í±¥</div><div class="sl">Í±∞Îûò ÏôÑÎ£å</div></div>
        <div class="stat-card"><div class="sv">340m</div><div class="sl">ÌåêÎß§ ÏàòÎüâ</div></div>
        <div class="stat-card"><div class="sv">94%</div><div class="sl">ÏùëÎãµÎ•†</div></div>
      </div>
    </div>
    <div class="ana-sec">
      <h3>ÏõîÎ≥Ñ Îß§Ï∂ú (ÏµúÍ∑º 6Í∞úÏõî)</h3>
      <div class="bar-chart" id="bar-chart"></div>
    </div>
    <div class="ana-sec">
      <h3>Ïù∏Í∏∞ ÏõêÎã® TOP 3</h3>
      <div id="top-fabrics"></div>
    </div>
    <div class="ana-sec">
      <h3>Ïã§ÏãúÍ∞Ñ ÏõêÎã® ÏãúÏÑ∏</h3>
      <div id="market-price"></div>
    </div>
  </div>
</div>

<!-- ========== RESERVATIONS ========== -->
<div id="view-reservations" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚Üê</button>
    <div class="hdr-title">ÏòàÏïΩ ÎÇ¥Ïó≠</div>
    <div style="width:38px"></div>
  </header>
  <div style="flex:1;overflow-y:auto;padding-bottom:20px" id="res-list-wrap">
    <div id="res-list"></div>
    <div class="empty" id="res-empty" style="display:none">
      <div class="ei">üìÖ</div>
      <p>ÏòàÏïΩ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏñ¥Ïöî</p>
    </div>
  </div>
</div>

<!-- ========== NOTIF SETTINGS ========== -->
<div id="view-notif-settings" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚Üê</button>
    <div class="hdr-title">ÏïåÎ¶º ÏÑ§Ï†ï</div>
    <div style="width:38px"></div>
  </header>
  <div style="flex:1;overflow-y:auto">
    <div style="padding:12px 16px 6px;font-size:11px;font-weight:700;color:var(--g500);letter-spacing:.5px">ÏïåÎ¶º Ï¢ÖÎ•ò</div>
    <div id="notif-list"></div>
    <div style="padding:14px 16px;font-size:12px;color:var(--g500);line-height:1.6">
      ‚Äª ÏïåÎ¶º ÏÑ§Ï†ïÏùÄ Ïù¥ Í∏∞Í∏∞ÏóêÎßå Ï†ÄÏû•Îê©ÎãàÎã§.<br>Ïã§Ï†ú Ìë∏Ïãú ÏïåÎ¶ºÏùÄ Ïï± ÏÑ§Ïπò ÌõÑ ÏßÄÏõêÎê©ÎãàÎã§.
    </div>
  </div>
</div>

<!-- ========== PROFILE EDIT ========== -->
<div id="view-profile-edit" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚Üê</button>
    <div class="hdr-title">ÌîÑÎ°úÌïÑ ÏàòÏ†ï</div>
    <div style="width:38px"></div>
  </header>
  <div class="f-scroll">
    <div class="pe-av-wrap">
      <div class="pe-av-circle" id="pe-av">?</div>
      <div class="pe-av-hint">Ïù¥Î¶Ñ Ï≤´ Í∏ÄÏûêÎ°ú ÏûêÎèô ÏÑ§Ï†ïÎèºÏöî</div>
    </div>
    <div class="fg">
      <label>Ïù¥Î¶Ñ / ÏóÖÏ≤¥Î™Ö <span class="req">*</span></label>
      <input type="text" class="fi" id="pe-name" placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÏóÖÏ≤¥Î™Ö" oninput="document.getElementById('pe-av').textContent=this.value[0]||'?'"/>
    </div>
    <div class="fg">
      <label>ÏÜåÍ∞ú</label>
      <textarea class="fi" id="pe-intro" placeholder="ÏóÖÏ≤¥ ÏÜåÍ∞úÎÇò ÏûêÍ∏∞ÏÜåÍ∞úÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" style="min-height:80px"></textarea>
    </div>
    <div class="fg">
      <label>ÏÇ¨ÏóÖÏû• ÏúÑÏπò</label>
      <input type="text" class="fi" id="pe-loc" placeholder="Ïòà) ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏÑ±ÏàòÎèô"/>
    </div>
    <button class="submit-btn" onclick="saveProfile()">Ï†ÄÏû•ÌïòÍ∏∞</button>
  </div>
</div>

<!-- ========== SEARCH VIEW ========== -->
<div id="view-search-view" class="view">
  <header class="hdr">
    <div class="hdr-logo">BIUM</div>
  </header>
  <!-- Í≤ÄÏÉâÎ∞î (sticky) -->
  <div class="sv-top">
    <div class="sv-bar">
      <span style="font-size:16px;color:#8888aa">üîç</span>
      <input type="text" id="sv-input" placeholder="ÏõêÎã®Î™Ö, ÏÉâÏÉÅ, Ï¢ÖÎ•ò Í≤ÄÏÉâ..." autocomplete="off"/>
      <button class="sv-clear" id="sv-clear-btn" onclick="clearSvInput()" style="display:none">‚úï</button>
    </div>
  </div>
  <!-- ÌïÑÌÑ∞ Î≤ÑÌäº Ìñâ -->
  <div class="sv-filter-row">
    <button class="sv-filter-btn on" id="svf-all" onclick="setSvFilter('Ï†ÑÏ≤¥');updateSvFilterBtns('Ï†ÑÏ≤¥')">Ï†ÑÏ≤¥</button>
    <button class="sv-filter-btn" id="svf-Î©¥" onclick="setSvFilter('Î©¥');updateSvFilterBtns('Î©¥')">Î©¥</button>
    <button class="sv-filter-btn" id="svf-Ìè¥Î¶¨" onclick="setSvFilter('Ìè¥Î¶¨');updateSvFilterBtns('Ìè¥Î¶¨')">Ìè¥Î¶¨</button>
    <button class="sv-filter-btn" id="svf-Ïö∏" onclick="setSvFilter('Ïö∏');updateSvFilterBtns('Ïö∏')">Ïö∏</button>
    <button class="sv-filter-btn" id="svf-Î¶∞ÎÑ®" onclick="setSvFilter('Î¶∞ÎÑ®');updateSvFilterBtns('Î¶∞ÎÑ®')">Î¶∞ÎÑ®</button>
    <button class="sv-filter-btn" id="svf-Ïã§ÌÅ¨" onclick="setSvFilter('Ïã§ÌÅ¨');updateSvFilterBtns('Ïã§ÌÅ¨')">Ïã§ÌÅ¨</button>
    <button class="sv-filter-btn" id="svf-ÌòºÎ∞©" onclick="setSvFilter('ÌòºÎ∞©');updateSvFilterBtns('ÌòºÎ∞©')">ÌòºÎ∞©</button>
    <button class="sv-filter-btn" id="svf-Í∞ÄÍ≤©" onclick="showToast('Í∞ÄÍ≤© ÌïÑÌÑ∞ Ï§ÄÎπÑÏ§ëÏù¥ÏóêÏöî')">Í∞ÄÍ≤© ‚ñæ</button>
    <button class="sv-filter-btn" id="svf-ÏßÄÏó≠" onclick="showToast('ÏßÄÏó≠ ÌïÑÌÑ∞ Ï§ÄÎπÑÏ§ëÏù¥ÏóêÏöî')">ÏßÄÏó≠ ‚ñæ</button>
  </div>
  <!-- ÏµúÍ∑º Í≤ÄÏÉâÏñ¥ -->
  <div id="sv-recent-section" style="display:none">
    <div class="sv-section">
      <div class="sv-section-hd">
        <span class="sv-section-title">ÏµúÍ∑º Í≤ÄÏÉâÏñ¥</span>
        <button class="sv-section-clear" onclick="clearAllRecent()">Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</button>
      </div>
    </div>
    <div class="sv-recent-row" id="sv-recent-chips"></div>
  </div>
  <!-- Í≤∞Í≥º Ïπ¥Ïö¥Ìä∏ -->
  <div id="sv-result-hd" class="sv-result-hd" style="display:none"></div>
  <!-- Í≤∞Í≥º Î™©Î°ù -->
  <ul class="plist" id="sv-list"></ul>
  <div class="empty" id="sv-empty" style="display:none">
    <div class="ei">üîç</div>
    <p id="sv-empty-msg">Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÍ±∞ÎÇò Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
  </div>
  <nav class="tabbar">
    <button class="tab" onclick="showView('list')"><span class="ti">üè†</span><span data-i18n="tab_home">Ìôà</span></button>
    <button class="tab on"><span class="ti">üîç</span><span data-i18n="tab_search">Í≤ÄÏÉâ</span></button>
    <button class="tab-fab" onclick="showView('form')">Ôºã</button>
    <button class="tab" onclick="showView('chat')"><span class="ti">üí¨</span><span data-i18n="tab_chat">Ï±ÑÌåÖ</span></button>
    <button class="tab" onclick="showView('mypage')"><span class="ti">üë§</span><span data-i18n="tab_me">MY</span></button>
  </nav>
</div>

<!-- ========== WISHLIST ========== -->
<div id="view-wishlist" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚Üê</button>
    <div class="hdr-title">Í¥ÄÏã¨ Î™©Î°ù</div>
    <div style="width:38px"></div>
  </header>
  <ul class="plist" id="wishlist-list" style="padding:10px 10px 72px"></ul>
  <div class="empty" id="wishlist-empty" style="display:none">
    <div class="ei">ü§ç</div>
    <p>Í¥ÄÏã¨ ÏÉÅÌíàÏù¥ ÏóÜÏñ¥Ïöî</p>
  </div>
</div>

<!-- ========== CHAT LIST ========== -->
<div id="view-chat" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚Üê</button>
    <div class="hdr-title">Ï±ÑÌåÖ</div>
    <div style="width:38px"></div>
  </header>
  <div class="chat-list-wrap" id="chat-list-wrap"></div>
  <div class="empty" id="chat-list-empty" style="display:none">
    <div class="ei">üí¨</div>
    <p style="text-align:center">Ï±ÑÌåÖ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏñ¥Ïöî<br><small style="font-size:12px;color:var(--g500)">ÏÉÅÌíà ÏÉÅÏÑ∏ÏóêÏÑú Ï±ÑÌåÖ Î≤ÑÌäºÏùÑ ÎàåÎü¨Î≥¥ÏÑ∏Ïöî</small></p>
  </div>
  <nav class="tabbar">
    <button class="tab" onclick="showView('list')"><span class="ti">üè†</span><span data-i18n="tab_home">Ìôà</span></button>
    <button class="tab" onclick="showView('search-view')"><span class="ti">üîç</span><span data-i18n="tab_search">Í≤ÄÏÉâ</span></button>
    <button class="tab-fab" onclick="showView('form')">Ôºã</button>
    <button class="tab on"><span class="ti">üí¨</span><span data-i18n="tab_chat">Ï±ÑÌåÖ</span></button>
    <button class="tab" onclick="showView('mypage')"><span class="ti">üë§</span><span data-i18n="tab_me">MY</span></button>
  </nav>
</div>

<!-- ========== CHAT ROOM ========== -->
<div id="view-chat-room" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚Üê</button>
    <div class="hdr-title" id="cr-hdr-title">Ï±ÑÌåÖ</div>
    <div style="width:38px"></div>
  </header>
  <div class="chat-product-bar" id="cr-product-bar" onclick="goChatProduct()">
    <div class="cpb-thumb" id="cr-thumb"></div>
    <div class="cpb-info">
      <div class="cpb-title" id="cr-prod-title">ÏÉÅÌíà Ï†ïÎ≥¥</div>
      <div class="cpb-price" id="cr-prod-price"></div>
    </div>
    <span style="color:var(--P);font-size:14px">‚Ä∫</span>
  </div>
  <div class="croom-body" id="cr-body"></div>
  <div class="chat-input-bar">
    <input type="text" id="cr-input" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" onkeydown="if(event.key==='Enter')sendChatMsg()"/>
    <button class="chat-send" onclick="sendChatMsg()">‚Üë</button>
  </div>
</div>

<!-- ========== AI VIEW ========== -->
<div id="view-ai" class="view">
  <header class="hdr">
    <button class="hdr-back" onclick="goBack()">‚Üê</button>
    <div class="hdr-title">‚ú® AI Í∞ÄÍ≤© Î∂ÑÏÑù</div>
    <div style="width:38px"></div>
  </header>
  <div class="ai-view-scroll">
    <div class="ai-hint" style="margin-bottom:16px">
      <span class="ai-icon">ü§ñ</span>
      <span>ÏõêÎã® ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ AIÍ∞Ä ÏÜåÏû¨¬∑Ï†ÅÏ†ï Í∞ÄÍ≤©¬∑ÌåêÎß§ Ï†ÑÎûµÏùÑ Î∂ÑÏÑùÌï¥ÎìúÎ†§Ïöî!</span>
    </div>
    <input type="file" id="ai-file-input" accept="image/*" style="display:none" onchange="handleAiUpload(event)"/>
    <div class="ai-upload-area" id="ai-upload-area" onclick="document.getElementById('ai-file-input').click()">
      <div class="ai-camera-icon">üì∑</div>
      <div class="ai-upload-hint">ÏõêÎã® ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî</div>
      <div class="ai-upload-sub">JPG / PNG ¬∑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù</div>
    </div>
    <button class="ai-analyze-btn" id="ai-analyze-btn" onclick="startAiAnalysis()" disabled>AI Î∂ÑÏÑù ÏãúÏûë</button>
    <div class="ai-result-card" id="ai-result-card"></div>
  </div>
</div>

</div><!-- #app -->

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- MODAL: CHAT -->
<div class="mover" id="modal-chat" onclick="closeModal('modal-chat',event)">
  <div class="msheet">
    <div class="mhandle"></div>
    <div style="font-size:40px;text-align:center;margin-bottom:10px">üí¨</div>
    <div class="mtitle">Ï±ÑÌåÖÌïòÍ∏∞</div>
    <div class="mdesc">Ïã§ÏãúÍ∞Ñ Ï±ÑÌåÖ Í∏∞Îä•ÏùÄ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.<br>Îπ†Î•∏ ÏãúÏùº ÎÇ¥Ïóê Ïò§ÌîàÌï†Í≤åÏöî!</div>
    <button class="mclose" onclick="closeModal('modal-chat')">ÌôïÏù∏</button>
  </div>
</div>

<!-- MODAL: PRICE SUGGEST -->
<div class="mover" id="modal-suggest" onclick="closeModal('modal-suggest',event)">
  <div class="msheet">
    <div class="mhandle"></div>
    <div class="mtitle">üí∞ Í∞ÄÍ≤© Ï†úÏïà</div>
    <div class="suggest-form">
      <div class="fg">
        <label>Ï†úÏïà Í∞ÄÍ≤© (Ïõê/m)</label>
        <input type="number" class="fi" id="suggest-price" placeholder="Ï†úÏïàÌï† Îã®Í∞Ä ÏûÖÎ†•"/>
      </div>
      <div class="fg">
        <label>Î©îÏãúÏßÄ</label>
        <textarea class="fi" id="suggest-msg" placeholder="Ï†úÏïà Ïù¥Ïú†ÎÇò Í±∞Îûò Ï°∞Í±¥ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" style="min-height:70px"></textarea>
      </div>
    </div>
    <button class="mclose" onclick="submitSuggest()">Ï†úÏïà Î≥¥ÎÇ¥Í∏∞</button>
  </div>
</div>

<!-- MODAL: NOTICE -->
<div class="mover" id="modal-notice" onclick="closeModal('modal-notice',event)">
  <div class="msheet" style="max-height:70vh">
    <div class="mhandle"></div>
    <div class="mtitle">üì¢ Í≥µÏßÄÏÇ¨Ìï≠</div>
    <div style="padding:0 20px 24px;overflow-y:auto">
      <div style="font-size:15px;font-weight:700;color:#ffffff;margin-bottom:10px">ÎπÑÏõÄÎßàÏºì Î≤†ÌÉÄ Ïò§Ìîà ÏïàÎÇ¥</div>
      <div style="font-size:13px;color:#aaaacc;line-height:1.7;margin-bottom:14px">
        ÏïàÎÖïÌïòÏÑ∏Ïöî, ÎπÑÏõÄÎßàÏºìÏûÖÎãàÎã§.<br><br>
        Íµ≠ÎÇ¥ ÏµúÏ¥à B2B Ïû¨Í≥†ÏõêÎã® Ï†ÑÎ¨∏ ÌîåÎû´Ìèº <strong style="color:#6c63ff">ÎπÑÏõÄÎßàÏºì</strong>Ïù¥ Î≤†ÌÉÄ ÏÑúÎπÑÏä§Î•º ÏãúÏûëÌï©ÎãàÎã§.<br><br>
        Î≤†ÌÉÄ Í∏∞Í∞Ñ ÎèôÏïà Î™®Îì† ÏÑúÎπÑÏä§Îäî <strong style="color:#ff6584">Î¨¥Î£å</strong>Î°ú Ïù¥Ïö©ÌïòÏã§ Ïàò ÏûàÏúºÎ©∞, Ïó¨Îü¨Î∂ÑÏùò ÏÜåÏ§ëÌïú ÌîºÎìúÎ∞±ÏùÑ Í∏∞Îã§Î¶ΩÎãàÎã§.
      </div>
      <div style="background:#1e1e2e;border-radius:12px;padding:14px 16px;margin-bottom:16px">
        <div style="font-size:12px;font-weight:700;color:#aaaacc;margin-bottom:8px">Ï£ºÏöî Í∏∞Îä•</div>
        <div style="font-size:13px;color:#ffffff;line-height:2">
          ‚úÖ Ïû¨Í≥†ÏõêÎã® ÌåêÎß§/Íµ¨Îß§<br>
          ‚úÖ AI ÏõêÎã® Í∞ÄÍ≤© Î∂ÑÏÑù<br>
          ‚úÖ Ïã§ÏãúÍ∞Ñ Ï±ÑÌåÖ Î¨∏Ïùò<br>
          ‚úÖ Î∞©Î¨∏Í∞êÎ≥Ñ/Ïä§ÏôÄÏπò ÏòàÏïΩ
        </div>
      </div>
      <button onclick="closeModal('modal-notice')" style="width:100%;padding:14px;background:linear-gradient(135deg,#6c63ff,#ff6584);color:#fff;border-radius:14px;font-size:14px;font-weight:700">ÌôïÏù∏</button>
    </div>
  </div>
</div>

<!-- MODAL: CATEGORY SHEET -->
<div class="mover" id="modal-category" onclick="closeModal('modal-category',event)">
  <div class="msheet">
    <div class="mhandle"></div>
    <div class="mtitle">üìã Ïπ¥ÌÖåÍ≥†Î¶¨</div>
    <div id="category-sheet-content" style="padding:0 16px 24px;display:grid;grid-template-columns:1fr 1fr;gap:10px"></div>
  </div>
</div>

<!-- MODAL: RESERVATION -->
<div class="mover" id="modal-res" onclick="closeModal('modal-res',event)">
  <div class="msheet">
    <div class="mhandle"></div>
    <div class="mtitle">üìÖ ÏòàÏïΩ Ïã†Ï≤≠</div>
    <div class="res-type-row-modal">
      <div class="res-type-card sel" onclick="selectResModal('visit',this)">
        <div class="ri">üè≠</div>
        <div class="rn">Î∞©Î¨∏ Í∞êÎ≥Ñ</div>
        <div class="rd">Í≥µÏû• ÏßÅÏ†ë Î∞©Î¨∏</div>
      </div>
      <div class="res-type-card" onclick="selectResModal('swatch',this)">
        <div class="ri">üì¶</div>
        <div class="rn">Ïä§ÏôÄÏπò ÏöîÏ≤≠</div>
        <div class="rd">ÏÉòÌîå Î∞õÍ∏∞</div>
      </div>
      <div class="res-type-card" onclick="selectResModal('inspect',this)">
        <div class="ri">üöó</div>
        <div class="rn">Ï∂úÏû• Í∞êÎ≥Ñ</div>
        <div class="rd">Ï†ÑÎ¨∏Í∞Ä ÌååÍ≤¨</div>
      </div>
    </div>
    <div class="suggest-form">
      <div class="res-date-grid">
        <div class="fg">
          <label>Ìù¨Îßù ÎÇ†Ïßú</label>
          <input type="date" class="fi" id="res-date"/>
        </div>
        <div class="fg">
          <label>Ìù¨Îßù ÏãúÍ∞Ñ</label>
          <select class="fi" id="res-time">
            <option>09:00</option><option>10:00</option><option>11:00</option>
            <option>13:00</option><option>14:00</option><option>15:00</option><option>16:00</option>
          </select>
        </div>
      </div>
      <div class="fg">
        <label>Î©îÎ™® ¬∑ ÏöîÏ≤≠ ÏÇ¨Ìï≠</label>
        <textarea class="fi" id="res-note" placeholder="ÌäπÏù¥ÏÇ¨Ìï≠Ïù¥ ÏûàÏúºÎ©¥ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî" style="min-height:72px"></textarea>
      </div>
    </div>
    <button class="submit-btn" onclick="submitReservation()" style="margin-top:4px">ÏòàÏïΩÌïòÍ∏∞</button>
  </div>
</div>

<!-- MODAL: LANGUAGE -->
<div class="mover" id="modal-lang" onclick="closeModal('modal-lang',event)">
  <div class="msheet">
    <div class="mhandle"></div>
    <div class="mtitle">üåê Ïñ∏Ïñ¥ ÏÑ†ÌÉù</div>
    <div id="modal-lang-btns" style="padding:8px 0 4px"></div>
    <button class="mclose" style="background:var(--g200);color:var(--g700)" onclick="closeModal('modal-lang')">Îã´Í∏∞</button>
  </div>
</div>

<!-- MODAL: SHARE -->
<div class="mover" id="modal-share" onclick="closeModal('modal-share',event)">
  <div class="msheet">
    <div class="mhandle"></div>
    <div class="mtitle">Í≥µÏú†ÌïòÍ∏∞</div>
    <div style="display:flex;justify-content:center;gap:16px;margin:16px 0">
      <button onclick="showToast('ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêêÏñ¥Ïöî!');closeModal('modal-share')" style="display:flex;flex-direction:column;align-items:center;gap:6px;font-size:12px;color:var(--g700)"><span style="font-size:32px;background:var(--g100);border-radius:50%;width:52px;height:52px;display:flex;align-items:center;justify-content:center">üîó</span>ÎßÅÌÅ¨Î≥µÏÇ¨</button>
      <button onclick="showToast('Ïπ¥Ïπ¥Ïò§ÌÜ° Í≥µÏú† Ï§ÄÎπÑÏ§ë');closeModal('modal-share')" style="display:flex;flex-direction:column;align-items:center;gap:6px;font-size:12px;color:var(--g700)"><span style="font-size:32px;background:#FFE812;border-radius:50%;width:52px;height:52px;display:flex;align-items:center;justify-content:center">üíõ</span>Ïπ¥Ïπ¥Ïò§ÌÜ°</button>
    </div>
    <button class="mclose" onclick="closeModal('modal-share')">Îã´Í∏∞</button>
  </div>
</div>

<script>
/* ==================== CONFIG ==================== */
const CLAUDE_API_KEY=''; // ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå ‚Äî API ÌÇ§Îäî Vercel ÌôòÍ≤ΩÎ≥ÄÏàòÎ°ú ÏÑúÎ≤ÑÏóêÏÑú Ï≤òÎ¶¨

/* ==================== I18N ==================== */
const LANGS={
  ko:{code:'ko',name:'ÌïúÍµ≠Ïñ¥',flag:'üá∞üá∑',
    tab_home:'Ìôà',tab_search:'Í≤ÄÏÉâ',tab_chat:'Ï±ÑÌåÖ',tab_me:'MY',
    signup_title:'ÌöåÏõêÍ∞ÄÏûÖ',form_title:'ÏõêÎã® ÌåêÎß§ Îì±Î°ù',
    fabric_info:'ÏõêÎã® Ï†ïÎ≥¥',product_desc:'ÏÉÅÌíà ÏÑ§Î™Ö',
    chat_coming:'Ï±ÑÌåÖ Í∏∞Îä• Ï§ÄÎπÑÏ§ëÏù¥ÏóêÏöî',
    empty_msg:'Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏñ¥Ïöî',
    registered:'ÏÉÅÌíàÏù¥ Îì±Î°ùÎêêÏñ¥Ïöî! üéâ',
    filter_Ï†ÑÏ≤¥:'Ï†ÑÏ≤¥',filter_Î©¥:'Î©¥',filter_Ìè¥Î¶¨:'Ìè¥Î¶¨',filter_Ïö∏:'Ïö∏',
    filter_Î¶∞ÎÑ®:'Î¶∞ÎÑ®',filter_Ïã§ÌÅ¨:'Ïã§ÌÅ¨',filter_ÌòºÎ∞©:'ÌòºÎ∞©',filter_Í∏∞ÌÉÄ:'Í∏∞ÌÉÄ',
    search_placeholder:'ÏõêÎã® Ï¢ÖÎ•ò, ÏÉâÏÉÅ, ÏóÖÏ≤¥Î™Ö Í≤ÄÏÉâ',
    detail_title:'ÏÉÅÌíà ÏÉÅÏÑ∏',manner_temp:'Îß§ÎÑàÏò®ÎèÑ',
    lbl_type:'ÏõêÎã® Ï¢ÖÎ•ò',lbl_color:'ÏÉâÏÉÅ',lbl_width:'Ìè≠',
    lbl_weight:'Ï§ëÎüâ',lbl_qty:'ÏàòÎüâ',lbl_price:'Îã®Í∞Ä',lbl_unknown:'Ï†ïÎ≥¥ ÏóÜÏùå',
    stats_interest:'Í¥ÄÏã¨',stats_chat:'Ï±ÑÌåÖ',
    res_title:'ÏòàÏïΩ Ïã†Ï≤≠',
    res_visit:'Î∞©Î¨∏ ÏòàÏïΩ',res_visit_sub:'ÏßÅÏ†ë Î∞©Î¨∏',
    res_swatch:'Ïä§ÏôÄÏπò',res_swatch_sub:'ÏÉòÌîå Î∞úÏÜ°',
    res_inspect:'Ï∂úÏû•Í∞êÎ≥Ñ',res_inspect_sub:'Ï†ÑÎ¨∏Í∞Ä Î∞©Î¨∏',
    btn_reserve:'ÏòàÏïΩÌïòÍ∏∞',btn_suggest:'Í∞ÄÍ≤©Ï†úÏïà',btn_chat:'Ï±ÑÌåÖ',
    login_id_label:'ÏïÑÏù¥Îîî (Ïù¥Î©îÏùº)',login_pw_label:'ÎπÑÎ∞ÄÎ≤àÌò∏',
    btn_login:'Î°úÍ∑∏Ïù∏',btn_to_signup:'ÌöåÏõêÍ∞ÄÏûÖ',test_account:'ÌÖåÏä§Ìä∏ Í≥ÑÏ†ï',
    signup_type_label:'ÌöåÏõê Ïú†Ìòï ÏÑ†ÌÉù',
    type_seller:'ÌåêÎß§Ïûê',type_seller_sub:'ÏõêÎã® ÎèÑÎß§ ¬∑ Ïû¨Í≥† ÌåêÎß§',
    type_buyer:'Íµ¨Îß§Ïûê',type_buyer_sub:'ÏõêÎã® ÏÜåÏã± ¬∑ Íµ¨Îß§',
    type_brand:'Î∏åÎûúÎìú',type_brand_sub:'Ìå®ÏÖò Î∏åÎûúÎìú ¬∑ Ï†úÏ°∞ÏÇ¨',
    type_both:'Í≤∏ÏóÖ',type_both_sub:'ÌåêÎß§ + Íµ¨Îß§ Î™®Îëê',
    btn_join:'Í∞ÄÏûÖÌïòÍ∏∞',
    form_photo:'ÏÇ¨ÏßÑ Ï≤®Î∂Ä',form_photo_add:'ÏÇ¨ÏßÑÏ∂îÍ∞Ä',
    form_name_label:'ÏÉÅÌíàÎ™Ö',form_cat_label:'Ïπ¥ÌÖåÍ≥†Î¶¨ (ÎåÄÎ∂ÑÎ•ò)',
    form_type_label:'ÏõêÎã® Ï¢ÖÎ•ò',form_color_label:'ÏÉâÏÉÅ',
    form_width_label:'Ìè≠ (cm)',form_weight_label:'Ï§ëÎüâ (g/„é°)',
    form_qty_label:'ÏàòÎüâ (m)',form_price_label:'Îã®Í∞Ä (Ïõê/m)',
    form_total_label:'Ï¥ù Í∏àÏï° (ÏûêÎèô Í≥ÑÏÇ∞)',form_total_hint:'ÏàòÎüâÍ≥º Îã®Í∞ÄÎ•º ÏûÖÎ†•ÌïòÎ©¥ ÏûêÎèô Í≥ÑÏÇ∞ÎèºÏöî',
    form_loc_label:'Í±∞Îûò ÏßÄÏó≠',form_desc_label:'ÏÉÅÏÑ∏ ÏÑ§Î™Ö',
    form_tags_label:'Ìï¥ÏãúÌÉúÍ∑∏',form_ai_label:'AI Í∞ÄÍ≤© ÏòàÏ∏°',
    btn_register:'Îì±Î°ùÌïòÍ∏∞',
    like_add:'Í¥ÄÏã¨ Î™©Î°ùÏóê Ï∂îÍ∞ÄÎêêÏñ¥Ïöî ‚ù§Ô∏è',like_remove:'Í¥ÄÏã¨ Î™©Î°ùÏóêÏÑú Ï†úÍ±∞ÎêêÏñ¥Ïöî',
  },
  en:{code:'en',name:'English',flag:'üá∫üá∏',
    tab_home:'Home',tab_search:'Search',tab_chat:'Chat',tab_me:'My',
    signup_title:'Sign Up',form_title:'Register Fabric',
    fabric_info:'Fabric Info',product_desc:'Description',
    chat_coming:'Chat coming soon',
    empty_msg:'No results found',
    registered:'Product registered! üéâ',
    filter_Ï†ÑÏ≤¥:'All',filter_Î©¥:'Cotton',filter_Ìè¥Î¶¨:'Poly',filter_Ïö∏:'Wool',
    filter_Î¶∞ÎÑ®:'Linen',filter_Ïã§ÌÅ¨:'Silk',filter_ÌòºÎ∞©:'Blend',filter_Í∏∞ÌÉÄ:'Other',
    search_placeholder:'Search fabric, color, seller',
    detail_title:'Product Detail',manner_temp:'Manner Temp',
    lbl_type:'Fabric Type',lbl_color:'Color',lbl_width:'Width',
    lbl_weight:'Weight',lbl_qty:'Qty',lbl_price:'Price/m',lbl_unknown:'N/A',
    stats_interest:'Likes',stats_chat:'Chats',
    res_title:'Reservation',
    res_visit:'Visit',res_visit_sub:'Direct Visit',
    res_swatch:'Swatch',res_swatch_sub:'Send Sample',
    res_inspect:'Inspection',res_inspect_sub:'Expert Visit',
    btn_reserve:'Reserve',btn_suggest:'Offer Price',btn_chat:'Chat',
    login_id_label:'Email',login_pw_label:'Password',
    btn_login:'Login',btn_to_signup:'Sign Up',test_account:'Test Account',
    signup_type_label:'Select Member Type',
    type_seller:'Seller',type_seller_sub:'Wholesale ¬∑ Stock',
    type_buyer:'Buyer',type_buyer_sub:'Sourcing ¬∑ Purchase',
    type_brand:'Brand',type_brand_sub:'Fashion Brand',
    type_both:'Both',type_both_sub:'Buy & Sell',
    btn_join:'Join Now',
    form_photo:'Photos',form_photo_add:'Add Photo',
    form_name_label:'Product Name',form_cat_label:'Category',
    form_type_label:'Fabric Type',form_color_label:'Color',
    form_width_label:'Width (cm)',form_weight_label:'Weight (g/„é°)',
    form_qty_label:'Qty (m)',form_price_label:'Price (‚Ç©/m)',
    form_total_label:'Total (auto)',form_total_hint:'Auto-calculated from qty & price',
    form_loc_label:'Location',form_desc_label:'Description',
    form_tags_label:'Hashtags',form_ai_label:'AI Price Est.',
    btn_register:'Register',
    like_add:'Added to wishlist ‚ù§Ô∏è',like_remove:'Removed from wishlist',
  },
  ja:{code:'ja',name:'Êó•Êú¨Ë™û',flag:'üáØüáµ',
    tab_home:'„Éõ„Éº„É†',tab_search:'Ê§úÁ¥¢',tab_chat:'„ÉÅ„É£„ÉÉ„Éà',tab_me:'MY',
    signup_title:'‰ºöÂì°ÁôªÈå≤',form_title:'ÁîüÂú∞ÁôªÈå≤',
    fabric_info:'ÁîüÂú∞ÊÉÖÂ†±',product_desc:'ÂïÜÂìÅË™¨Êòé',
    chat_coming:'„ÉÅ„É£„ÉÉ„ÉàÊ©üËÉΩ„ÅØÊ∫ñÂÇô‰∏≠„Åß„Åô',
    empty_msg:'Ê§úÁ¥¢ÁµêÊûú„Å™„Åó',
    registered:'ÂïÜÂìÅ„ÅåÁôªÈå≤„Åï„Çå„Åæ„Åó„ÅüÔºÅüéâ',
    filter_Ï†ÑÏ≤¥:'„Åô„Åπ„Å¶',filter_Î©¥:'„Ç≥„ÉÉ„Éà„É≥',filter_Ìè¥Î¶¨:'„Éù„É™',filter_Ïö∏:'„Ç¶„Éº„É´',
    filter_Î¶∞ÎÑ®:'„É™„Éç„É≥',filter_Ïã§ÌÅ¨:'„Ç∑„É´„ÇØ',filter_ÌòºÎ∞©:'Ê∑∑Á¥°',filter_Í∏∞ÌÉÄ:'„Åù„ÅÆ‰ªñ',
    search_placeholder:'ÁîüÂú∞Á®ÆÈ°û„ÄÅËâ≤„ÄÅÊ•≠ËÄÖÂêç„ÅßÊ§úÁ¥¢',
    detail_title:'ÂïÜÂìÅË©≥Á¥∞',manner_temp:'„Éû„Éä„ÉºÊ∏©Â∫¶',
    lbl_type:'ÁîüÂú∞Á®ÆÈ°û',lbl_color:'Ëâ≤',lbl_width:'ÂπÖ',
    lbl_weight:'ÈáçÈáè',lbl_qty:'Êï∞Èáè',lbl_price:'Âçò‰æ°',lbl_unknown:'ÊÉÖÂ†±„Å™„Åó',
    stats_interest:'„ÅÑ„ÅÑ„Å≠',stats_chat:'„ÉÅ„É£„ÉÉ„Éà',
    res_title:'‰∫àÁ¥ÑÁî≥Ë´ã',
    res_visit:'Ë®™Âïè‰∫àÁ¥Ñ',res_visit_sub:'Áõ¥Êé•Ë®™Âïè',
    res_swatch:'„Çπ„ÉØ„ÉÉ„ÉÅ',res_swatch_sub:'„Çµ„É≥„Éó„É´ÈÄÅ‰ªò',
    res_inspect:'Âá∫ÂºµÈëëÂÆö',res_inspect_sub:'Â∞ÇÈñÄÂÆ∂Ë®™Âïè',
    btn_reserve:'‰∫àÁ¥Ñ„Åô„Çã',btn_suggest:'‰æ°Ê†ºÊèêÊ°à',btn_chat:'„ÉÅ„É£„ÉÉ„Éà',
    login_id_label:'„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ',login_pw_label:'„Éë„Çπ„ÉØ„Éº„Éâ',
    btn_login:'„É≠„Ç∞„Ç§„É≥',btn_to_signup:'‰ºöÂì°ÁôªÈå≤',test_account:'„ÉÜ„Çπ„Éà„Ç¢„Ç´„Ç¶„É≥„Éà',
    signup_type_label:'‰ºöÂì°„Çø„Ç§„Éó„ÇíÈÅ∏Êäû',
    type_seller:'Ë≤©Â£≤ËÄÖ',type_seller_sub:'Âç∏Â£≤„Çä„ÉªÂú®Â∫´Ë≤©Â£≤',
    type_buyer:'Ë≥ºÂÖ•ËÄÖ',type_buyer_sub:'ÁîüÂú∞Ë™øÈÅî„ÉªË≥ºÂÖ•',
    type_brand:'„Éñ„É©„É≥„Éâ',type_brand_sub:'„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥„Éñ„É©„É≥„Éâ',
    type_both:'ÂÖºÊ•≠',type_both_sub:'Ë≤©Â£≤ÔºãË≥ºÂÖ•',
    btn_join:'ÁôªÈå≤„Åô„Çã',
    form_photo:'ÂÜôÁúüÊ∑ª‰ªò',form_photo_add:'ÂÜôÁúüËøΩÂä†',
    form_name_label:'ÂïÜÂìÅÂêç',form_cat_label:'„Ç´„ÉÜ„Ç¥„É™',
    form_type_label:'ÁîüÂú∞Á®ÆÈ°û',form_color_label:'Ëâ≤',
    form_width_label:'ÂπÖ (cm)',form_weight_label:'ÈáçÈáè (g/„é°)',
    form_qty_label:'Êï∞Èáè (m)',form_price_label:'Âçò‰æ° (‚Ç©/m)',
    form_total_label:'ÂêàË®àÈáëÈ°ç (Ëá™Âãï)',form_total_hint:'Êï∞Èáè„Å®Âçò‰æ°„ÇíÂÖ•Âäõ„Åô„Çã„Å®Ëá™ÂãïË®àÁÆó„Åï„Çå„Åæ„Åô',
    form_loc_label:'ÂèñÂºïÂú∞Âüü',form_desc_label:'Ë©≥Á¥∞Ë™¨Êòé',
    form_tags_label:'„Éè„ÉÉ„Ç∑„É•„Çø„Ç∞',form_ai_label:'AI‰æ°Ê†º‰∫àÊ∏¨',
    btn_register:'ÁôªÈå≤„Åô„Çã',
    like_add:'„ÅäÊ∞ó„Å´ÂÖ•„Çä„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü ‚ù§Ô∏è',like_remove:'„ÅäÊ∞ó„Å´ÂÖ•„Çä„Åã„ÇâÂâäÈô§„Åó„Åæ„Åó„Åü',
  },
  zh:{code:'zh',name:'‰∏≠Êñá',flag:'üá®üá≥',
    tab_home:'È¶ñÈ°µ',tab_search:'ÊêúÁ¥¢',tab_chat:'ËÅäÂ§©',tab_me:'ÊàëÁöÑ',
    signup_title:'Ê≥®ÂÜå',form_title:'Ê≥®ÂÜåÈù¢Êñô',
    fabric_info:'Èù¢Êñô‰ø°ÊÅØ',product_desc:'ÂïÜÂìÅÊèèËø∞',
    chat_coming:'ËÅäÂ§©ÂäüËÉΩÂáÜÂ§á‰∏≠',
    empty_msg:'Ê≤°ÊúâÊêúÁ¥¢ÁªìÊûú',
    registered:'ÂïÜÂìÅÂ∑≤Ê≥®ÂÜåÔºÅüéâ',
    filter_Ï†ÑÏ≤¥:'ÂÖ®ÈÉ®',filter_Î©¥:'Ê£â',filter_Ìè¥Î¶¨:'Ê∂§Á∫∂',filter_Ïö∏:'ÁæäÊØõ',
    filter_Î¶∞ÎÑ®:'‰∫öÈ∫ª',filter_Ïã§ÌÅ¨:'‰∏ùÁª∏',filter_ÌòºÎ∞©:'Ê∑∑Á∫∫',filter_Í∏∞ÌÉÄ:'ÂÖ∂‰ªñ',
    search_placeholder:'ÊêúÁ¥¢Èù¢ÊñôÁßçÁ±ª„ÄÅÈ¢úËâ≤„ÄÅÂéÇÂïÜ',
    detail_title:'ÂïÜÂìÅËØ¶ÊÉÖ',manner_temp:'Á§º‰ª™Ê∏©Â∫¶',
    lbl_type:'Èù¢ÊñôÁ±ªÂûã',lbl_color:'È¢úËâ≤',lbl_width:'ÂπÖÂÆΩ',
    lbl_weight:'ÂÖãÈáç',lbl_qty:'Êï∞Èáè',lbl_price:'Âçï‰ª∑',lbl_unknown:'ÊöÇÊó†‰ø°ÊÅØ',
    stats_interest:'ÂÖ≥Ê≥®',stats_chat:'ËÅäÂ§©',
    res_title:'È¢ÑÁ∫¶Áî≥ËØ∑',
    res_visit:'‰∏äÈó®È¢ÑÁ∫¶',res_visit_sub:'Áõ¥Êé•Âà∞ËÆø',
    res_swatch:'Ê†∑ÂìÅ',res_swatch_sub:'Ê†∑ÂìÅÈÇÆÂØÑ',
    res_inspect:'‰∏äÈó®Èâ¥ÂÆö',res_inspect_sub:'‰∏ìÂÆ∂‰∏äÈó®',
    btn_reserve:'Á´ãÂç≥È¢ÑÁ∫¶',btn_suggest:'Êä•‰ª∑',btn_chat:'ËÅäÂ§©',
    login_id_label:'ÈÇÆÁÆ±',login_pw_label:'ÂØÜÁ†Å',
    btn_login:'ÁôªÂΩï',btn_to_signup:'Ê≥®ÂÜå',test_account:'ÊµãËØïË¥¶Âè∑',
    signup_type_label:'ÈÄâÊã©‰ºöÂëòÁ±ªÂûã',
    type_seller:'ÂçñÂÆ∂',type_seller_sub:'ÊâπÂèë¬∑Â∫ìÂ≠òÈîÄÂîÆ',
    type_buyer:'‰π∞ÂÆ∂',type_buyer_sub:'Èù¢ÊñôÈááË¥≠',
    type_brand:'ÂìÅÁâå',type_brand_sub:'Êó∂Â∞öÂìÅÁâå¬∑Âà∂ÈÄ†ÂïÜ',
    type_both:'ÂÖºËê•',type_both_sub:'‰π∞ÂçñÂÖºËê•',
    btn_join:'Á´ãÂç≥Ê≥®ÂÜå',
    form_photo:'‰∏ä‰º†ÂõæÁâá',form_photo_add:'Ê∑ªÂä†ÂõæÁâá',
    form_name_label:'ÂïÜÂìÅÂêçÁß∞',form_cat_label:'ÂïÜÂìÅÂàÜÁ±ª',
    form_type_label:'Èù¢ÊñôÁßçÁ±ª',form_color_label:'È¢úËâ≤',
    form_width_label:'ÂπÖÂÆΩ (cm)',form_weight_label:'ÂÖãÈáç (g/„é°)',
    form_qty_label:'Êï∞Èáè (m)',form_price_label:'Âçï‰ª∑ (‚Ç©/m)',
    form_total_label:'ÊÄªÈáëÈ¢ù (Ëá™Âä®)',form_total_hint:'ËæìÂÖ•Êï∞ÈáèÂíåÂçï‰ª∑ÂêéËá™Âä®ËÆ°ÁÆó',
    form_loc_label:'‰∫§ÊòìÂú∞Âå∫',form_desc_label:'ËØ¶ÁªÜÊèèËø∞',
    form_tags_label:'Ê†áÁ≠æ',form_ai_label:'AI‰ª∑Ê†ºÈ¢ÑÊµã',
    btn_register:'Á´ãÂç≥ÂèëÂ∏É',
    like_add:'Â∑≤Âä†ÂÖ•Êî∂Ëóè ‚ù§Ô∏è',like_remove:'Â∑≤ÂèñÊ∂àÊî∂Ëóè',
  },
  vi:{code:'vi',name:'Ti·∫øng Vi·ªát',flag:'üáªüá≥',
    tab_home:'Trang ch·ªß',tab_search:'T√¨m ki·∫øm',tab_chat:'Chat',tab_me:'T√¥i',
    signup_title:'ƒêƒÉng k√Ω',form_title:'ƒêƒÉng k√Ω v·∫£i',
    fabric_info:'Th√¥ng tin v·∫£i',product_desc:'M√¥ t·∫£ s·∫£n ph·∫©m',
    chat_coming:'Ch·ª©c nƒÉng chat ƒëang chu·∫©n b·ªã',
    empty_msg:'Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£',
    registered:'S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω! üéâ',
    filter_Ï†ÑÏ≤¥:'T·∫•t c·∫£',filter_Î©¥:'Cotton',filter_Ìè¥Î¶¨:'Poly',filter_Ïö∏:'Len',
    filter_Î¶∞ÎÑ®:'Lanh',filter_Ïã§ÌÅ¨:'L·ª•a',filter_ÌòºÎ∞©:'Pha tr·ªôn',filter_Í∏∞ÌÉÄ:'Kh√°c',
    search_placeholder:'T√¨m v·∫£i, m√†u s·∫Øc, nh√† b√°n',
    detail_title:'Chi ti·∫øt s·∫£n ph·∫©m',manner_temp:'Nhi·ªát ƒë·ªô',
    lbl_type:'Lo·∫°i v·∫£i',lbl_color:'M√†u s·∫Øc',lbl_width:'Chi·ªÅu r·ªông',
    lbl_weight:'Tr·ªçng l∆∞·ª£ng',lbl_qty:'S·ªë l∆∞·ª£ng',lbl_price:'ƒê∆°n gi√°',lbl_unknown:'Kh√¥ng c√≥',
    stats_interest:'Y√™u th√≠ch',stats_chat:'Chat',
    res_title:'ƒê·∫∑t l·ªãch',
    res_visit:'ƒê·∫∑t thƒÉm',res_visit_sub:'ThƒÉm tr·ª±c ti·∫øp',
    res_swatch:'M·∫´u v·∫£i',res_swatch_sub:'G·ª≠i m·∫´u',
    res_inspect:'Ki·ªÉm ƒë·ªãnh',res_inspect_sub:'Chuy√™n gia thƒÉm',
    btn_reserve:'ƒê·∫∑t l·ªãch',btn_suggest:'ƒê·ªÅ xu·∫•t gi√°',btn_chat:'Chat',
    login_id_label:'Email',login_pw_label:'M·∫≠t kh·∫©u',
    btn_login:'ƒêƒÉng nh·∫≠p',btn_to_signup:'ƒêƒÉng k√Ω',test_account:'T√†i kho·∫£n test',
    signup_type_label:'Ch·ªçn lo·∫°i t√†i kho·∫£n',
    type_seller:'Ng∆∞·ªùi b√°n',type_seller_sub:'B√°n s·ªâ ¬∑ Thanh l√Ω',
    type_buyer:'Ng∆∞·ªùi mua',type_buyer_sub:'T√¨m ngu·ªìn ¬∑ Mua',
    type_brand:'Th∆∞∆°ng hi·ªáu',type_brand_sub:'Th∆∞∆°ng hi·ªáu th·ªùi trang',
    type_both:'Ki√™m nhi·ªám',type_both_sub:'V·ª´a mua v·ª´a b√°n',
    btn_join:'ƒêƒÉng k√Ω ngay',
    form_photo:'·∫¢nh s·∫£n ph·∫©m',form_photo_add:'Th√™m ·∫£nh',
    form_name_label:'T√™n s·∫£n ph·∫©m',form_cat_label:'Danh m·ª•c',
    form_type_label:'Lo·∫°i v·∫£i',form_color_label:'M√†u s·∫Øc',
    form_width_label:'Chi·ªÅu r·ªông (cm)',form_weight_label:'Tr·ªçng l∆∞·ª£ng (g/„é°)',
    form_qty_label:'S·ªë l∆∞·ª£ng (m)',form_price_label:'ƒê∆°n gi√° (‚Ç©/m)',
    form_total_label:'T·ªïng ti·ªÅn (t·ª± ƒë·ªông)',form_total_hint:'T·ª± ƒë·ªông t√≠nh t·ª´ s·ªë l∆∞·ª£ng v√† ƒë∆°n gi√°',
    form_loc_label:'Khu v·ª±c',form_desc_label:'M√¥ t·∫£',
    form_tags_label:'Hashtag',form_ai_label:'D·ª± ƒëo√°n gi√° AI',
    btn_register:'ƒêƒÉng b√°n',
    like_add:'ƒê√£ th√™m v√†o y√™u th√≠ch ‚ù§Ô∏è',like_remove:'ƒê√£ x√≥a kh·ªèi y√™u th√≠ch',
  },
};
let curLang='ko';
function t(k){return(LANGS[curLang]||LANGS.ko)[k]||k}
function setLang(code){
  curLang=code;
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const k=el.dataset.i18n;const v=t(k);if(v)el.textContent=v;
  });
  document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
    const v=t(el.dataset.i18nPh);if(v)el.placeholder=v;
  });
  renderLangButtons();
  renderChips();
  const emsg=document.getElementById('empty-msg');if(emsg)emsg.textContent=t('empty_msg');
  if(curProductId&&document.getElementById('view-detail').classList.contains('active')){
    openDetail(curProductId);
  }
}
function renderLangButtons(){
  const el=document.getElementById('lang-sel');if(!el)return;
  el.innerHTML=Object.values(LANGS).map(l=>`<button class="lang-btn ${l.code===curLang?'on':''}" onclick="setLang('${l.code}')">${l.flag} ${l.name}</button>`).join('');
}
function toggleLangPanel(){
  const p=document.getElementById('lang-panel');
  if(!p)return;
  p.style.display=p.style.display==='none'?'block':'none';
  renderLangButtons();
}

/* ==================== COLORS ==================== */
const FCOLORS={
  'Î©¥':['#E8D5C4','#C8DFE4','#D4E8C8','#2C3E50','#E8C8D4','#F2E8D0'],
  'Ìè¥Î¶¨':['#4A90D9','#B8D4F0','#D4B8F0','#F0B8B8','#B8F0D4','#F0D4B8'],
  'Ïö∏':['#8B4513','#4A2810','#A0522D','#CD853F','#D2691E','#DEB887'],
  'Î¶∞ÎÑ®':['#D2B48C','#BFA37A','#8B7355','#C8A882','#E0C8A0','#F5DEB3'],
  'Ïã§ÌÅ¨':['#FFD700','#DA70D6','#9370DB','#87CEEB','#FF69B4','#98FB98'],
  'ÌòºÎ∞©':['#7B8FA3','#5A6B7A','#3D5166','#9AA8B8','#6B7A8A','#B8C4CE'],
  'Í∏∞ÌÉÄ':['#95A5A6','#566573','#7F8C8D','#85929E','#A9B7BF','#BDC3C7'],
};
function getFColor(type,color){
  const p=FCOLORS[type]||FCOLORS['Í∏∞ÌÉÄ'];
  const i=Math.abs((color||'').split('').reduce((a,c)=>a+c.charCodeAt(0),0))%p.length;
  return p[i];
}
function getTexture(type){
  const m={'Î©¥':'repeating-linear-gradient(45deg,rgba(255,255,255,.06) 0px,rgba(255,255,255,.06) 2px,transparent 2px,transparent 8px)','Ìè¥Î¶¨':'repeating-linear-gradient(0deg,rgba(255,255,255,.05) 0px,rgba(255,255,255,.05) 1px,transparent 1px,transparent 4px)','Ïö∏':'repeating-linear-gradient(-45deg,rgba(0,0,0,.05) 0px,rgba(0,0,0,.05) 1px,transparent 1px,transparent 6px)','Î¶∞ÎÑ®':'repeating-linear-gradient(90deg,rgba(255,255,255,.07) 0px,rgba(255,255,255,.07) 1px,transparent 1px,transparent 5px),repeating-linear-gradient(0deg,rgba(255,255,255,.07) 0px,rgba(255,255,255,.07) 1px,transparent 1px,transparent 5px)','Ïã§ÌÅ¨':'linear-gradient(135deg,rgba(255,255,255,.3) 0%,rgba(255,255,255,0) 50%,rgba(255,255,255,.15) 100%)'};
  return m[type]||'none';
}
function fmtPrice(n){return n.toLocaleString('ko-KR')+'Ïõê'}

/* ==================== LOCAL STORAGE ==================== */
function lsGet(k,def){try{const v=localStorage.getItem('bium_'+k);return v?JSON.parse(v):def}catch{return def}}
function lsSet(k,v){try{localStorage.setItem('bium_'+k,JSON.stringify(v))}catch{}}
const _CACHE_TTL=5*60*1000;
function lsGetTTL(k){try{const raw=localStorage.getItem('bium_ttl_'+k);if(!raw)return null;const o=JSON.parse(raw);if(Date.now()-o.__t>_CACHE_TTL)return null;return o.__v}catch{return null}}
function lsSetTTL(k,v){try{localStorage.setItem('bium_ttl_'+k,JSON.stringify({__v:v,__t:Date.now()}))}catch{}}
function lsDelTTL(k){try{localStorage.removeItem('bium_ttl_'+k)}catch{}}

/* ==================== SUPABASE ==================== */
const _SB_URL='https://ygernyfkydqalqmjzjbw.supabase.co';
const _SB_KEY='sb_publishable_CIC03pgTltIAwP24vpZXyQ_6QEajQ2_';
let _sb=null;
try{
  if(typeof window.supabase!=='undefined'){
    _sb=window.supabase.createClient(_SB_URL,_SB_KEY);
    _sb.auth.onAuthStateChange((event)=>{
      if(event==='SIGNED_OUT'&&typeof curUser!=='undefined'&&curUser&&curUser.email!=='admin'){
        curUser=null;lsSet('curUser',null);showView('login');
      }
    });
  }else{
    console.warn('Supabase SDK Î°úÎìú Ïã§Ìå® ‚Äî Î°úÏª¨ Î™®ÎìúÎ°ú ÎèôÏûëÌï©ÎãàÎã§.');
  }
}catch(e){
  console.error('Supabase Ï¥àÍ∏∞Ìôî Ïò§Î•ò:',e);
  _sb=null;
}

/* ==================== USERS ==================== */
const DEFAULT_USERS=[
  {id:'admin',name:'Í¥ÄÎ¶¨Ïûê',email:'admin',pw:'1234',type:'admin',loc:'ÏÑúÏö∏ ÎèôÎåÄÎ¨∏Íµ¨',temp:99.9,joinDate:'2024-01-01'},
  {id:'s1',name:'ÏóêÏù¥ÏõêÏõêÎã®',email:'seller@test.com',pw:'1234',type:'seller',loc:'ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏÑ±ÏàòÎèô',temp:38.2,joinDate:'2024-02-15',
   intro:'ÎèôÎåÄÎ¨∏ 20ÎÖÑ Í≤ΩÎ†• ÏõêÎã® ÎèÑÎß§ÏóÖÏ≤¥ÏûÖÎãàÎã§. Î©¥/Ìè¥Î¶¨ Ï§ëÏã¨ÏúºÎ°ú Ïû¨Í≥†ÏõêÎã®ÏùÑ Ìï©Î¶¨Ï†ÅÏù∏ Í∞ÄÍ≤©Ïóê Í≥µÍ∏âÌï©ÎãàÎã§.',
   bizName:'(Ï£º)ÏóêÏù¥ÏõêÌÖçÏä§ÌÉÄÏùº',ceo:'ÍπÄÏóêÏù¥Ïõê',tel:'02-1234-5678'},
  {id:'b1',name:'Ìå®ÏÖòÍµ¨Îß§ÌåÄ',email:'buyer@test.com',pw:'1234',type:'buyer',loc:'ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ Ïó≠ÏÇºÎèô',temp:36.5,joinDate:'2024-03-10'},
];
let users=lsGet('users',DEFAULT_USERS);
let curUser=lsGet('curUser',null);

function findUser(email,pw){return users.find(u=>u.email===email&&u.pw===pw)}

/* ==================== PRODUCTS ==================== */
const SELLERS_SAMPLE=[
  {id:'s1',name:'ÏóêÏù¥ÏõêÏõêÎã®',temp:38.2,loc:'ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏÑ±ÏàòÎèô'},
  {id:'s2',name:'ÏßÅÎ¨ºÎÇòÎùº',temp:36.5,loc:'ÏÑúÏö∏ Ï¢ÖÎ°úÍµ¨ Ï∞ΩÏã†Îèô'},
  {id:'s3',name:'Ìå®ÏÖòÌå©ÌÜ†Î¶¨',temp:42.1,loc:'Î∂ÄÏÇ∞ Ï§ëÍµ¨ Í¥ëÎ≥µÎèô'},
  {id:'s4',name:'Ïã§Í≥ºÎ∞îÎäò',temp:35.0,loc:'ÎåÄÍµ¨ Ï§ëÍµ¨ ÎèôÏÑ±Î°ú'},
  {id:'s5',name:'ÌÖçÏä§ÌÉÄÏùºÎû©',temp:44.7,loc:'ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÎßùÏõêÎèô'},
];
const DEFAULT_PRODUCTS=[
  {id:1,title:'ÏÜåÌîÑÌä∏ ÏïÑÏù¥Î≥¥Î¶¨ Î©¥ ÏõêÎã® Ïû¨Í≥† Ï≤òÎ∂Ñ',type:'Î©¥',color:'ÏïÑÏù¥Î≥¥Î¶¨',width:150,weight:120,qty:45,price:4500,loc:'ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏÑ±ÏàòÎèô',cat:'Ï≤úÏó∞ÏÑ¨Ïú†',description:'Íµ≠ÎÇ¥ ÎåÄÌòï ÏùòÎ•ò Î∏åÎûúÎìú OEM ÏÉùÏÇ∞ ÌõÑ ÎÇ®ÏùÄ Ïû¨Í≥† ÏõêÎã®ÏûÖÎãàÎã§. 40Ïàò Î©¥ ÏÜåÏû¨Î°ú Î∂ÄÎìúÎüΩÍ≥† ÎÇ¥Íµ¨ÏÑ±Ïù¥ Ï¢ãÏäµÎãàÎã§. Ïó¨Î¶Ñ ÏùòÎ•ò, ÏÜçÏò∑, Ïπ®Íµ¨Î•ò Îì± Îã§ÏñëÌïòÍ≤å ÌôúÏö© Í∞ÄÎä•Ìï©ÎãàÎã§.',tags:['Ïû¨Í≥†ÏõêÎã®','Î©¥ÏõêÎã®','ÏïÑÏù¥Î≥¥Î¶¨','ÏÜåÎüâÍ∞ÄÎä•','ÏßÅÍ±∞Îûò'],seller:SELLERS_SAMPLE[0],imgs:3,likes:12,chats:5,time:'3ÏãúÍ∞Ñ Ï†Ñ',liked:false},
  {id:2,title:'ÏãúÏõêÌïú ÎÑ§Ïù¥ÎπÑ Ìè¥Î¶¨ Ïâ¨Ìè∞ ÏõêÎã® 50m',type:'Ìè¥Î¶¨',color:'ÎÑ§Ïù¥ÎπÑ',width:110,weight:80,qty:50,price:2800,loc:'ÏÑúÏö∏ Ï¢ÖÎ°úÍµ¨ Ï∞ΩÏã†Îèô',cat:'Ìï©ÏÑ±ÏÑ¨Ïú†',description:'Ïó¨Î¶Ñ Î∏îÎùºÏö∞Ïä§ ÏÉùÏÇ∞Ïóê ÏÇ¨Ïö©ÌïòÎ†§Îã§ ÎÇ®ÏùÄ Ïû¨Í≥†ÏûÖÎãàÎã§. ÌÜµÍ∏∞ÏÑ±Ïù¥ Ï¢ãÍ≥† Í∞ÄÎ≤ºÏö¥ Ïâ¨Ìè∞ ÏÜåÏû¨Î°ú ÎìúÎ†àÏä§, Ïä§Ïπ¥ÌîÑ, Ïª§Ìäº Îì±Ïóê Ï†ÅÌï©Ìï©ÎãàÎã§.',tags:['Ìè¥Î¶¨Ïâ¨Ìè∞','ÎÑ§Ïù¥ÎπÑ','Ïó¨Î¶ÑÏõêÎã®','50m'],seller:SELLERS_SAMPLE[1],imgs:2,likes:8,chats:3,time:'5ÏãúÍ∞Ñ Ï†Ñ',liked:false},
  {id:3,title:'Í≥†Í∏â Î≤ÑÍ±¥Îîî Ïö∏ ÏõêÎã® 20m ÌäπÍ∞Ä',type:'Ïö∏',color:'Î≤ÑÍ±¥Îîî',width:150,weight:320,qty:20,price:18000,loc:'Î∂ÄÏÇ∞ Ï§ëÍµ¨ Í¥ëÎ≥µÎèô',cat:'Ï≤úÏó∞ÏÑ¨Ïú†',description:'Ïù¥ÌÉàÎ¶¨ÏïÑÏÇ∞ Ïö∏ ÏõêÎã® ÏàòÏûÖ ÌõÑ ÎÇ®ÏùÄ Ïû¨Í≥†ÏûÖÎãàÎã§. ÏµúÍ≥†Í∏â Î©îÎ¶¨ÎÖ∏ Ïö∏ ÏÜåÏû¨Î°ú Í∞ÄÏùÑ¬∑Í≤®Ïö∏ ÏΩîÌä∏, Ïû¨ÌÇ∑ Ï†úÏûëÏóê ÏµúÏ†ÅÏûÖÎãàÎã§.',tags:['Ïö∏ÏõêÎã®','Î≤ÑÍ±¥Îîî','Í≥†Í∏âÏõêÎã®','Ïù¥ÌÉàÎ¶¨ÏïÑÏÇ∞','ÏΩîÌä∏Í∞ê'],seller:SELLERS_SAMPLE[2],imgs:4,likes:24,chats:11,time:'Ïñ¥Ï†ú',liked:false},
  {id:4,title:'ÎÇ¥Ï∂îÎü¥ Î≤†Ïù¥ÏßÄ Î¶∞ÎÑ® ÏõêÎã® ÏÑ∏Ïùº',type:'Î¶∞ÎÑ®',color:'Î≤†Ïù¥ÏßÄ',width:140,weight:160,qty:35,price:6000,loc:'ÎåÄÍµ¨ Ï§ëÍµ¨ ÎèôÏÑ±Î°ú',cat:'Ï≤úÏó∞ÏÑ¨Ïú†',description:'Î¥Ñ¬∑Ïó¨Î¶Ñ ÏãúÏ¶å Ï§ÄÎπÑÎ°ú Îì§Ïó¨Ïò® Î¶∞ÎÑ® ÏõêÎã®ÏûÖÎãàÎã§. Ï≤úÏó∞ ÏÜåÏû¨ ÌäπÏú†Ïùò ÏßàÍ∞êÍ≥º ÏãúÏõêÌï®Ïù¥ ÌäπÏßïÏù¥Î©∞, ÏùòÎ•òÎøê ÏïÑÎãàÎùº Ìôà Ïù∏ÌÖåÎ¶¨Ïñ¥ Ìå®Î∏åÎ¶≠ÏúºÎ°úÎèÑ Ïù∏Í∏∞Í∞Ä ÎßéÏùÄ ÏÜåÏû¨ÏûÖÎãàÎã§.',tags:['Î¶∞ÎÑ®','Î≤†Ïù¥ÏßÄ','ÎÇ¥Ï∂îÎü¥','Î¥ÑÏó¨Î¶Ñ'],seller:SELLERS_SAMPLE[3],imgs:2,likes:18,chats:7,time:'1Ïùº Ï†Ñ',liked:false},
  {id:5,title:'Í¥ëÌÉù ÏÉ¥ÌéòÏù∏ Ïã§ÌÅ¨ ÏÉàÌã¥ 15m',type:'Ïã§ÌÅ¨',color:'ÏÉ¥ÌéòÏù∏Í≥®Îìú',width:114,weight:90,qty:15,price:35000,loc:'ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÎßùÏõêÎèô',cat:'Ï≤úÏó∞ÏÑ¨Ïú†',description:'Ïõ®Îî©ÎìúÎ†àÏä§ Ï†úÏûë ÌõÑ ÎÇ®ÏùÄ Í≥†Í∏â Ïã§ÌÅ¨ ÏÉàÌã¥ ÏõêÎã®ÏûÖÎãàÎã§. Í¥ëÌÉùÏù¥ Ïö∞ÏàòÌïòÍ≥† ÎìúÎ†àÏù¥ÌîÑÏÑ±Ïù¥ Îõ∞Ïñ¥ÎÇ©ÎãàÎã§.',tags:['Ïã§ÌÅ¨ÏÉàÌã¥','ÏÉ¥ÌéòÏù∏','Ïõ®Îî©ÏõêÎã®','Í≥†Í∏â','Ïù¥Î∏åÎãù'],seller:SELLERS_SAMPLE[4],imgs:5,likes:31,chats:15,time:'2Ïùº Ï†Ñ',liked:false},
  {id:6,title:'Î™®Îã¨ ÌòºÎ∞© Ï∞®ÏΩú Í∏∞Î™® ÏõêÎã® 60m',type:'ÌòºÎ∞©',color:'Ï∞®ÏΩúÍ∑∏Î†àÏù¥',width:160,weight:280,qty:60,price:5500,loc:'Ïù∏Ï≤ú ÎÇ®ÎèôÍµ¨ Íµ¨ÏõîÎèô',cat:'ÌòºÎ∞©',description:'Î™®Îã¨ 60% + Ìè¥Î¶¨ 40% ÌòºÎ∞© Í∏∞Î™® ÏõêÎã®ÏûÖÎãàÎã§. Î∂ÄÎìúÎü¨Ïö¥ Ï¥âÍ∞êÍ≥º Î≥¥Ïò®ÏÑ±Ïù¥ Îõ∞Ïñ¥ÎÇò Í≤®Ïö∏Ïö© ÎÇ¥Ïùò, Ìä∏Î†àÏù¥ÎãùÎ≥µÏóê Ï†ÅÌï©Ìï©ÎãàÎã§.',tags:['ÌòºÎ∞©','Í∏∞Î™®','Î™®Îã¨','Í≤®Ïö∏ÏõêÎã®','ÎåÄÎüâÌï†Ïù∏'],seller:SELLERS_SAMPLE[0],imgs:3,likes:9,chats:4,time:'2Ïùº Ï†Ñ',liked:false},
  {id:7,title:'ÎπàÌã∞ÏßÄ Ïù∏ÎîîÍ≥† Îç∞Îãò ÏõêÎã® 25m',type:'Î©¥',color:'Ïù∏ÎîîÍ≥†Î∏îÎ£®',width:150,weight:340,qty:25,price:8500,loc:'ÏÑúÏö∏ ÎèôÎåÄÎ¨∏Íµ¨ Ïã†ÏÑ§Îèô',cat:'Ï≤úÏó∞ÏÑ¨Ïú†',description:'ÏÖÄÎπÑÏßÄ Îç∞Îãò ÎäêÎÇåÏùò Ïù∏ÎîîÍ≥† Î∏îÎ£® Î©¥ ÏõêÎã®ÏûÖÎãàÎã§. Ï≤≠Î∞îÏßÄ, Ïû¨ÌÇ∑, Í∞ÄÎ∞© Îì± Îç∞Îãò ÏïÑÏù¥ÌÖú Ï†úÏûëÏóê Ï†ÅÌï©Ìï©ÎãàÎã§.',tags:['Îç∞Îãò','Ïù∏ÎîîÍ≥†','Î©¥ÏõêÎã®','Ï≤≠Î∞îÏßÄÍ∞ê'],seller:SELLERS_SAMPLE[1],imgs:2,likes:22,chats:9,time:'3Ïùº Ï†Ñ',liked:false},
  {id:8,title:'ÌååÏä§ÌÖî ÎØºÌä∏ Í∏∞Îä•ÏÑ± Ìè¥Î¶¨ ÏóêÏñ¥Î°ú 80m',type:'Ìè¥Î¶¨',color:'ÎØºÌä∏',width:155,weight:100,qty:80,price:3200,loc:'Í≤ΩÍ∏∞ ÏïàÏñëÏãú ÎßåÏïàÍµ¨',cat:'Ìï©ÏÑ±ÏÑ¨Ïú†',description:'Ïä§Ìè¨Ï∏†Ïõ®Ïñ¥ Î∏åÎûúÎìú ÏÉùÏÇ∞ ÌõÑ ÎÇ®ÏùÄ ÏóêÏñ¥Î°ú Í∏∞Îä•ÏÑ± ÏõêÎã®ÏûÖÎãàÎã§. Ìù°ÏäµÏÜçÍ±¥ Í∏∞Îä•Ïù¥ ÏûàÏñ¥ Ïö¥ÎèôÎ≥µ, ÏïÑÏõÉÎèÑÏñ¥ ÏùòÎ•òÏóê Ï†ÅÌï©Ìï©ÎãàÎã§.',tags:['Ìè¥Î¶¨','Í∏∞Îä•ÏÑ±ÏõêÎã®','Ìù°ÏäµÏÜçÍ±¥','Ïä§Ìè¨Ï∏†','ÎåÄÎüâ'],seller:SELLERS_SAMPLE[2],imgs:3,likes:6,chats:2,time:'3Ïùº Ï†Ñ',liked:false},
  {id:9,title:'Î°úÏ¶à Ïö∏ Ìó§ÎßÅÎ≥∏ ÏõêÎã® ÏÜåÎüâ 10m',type:'Ïö∏',color:'Î°úÏ¶àÌïëÌÅ¨',width:150,weight:290,qty:10,price:22000,loc:'ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ Ïó≠ÏÇºÎèô',cat:'Ï≤úÏó∞ÏÑ¨Ïú†',description:'ÏòÅÍµ≠ÏÇ∞ Ïö∏ Ìó§ÎßÅÎ≥∏ Ìå®ÌÑ¥ ÏõêÎã®ÏûÖÎãàÎã§. ÌÅ¥ÎûòÏãùÌïú Ìó§ÎßÅÎ≥∏ Ìå®ÌÑ¥ÏúºÎ°ú ÏΩîÌä∏, Î∏îÎ†àÏù¥Ï†Ä, Ïä§Ïª§Ìä∏Ïóê ÌôúÏö©ÌïòÍ∏∞ Ï¢ãÏäµÎãàÎã§.',tags:['Ïö∏Ìó§ÎßÅÎ≥∏','Î°úÏ¶à','ÏòÅÍµ≠ÏÇ∞','ÏΩîÌä∏Í∞ê','ÏÜåÎüâ'],seller:SELLERS_SAMPLE[3],imgs:4,likes:27,chats:13,time:'4Ïùº Ï†Ñ',liked:false},
  {id:10,title:'ÎÇ¥Ï∂îÎü¥ Í∑∏Î†àÏù¥ Î¶∞ÎÑ® ÌòºÎ∞© 40m',type:'Î¶∞ÎÑ®',color:'ÎùºÏù¥Ìä∏Í∑∏Î†àÏù¥',width:135,weight:175,qty:40,price:7500,loc:'Î∂ÄÏÇ∞ ÎèôÎûòÍµ¨ Ïò®Ï≤úÎèô',cat:'ÌòºÎ∞©',description:'Î¶∞ÎÑ® 55% + Î©¥ 45% ÌòºÎ∞© ÏõêÎã®ÏûÖÎãàÎã§. Î¶∞ÎÑ®Ïùò ÏãúÏõêÌï®Í≥º Î©¥Ïùò Î∂ÄÎìúÎü¨ÏõÄÏùÑ Ìï®Íªò ÎäêÎÇÑ Ïàò ÏûàÏúºÎ©∞ ÌôàÏõ®Ïñ¥, Ïó¨Î¶Ñ ÏÖîÏ∏†Ïóê Ï†ÅÌï©Ìï©ÎãàÎã§.',tags:['Î¶∞ÎÑ®ÌòºÎ∞©','Í∑∏Î†àÏù¥','ÌôàÏõ®Ïñ¥','Ïó¨Î¶Ñ'],seller:SELLERS_SAMPLE[4],imgs:2,likes:14,chats:6,time:'5Ïùº Ï†Ñ',liked:false},
];
let products=lsGet('products',DEFAULT_PRODUCTS);
function saveProducts(){lsSet('products',products)}
async function loadProductsFromSupabase(){
  if(!_sb)return;
  const cached=lsGetTTL('products_sb');
  if(cached&&cached.length){products=cached;renderList();return;}
  showListSkeleton();
  try{
    const{data,error}=await _sb.from('products').select('*').order('created_at',{ascending:false});
    if(error){console.error('[loadProducts] Ïò§Î•ò:',error);return;}
    const likedMap=lsGet('likedMap',{});
    if(!data||data.length===0){
      // Supabase ÎπÑÏñ¥ÏûàÏúºÎ©¥ ÏÉòÌîå Îç∞Ïù¥ÌÑ∞Î•º SupabaseÏóê ÏûêÎèô insert
      try{
        const samplePayloads=DEFAULT_PRODUCTS.map(p=>({
          title:p.title,type:p.type,color:p.color,width:p.width,weight:p.weight,
          qty:p.qty,price:p.price,loc:p.loc,cat:p.cat,description:p.description,
          tags:p.tags,seller:p.seller,imgs:p.imgs,likes:p.likes,chats:p.chats,time:p.time
        }));
        console.log('[loadProducts] ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ 10Í∞ú Supabase insert ÏãúÏûë...');
        const{data:inserted,error:insertErr}=await _sb.from('products').insert(samplePayloads).select();
        if(insertErr){
          console.error('[loadProducts] ÏÉòÌîå insert Ïò§Î•ò:',insertErr);
          products=DEFAULT_PRODUCTS.map(p=>({...p,liked:!!likedMap[p.id]}));
        }else{
          console.log('[loadProducts] ÏÉòÌîå insert ÏôÑÎ£å:', inserted?.length,'Í∞ú');
          products=(inserted||[]).map(p=>({
            ...p,
            seller:p.seller||{name:'ÏïåÏàòÏóÜÏùå',temp:36.5,loc:''},
            tags:Array.isArray(p.tags)?p.tags:(p.tags?p.tags.split(','):[]),
            liked:false,time:p.time||'Î∞©Í∏à Ï†Ñ',likes:p.likes||0,chats:p.chats||0,imgs:p.imgs||1,
          }));
        }
      }catch(insertEx){
        console.error('[loadProducts] ÏÉòÌîå insert ÏòàÏô∏:',insertEx);
        products=DEFAULT_PRODUCTS.map(p=>({...p,liked:!!likedMap[p.id]}));
      }
      lsSet('products',products);lsSetTTL('products_sb',products);
      renderList();
      return;
    }
    products=data.map(p=>({
      ...p,
      seller:p.seller||{name:'ÏïåÏàòÏóÜÏùå',temp:36.5,loc:''},
      tags:Array.isArray(p.tags)?p.tags:(p.tags?p.tags.split(','):[]),
      liked:!!likedMap[p.id],
      time:p.time||'Î∞©Í∏à Ï†Ñ',
      likes:p.likes||0,
      chats:p.chats||0,
      imgs:p.imgs||1,
    }));
    lsSet('products',products);lsSetTTL('products_sb',products);
    renderList();
  }catch(e){console.error('[loadProducts] ÏòàÏô∏:',e);}
}

/* ==================== STATE ==================== */
let curFilter='Ï†ÑÏ≤¥';
let curSearch='';
let curProductId=null;
let prevView='list';
let sliderIdx=0;
let sliderTotal=0;
let uploadedImgs=[];
let curResType='visit';
let curSellerData=null;
let selectedUserType='seller';
let svSearch='';
let svFilter='Ï†ÑÏ≤¥';
let recentSearches=lsGet('recentSearches',[]);
let chatRooms=lsGet('chatRooms',{});
let curChatRoomId=null;
let notifSettings=lsGet('notifSettings',{newMsg:true,reservation:true,priceChange:false,event:false});

/* ==================== AI IMAGE ANALYSIS ==================== */
function compressImage(dataUrl,maxSize=400,quality=0.7){
  return new Promise(resolve=>{
    const img=new Image();
    img.onload=()=>{
      const canvas=document.createElement('canvas');
      const ratio=Math.min(maxSize/img.width,maxSize/img.height,1);
      canvas.width=Math.round(img.width*ratio);
      canvas.height=Math.round(img.height*ratio);
      canvas.getContext('2d').drawImage(img,0,0,canvas.width,canvas.height);
      resolve(canvas.toDataURL('image/jpeg',quality));
    };
    img.onerror=()=>resolve(dataUrl);
    img.src=dataUrl;
  });
}
async function analyzeImageWithAI(dataUrl){
  const base64=dataUrl.split(',')[1];
  const mediaType=dataUrl.startsWith('data:image/png')?'image/png':'image/jpeg';
  try{
    // Vercel Edge FunctionÏúºÎ°ú ÌîÑÎ°ùÏãú ‚Äî API ÌÇ§Îäî ÏÑúÎ≤ÑÏóêÏÑúÎßå ÏÇ¨Ïö©
    const res=await fetch('/api/analyze-image',{
      method:'POST',
      headers:{'content-type':'application/json'},
      body:JSON.stringify({base64,mediaType})
    });
    if(!res.ok)return null;
    const data=await res.json();
    return data.result||null;
  }catch(e){console.warn('[AIÎ∂ÑÏÑù] Ïò§Î•ò:',e);return null;}
}
async function runAIAnalysis(dataUrl){
  const hint=document.getElementById('ai-hint-text');
  hint.textContent='ü§ñ Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë...';
  try{
    const result=await analyzeImageWithAI(dataUrl);
    if(!result){hint.textContent='AI Î∂ÑÏÑùÏóê Ïã§Ìå®ÌñàÏñ¥Ïöî. ÏßÅÏ†ë ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';return;}
    if(result.type){
      const sel=document.getElementById('f-type');
      for(let i=0;i<sel.options.length;i++){if(sel.options[i].value===result.type){sel.selectedIndex=i;break;}}
    }
    if(result.color)document.getElementById('f-color').value=result.color;
    if(result.weight)document.getElementById('f-weight').value=result.weight;
    hint.textContent=`‚úÖ AI ÏûêÎèô ÏûÖÎ†• ÏôÑÎ£å! ÏõêÎã®:${result.type||'?'} ÏÉâÏÉÅ:${result.color||'?'} Ï§ëÎüâ:${result.weight?result.weight+'g/„é°':'?'} ‚Äî ÌôïÏù∏ ÌõÑ ÏàòÏ†ïÌïòÏÑ∏Ïöî`;
  }catch(e){hint.textContent='AI Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏñ¥Ïöî. ÏßÅÏ†ë ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';}
}

/* ==================== AI VIEW ==================== */
let aiViewImgData='';
function handleAiUpload(e){
  const file=e.target.files[0];if(!file)return;
  const r=new FileReader();
  r.onload=ev=>{
    aiViewImgData=ev.target.result;
    const area=document.getElementById('ai-upload-area');
    area.innerHTML=`<img src="${aiViewImgData}" alt="ÏóÖÎ°úÎìúÎêú ÏõêÎã® Ïù¥ÎØ∏ÏßÄ"/>`;
    area.classList.add('has-img');
    const btn=document.getElementById('ai-analyze-btn');
    if(btn)btn.disabled=false;
  };
  r.readAsDataURL(file);
  e.target.value='';
}
function resetAiView(){
  aiViewImgData='';
  const area=document.getElementById('ai-upload-area');
  if(area){
    area.className='ai-upload-area';
    area.innerHTML='<div class="ai-camera-icon">üì∑</div><div class="ai-upload-hint">ÏõêÎã® ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî</div><div class="ai-upload-sub">JPG / PNG ¬∑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù</div>';
  }
  const btn=document.getElementById('ai-analyze-btn');
  if(btn){btn.disabled=true;btn.textContent='AI Î∂ÑÏÑù ÏãúÏûë';}
  const result=document.getElementById('ai-result-card');
  if(result)result.classList.remove('show');
}
async function startAiAnalysis(){
  if(!aiViewImgData){showToast('Ïù¥ÎØ∏ÏßÄÎ•º Î®ºÏ†Ä ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî');return;}
  const btn=document.getElementById('ai-analyze-btn');
  btn.disabled=true;btn.textContent='Î∂ÑÏÑù Ï§ë...';
  const result=document.getElementById('ai-result-card');
  result.innerHTML='<div class="ai-loading">‚ú® AIÍ∞Ä ÏõêÎã®ÏùÑ Î∂ÑÏÑùÌïòÍ≥† ÏûàÏñ¥Ïöî...</div>';
  result.classList.add('show');
  const data=await analyzeImageWithAI(aiViewImgData);
  btn.textContent='AI Î∂ÑÏÑù ÏãúÏûë';btn.disabled=false;
  if(!data){
    result.innerHTML='<div class="ai-loading" style="color:#ff6584">Î∂ÑÏÑùÏóê Ïã§Ìå®ÌñàÏñ¥Ïöî. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.</div>';
    return;
  }
  const type=data.type||'Ïïå Ïàò ÏóÜÏùå';
  const color=data.color||'-';
  const weight=data.weight?data.weight+'g/„é°':'-';
  const ranges={Î©¥:[3000,8000],Ìè¥Î¶¨:[2000,6000],Ïö∏:[12000,35000],Î¶∞ÎÑ®:[5000,12000],Ïã§ÌÅ¨:[20000,80000],ÌòºÎ∞©:[4000,10000],Í∏∞ÌÉÄ:[2000,15000]};
  const [lo,hi]=ranges[type]||[2000,20000];
  const priceStr=lo.toLocaleString()+'~'+hi.toLocaleString()+'Ïõê/m';
  const gaugeVal=Math.round(Math.random()*25+55);
  const strategies={Î©¥:'Ïó¨Î¶Ñ ÏùòÎ•ò ÏãúÏû• Ï†ÅÍ∏∞. ÏÜåÎüâ Ìå®ÌÇ§ÏßÄÎ°ú Î¨∂Ïñ¥ ÌåêÎß§ Ïãú Îã®Í∞Ä ÏÉÅÏäπ Ìö®Í≥ºÍ∞Ä ÏûàÏñ¥Ïöî.',Ìè¥Î¶¨:'Ï†ÑÏ≤úÌõÑ ÏõêÎã®ÏúºÎ°ú Îπ†Î•∏ ÌöåÏ†ÑÏú®. ÏÉâÏÉÅÎ≥Ñ Î∂ÑÎ•ò ÌåêÎß§Î•º Ï∂îÏ≤úÌï¥Ïöî.',Ïö∏:'Í≤®Ïö∏ ÏãúÏ¶å ÏàòÏöî ÏßëÏ§ë. 3~4m ÏÜåÎ∂Ñ ÌåêÎß§Î°ú Ï†ëÍ∑ºÏÑ±ÏùÑ ÎÜíÏù¥ÏÑ∏Ïöî.',Î¶∞ÎÑ®:'ÏπúÌôòÍ≤Ω Ìä∏Î†åÎìú ÏàòÌòú. ÏπúÌôòÍ≤Ω¬∑Ïó¨Î¶Ñ ÌÇ§ÏõåÎìú ÌÉúÍπÖÏù¥ ÌïÑÏàòÏòàÏöî.',Ïã§ÌÅ¨:'Í≥†Í∏â ÏãúÏû• ÌÉÄÍ≤ü. Î∏åÎûúÎìú¬∑ÎîîÏûêÏù¥ÎÑà Ï±ÑÎÑê ÏßÅÏ†ë Ïó∞ÎùΩ Ï†ÑÎûµÏùÑ Ï∂îÏ≤úÌï¥Ïöî.',ÌòºÎ∞©:'Í∞ÄÏÑ±ÎπÑ Ìè¨ÏßÄÏÖîÎãùÏù¥ Ïú†Î¶¨Ìï¥Ïöî. Ïö©ÎèÑÎ≥Ñ Î∂ÑÎ•òÎ°ú Íµ¨Îß§Ïûê ÏÑ†ÌÉùÏùÑ Ïö©Ïù¥ÌïòÍ≤å Ìï¥Ï£ºÏÑ∏Ïöî.'};
  const strategy=strategies[type]||'ÏãúÏû• ÏàòÏöîÎ•º ÌôïÏù∏ ÌõÑ ÏÜåÎüâÏúºÎ°ú Î®ºÏ†Ä ÌåêÎß§Ìï¥Î≥¥ÏÑ∏Ïöî.';
  result.innerHTML=`
    <div class="ai-result-title">‚ú® AI Î∂ÑÏÑù Í≤∞Í≥º</div>
    <div class="ai-result-row"><span class="ai-result-label">ÏõêÎã® Ï¢ÖÎ•ò</span><span class="ai-result-val ai-result-highlight">${type}</span></div>
    <div class="ai-result-row"><span class="ai-result-label">ÏÉâÏÉÅ</span><span class="ai-result-val">${color}</span></div>
    <div class="ai-result-row"><span class="ai-result-label">Ï§ëÎüâ</span><span class="ai-result-val">${weight}</span></div>
    <div class="ai-result-row"><span class="ai-result-label">Ï†ÅÏ†ï Í∞ÄÍ≤©</span><span class="ai-result-val ai-result-highlight">${priceStr}</span></div>
    <div class="ai-result-row">
      <span class="ai-result-label">ÏãúÏÑ∏ ÎåÄÎπÑ</span>
      <div class="ai-gauge-wrap">
        <div class="ai-gauge"><div class="ai-gauge-fill" style="width:0%" id="ai-gf"></div></div>
        <span style="font-size:11px;color:#6c63ff;font-weight:700">${gaugeVal}%</span>
      </div>
    </div>
    <div class="ai-strategy-box">
      <div class="ai-strategy-title">üìä ÌåêÎß§ Ï†ÑÎûµ Ï∂îÏ≤ú</div>
      <div class="ai-strategy-text">${strategy}</div>
    </div>
  `;
  setTimeout(()=>{const gf=document.getElementById('ai-gf');if(gf)gf.style.width=gaugeVal+'%';},100);
}

/* ==================== TOAST ==================== */
function showToast(msg){
  const el=document.getElementById('toast');
  el.textContent=msg;el.classList.add('show');
  clearTimeout(el._t);el._t=setTimeout(()=>el.classList.remove('show'),2200);
}

/* ==================== VIEW ==================== */
function showView(name){
  const prev=document.querySelector('.view.active');
  if(prev)prevView=prev.id.replace('view-','');
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  const target=document.getElementById('view-'+name);
  if(target){target.classList.add('active');window.scrollTo(0,0)}
  if(name==='list')renderList();
  if(name==='mypage')renderMypage();
  if(name==='admin')renderAdmin('overview');
  if(name==='analytics')renderAnalytics();
  if(name==='search-view')renderSearchView();
  if(name==='chat')renderChatList();
  if(name==='wishlist')renderWishlist();
  if(name==='chat-room')renderChatRoom(curChatRoomId);
  if(name==='reservations')renderReservations();
  if(name==='notif-settings')renderNotifSettings();
  if(name==='profile-edit')renderProfileEdit();
  if(name==='ai')resetAiView();
}
function goBack(){showView(prevView||'list')}

/* ==================== AUTH ==================== */
async function doLogin(){
  const email=document.getElementById('l-email').value.trim();
  const pw=document.getElementById('l-pw').value;
  // Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ï ÌäπÎ≥Ñ Ï≤òÎ¶¨ (Î°úÏª¨ Í≤ÄÏ¶ù)
  if(email==='admin'){
    const admin=DEFAULT_USERS.find(u=>u.email==='admin'&&u.pw===pw);
    if(!admin){showToast('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏Ïñ¥Ïöî');return;}
    curUser=admin;lsSet('curUser',curUser);showView('admin');return;
  }
  // Supabase ÎØ∏Ïó∞Í≤∞ Ïãú Î°úÏª¨ fallback
  if(!_sb){
    const user=findUser(email,pw);
    if(!user){showToast('Ïù¥Î©îÏùº ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏Ïñ¥Ïöî');return;}
    curUser=user;lsSet('curUser',curUser);
    if(user.type==='admin')showView('admin');else{showView('list');showListSkeleton();}
    return;
  }
  try{
    const{data,error}=await _sb.auth.signInWithPassword({email,password:pw});
    if(error){showToast('Ïù¥Î©îÏùº ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏Ïñ¥Ïöî');return;}
    const{data:profile}=await _sb.from('users').select('*').eq('id',data.user.id).single();
    curUser=profile||{id:data.user.id,email,name:email,type:'buyer',temp:36.5,loc:'',joinDate:data.user.created_at?.slice(0,10)||''};
    lsSet('curUser',curUser);
    if(curUser.type==='admin')showView('admin');else{showView('list');showListSkeleton();loadProductsFromSupabase();}
  }catch(e){showToast('Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏñ¥Ïöî');console.error(e);}
}
async function doSignup(){
  const name=document.getElementById('s-name').value.trim();
  const email=document.getElementById('s-email').value.trim();
  const pw=document.getElementById('s-pw').value;
  const loc=document.getElementById('s-loc').value.trim();
  if(!name||!email||!pw){showToast('ÌïÑÏàò Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');return;}
  if(pw.length<6){showToast('ÎπÑÎ∞ÄÎ≤àÌò∏Îäî 6Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï¥Ïöî');return;}
  // Supabase ÎØ∏Ïó∞Í≤∞ Ïãú Î°úÏª¨ fallback
  if(!_sb){
    if(users.find(u=>u.email===email)){showToast('Ïù¥ÎØ∏ ÏÇ¨Ïö© Ï§ëÏù∏ Ïù¥Î©îÏùºÏù¥ÏóêÏöî');return;}
    const newUser={id:'u'+Date.now(),name,email,pw,type:selectedUserType,loc,temp:36.5,joinDate:new Date().toISOString().slice(0,10)};
    users.push(newUser);lsSet('users',users);
    curUser=newUser;lsSet('curUser',curUser);
    showToast('Í∞ÄÏûÖ ÏôÑÎ£å! ÌôòÏòÅÌï¥Ïöî üéâ');showView('list');return;
  }
  try{
    const{data,error}=await _sb.auth.signUp({email,password:pw});
    if(error){showToast(error.message||'ÌöåÏõêÍ∞ÄÏûÖÏóê Ïã§Ìå®ÌñàÏñ¥Ïöî');return;}
    const newProfile={id:data.user.id,name,email,type:selectedUserType,loc,temp:36.5,join_date:new Date().toISOString().slice(0,10)};
    await _sb.from('users').insert(newProfile);
    curUser={...newProfile,joinDate:newProfile.join_date};
    lsSet('curUser',curUser);
    showToast('Í∞ÄÏûÖ ÏôÑÎ£å! ÌôòÏòÅÌï¥Ïöî üéâ');showView('list');showListSkeleton();loadProductsFromSupabase();
  }catch(e){showToast('ÌöåÏõêÍ∞ÄÏûÖ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏñ¥Ïöî');console.error(e);}
}
async function doLogout(){
  try{if(_sb&&curUser?.email!=='admin')await _sb.auth.signOut();}catch(e){}
  curUser=null;lsSet('curUser',null);showView('login');
}
function selectType(type,el){
  selectedUserType=type;
  document.querySelectorAll('.type-card').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel');
}

/* ==================== FILTER CHIPS ==================== */
const FILTERS=['Ï†ÑÏ≤¥','Î©¥','Ìè¥Î¶¨','Ïö∏','Î¶∞ÎÑ®','Ïã§ÌÅ¨','ÌòºÎ∞©','Í∏∞ÌÉÄ'];
function renderChips(){
  const el=document.getElementById('filter-chips');
  if(!el)return;
  el.innerHTML=FILTERS.map(f=>`<button class="chip ${f===curFilter?'on':''}" onclick="setFilter('${f}')">${t('filter_'+f)||f}</button>`).join('');
}
function setFilter(f){curFilter=f;renderChips();renderList()}

/* ==================== PRODUCT LIST ==================== */
const PAGE_SIZE=20;
let listPage=0,listFiltered=[],listObserver=null;

function showListSkeleton(){
  const sec=document.getElementById('home-category-sections');
  if(sec){sec.innerHTML=Array(3).fill(0).map(()=>`<div class="cat-section"><div class="cat-section-hd"><div class="skel-line skeleton" style="width:100px;height:14px;margin:0"></div></div>${Array(3).fill(0).map(()=>`<div class="h-product-card"><div class="h-product-img skeleton"></div><div class="h-product-body"><div class="skel-line skeleton" style="margin:0 0 6px"></div><div class="skel-line sm skeleton" style="margin:0 0 6px"></div><div class="skel-line xs skeleton" style="margin:0"></div></div></div>`).join('')}</div>`).join('');}
}

/* ===== HOME REDESIGN JS ===== */
const HOME_CATS=[
  {key:'Ï†ÑÏ≤¥',label:'Ï†ÑÏ≤¥'},
  {key:'Î©¥/Î¶∞ÎÑ®',label:'Î©¥/Î¶∞ÎÑ®'},
  {key:'Ìè¥Î¶¨/Ìï©ÏÑ¨',label:'Ìè¥Î¶¨/Ìï©ÏÑ¨'},
  {key:'Ïö∏/Î™®ÏßÅ',label:'Ïö∏/Î™®ÏßÅ'},
  {key:'ÎãàÌä∏/Ï†ÄÏßÄ',label:'ÎãàÌä∏/Ï†ÄÏßÄ'},
  {key:'Ïã§ÌÅ¨/ÏÉàÌã¥',label:'Ïã§ÌÅ¨/ÏÉàÌã¥'},
  {key:'Îç∞Îãò/Ï≤≠',label:'Îç∞Îãò/Ï≤≠'},
  {key:'Í∏∞Îä•ÏÑ±',label:'Í∏∞Îä•ÏÑ±'},
];
const HOME_SECTIONS=[
  {key:'Î©¥/Î¶∞ÎÑ®',label:'üåø Î©¥/Î¶∞ÎÑ®'},
  {key:'Ïö∏/Î™®ÏßÅ',label:'üêë Ïö∏/Î™®ÏßÅ'},
  {key:'ÎãàÌä∏/Ï†ÄÏßÄ',label:'üß∂ ÎãàÌä∏/Ï†ÄÏßÄ'},
  {key:'Ïã§ÌÅ¨/ÏÉàÌã¥',label:'‚ú® Ïã§ÌÅ¨/ÏÉàÌã¥'},
  {key:'Îç∞Îãò/Ï≤≠',label:'üëñ Îç∞Îãò/Ï≤≠'},
  {key:'Í∏∞Îä•ÏÑ±',label:'‚ö° Í∏∞Îä•ÏÑ±'},
  {key:'Ìè¥Î¶¨/Ìï©ÏÑ¨',label:'üî∑ Ìè¥Î¶¨/Ìï©ÏÑ¨'},
];
let homeCurCat='Ï†ÑÏ≤¥';

function getProductsByHomeCat(cat){
  if(cat==='Ï†ÑÏ≤¥')return products;
  return products.filter(p=>p.type===cat||(p.tags||[]).includes(cat));
}

function renderHomeCats(){
  const el=document.getElementById('home-cats');
  if(!el)return;
  el.innerHTML=HOME_CATS.map(c=>`<button class="home-cat${homeCurCat===c.key?' on':''}" onclick="setHomeCat('${c.key}')">${c.label}</button>`).join('');
}

function setHomeCat(key){
  homeCurCat=key;
  renderHomeCats();
  renderHomeSections();
}

function renderAiRecs(){
  const el=document.getElementById('ai-rec-scroll');
  if(!el)return;
  const pool=products.slice(0,Math.min(8,products.length));
  if(!pool.length){el.innerHTML='<div style="padding:20px;color:#8888aa;font-size:13px">ÏÉÅÌíàÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</div>';return;}
  el.innerHTML=pool.map(p=>{
    const bg=getFColor(p.type,p.color);
    const disc=Math.floor(Math.random()*25)+5;
    return `<div class="ai-card" onclick="openDetail(${p.id})">
      <div class="ai-card-thumb" style="background:${bg}">
        ${p.image_url?`<img src="${p.image_url}" alt="">`:''}
        <span class="ai-badge-gold">AIÏ∂îÏ≤ú</span>
      </div>
      <div class="ai-card-info">
        <div class="ai-card-name">${p.title}</div>
        <div><span class="ai-card-price">${fmtPrice(p.price)}/m</span><span class="ai-card-disc">-${disc}%</span></div>
      </div>
    </div>`;
  }).join('');
}

function renderHomeProduct(p){
  const urgent=p.qty<100;
  const bg=getFColor(p.type,p.color);
  return `<div class="h-product-card" onclick="openDetail(${p.id})">
    <div class="h-product-img" style="background:${bg}">
      ${p.image_url?`<img src="${p.image_url}" alt="">`:'' }
    </div>
    <div class="h-product-body">
      ${urgent?'<span class="h-badge-urgent">‚ö° Í∏âÏ≤ò</span>':''}
      <div class="h-product-name">${p.title}</div>
      <div class="h-badges">
        <span class="h-fabric-badge">${p.type}</span>
        ${p.width?`<span class="h-weight-badge">${p.width}cm</span>`:''}
      </div>
      <div class="h-price">${fmtPrice(p.price)}<span class="h-pu">/m</span></div>
      <div class="h-bottom">
        <span class="h-seller">üìç${p.loc?p.loc.split(' ').slice(-1)[0]:'ÏúÑÏπò ÎØ∏ÏÉÅ'}</span>
        <span class="h-counts"><span>ü§ç${p.likes||0}</span><span>üí¨${p.chats||0}</span></span>
      </div>
    </div>
  </div>`;
}

function renderHomeSections(){
  const el=document.getElementById('home-category-sections');
  if(!el)return;
  const sections=homeCurCat==='Ï†ÑÏ≤¥'?HOME_SECTIONS:[{key:homeCurCat,label:HOME_CATS.find(c=>c.key===homeCurCat)?.label||homeCurCat}];
  el.innerHTML=sections.map(sec=>{
    const items=products.filter(p=>p.type===sec.key||(p.tags||[]).includes(sec.key)).slice(0,5);
    if(!items.length)return '';
    return `<div class="cat-section">
      <div class="cat-section-hd">
        <span class="cat-section-title">${sec.label}</span>
        <span class="cat-section-more" onclick="goSearchCat('${sec.key}')">ÎçîÎ≥¥Í∏∞ ‚Üí</span>
      </div>
      ${items.map(p=>renderHomeProduct(p)).join('')}
    </div>`;
  }).filter(Boolean).join('');
  if(!el.innerHTML){
    el.innerHTML=`<div style="padding:40px 14px;text-align:center;color:#8888aa;font-size:13px">Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê ÏÉÅÌíàÏù¥ ÏóÜÏñ¥Ïöî</div>`;
  }
}

function goSearchCat(cat){
  curFilter=cat;
  showView('search-view');
}

function openNoticeModal(){openModal('modal-notice')}

function openCategorySheet(){
  const el=document.getElementById('category-sheet-content');
  if(el){
    el.innerHTML=HOME_CATS.map(c=>`<button onclick="setHomeCat('${c.key}');closeModal('modal-category')" style="padding:16px 12px;background:${homeCurCat===c.key?'rgba(108,99,255,.15)':'#1e1e2e'};border:1.5px solid ${homeCurCat===c.key?'#6c63ff':'#2a2a3e'};border-radius:14px;color:${homeCurCat===c.key?'#6c63ff':'#aaaacc'};font-size:13px;font-weight:600;text-align:center">${c.label}</button>`).join('');
  }
  openModal('modal-category');
}

function renderList(){
  renderHomeCats();
  renderAiRecs();
  renderHomeSections();
}

function appendListPage(){
  const list=document.getElementById('product-list');
  if(!list)return;
  const start=listPage*PAGE_SIZE;
  const page=listFiltered.slice(start,start+PAGE_SIZE);
  if(!page.length)return;
  list.innerHTML+=page.map((p,i)=>renderCard(p,start+i)).join('');
  listPage++;
  setupListObserver();
}

function setupListObserver(){
  if(listObserver){listObserver.disconnect();listObserver=null;}
  const sentinel=document.getElementById('list-sentinel');
  if(!sentinel||listPage*PAGE_SIZE>=listFiltered.length)return;
  listObserver=new IntersectionObserver(entries=>{
    if(entries[0].isIntersecting){listObserver.disconnect();listObserver=null;appendListPage();}
  },{threshold:0,rootMargin:'300px'});
  listObserver.observe(sentinel);
}
function renderCard(p, idx){
  const bg=getFColor(p.type,p.color);
  const tex=getTexture(p.type);
  const total=p.qty*p.price;
  const isNew=p.id>10;
  const delay=typeof idx==='number'?(idx%PAGE_SIZE)*0.04:0;
  return `<li class="pcard" onclick="openDetail(${p.id})" style="animation-delay:${delay}s">
    ${isNew?'<div class="badge-new">NEW</div>':''}
    <div class="pthumb" style="background:${bg};background-image:${tex}">
      ${p.image_url?`<img src="${p.image_url}" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover"/>`:'' }
      <span class="fabric-badge" style="position:relative;z-index:1">${p.type}</span>
    </div>
    <button class="card-heart" onclick="event.stopPropagation();toggleLike(${p.id})">${p.liked?'‚ù§Ô∏è':'ü§ç'}</button>
    <div class="pinfo">
      <div class="pname">${p.title}</div>
      <div class="pmeta">${p.color} ¬∑ ${p.width}cm ¬∑ ${p.qty}m</div>
      <div class="pprice">${fmtPrice(total)}<span class="pu"> (${fmtPrice(p.price)}/m)</span></div>
      <div class="pfoot">
        <span class="ploc">üìç${p.loc.split(' ').slice(-1)[0]}</span>
        <span class="pcnt"><span>ü§ç${p.likes}</span><span>üí¨${p.chats}</span></span>
      </div>
    </div>
  </li>`;
}

/* ==================== LIKE ==================== */
function toggleLike(id){
  const p=products.find(x=>x.id===id);if(!p)return;
  p.liked=!p.liked;p.likes+=p.liked?1:-1;saveProducts();
  const likedMap=lsGet('likedMap',{});likedMap[id]=p.liked;lsSet('likedMap',likedMap);
  _sb.from('products').update({likes:p.likes}).eq('id',id).then();
  renderList();
  showToast(p.liked?t('like_add'):t('like_remove'));
}

/* ==================== DETAIL ==================== */
function openDetail(id){
  prevView='list';
  curProductId=id;sliderIdx=0;
  const p=products.find(x=>x.id===id);if(!p)return;
  document.getElementById('d-hdr-title').textContent=p.title;
  document.getElementById('d-scroll').scrollTop=0;
  // slider
  sliderTotal=p.imgs||1;
  const bg=getFColor(p.type,p.color);const tex=getTexture(p.type);
  const track=document.getElementById('s-track');
  const dots=document.getElementById('s-dots');
  const vs=['','filter:brightness(1.1)','filter:brightness(.9)','filter:saturate(1.3)','filter:hue-rotate(15deg)'];
  track.innerHTML=Array.from({length:sliderTotal},(_,i)=>{
    const showImg=i===0&&p.image_url;
    return `<div class="s-slide" style="background:${bg};background-image:${showImg?'none':tex};${showImg?'':vs[i]||''};flex-shrink:0;width:${100/sliderTotal}%;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;flex-direction:column">
      ${showImg?`<img src="${p.image_url}" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover"/>`:'' }
      <div style="position:relative;z-index:1;font-size:36px">${showImg?'':'üßµ'}</div>
      <div style="position:relative;z-index:1;font-size:13px;font-weight:600;background:rgba(0,0,0,.3);padding:5px 14px;border-radius:20px;color:rgba(255,255,255,.95)">${p.color} ${p.type}</div>
      <div style="position:relative;z-index:1;font-size:11px;margin-top:4px;opacity:.8">${i+1}/${sliderTotal}</div>
    </div>`;
  }).join('');
  track.style.width=(sliderTotal*100)+'%';
  dots.innerHTML=Array.from({length:sliderTotal},(_,i)=>`<div class="s-dot ${i===0?'on':''}"></div>`).join('');
  document.getElementById('s-prev').style.display=sliderTotal>1?'flex':'none';
  document.getElementById('s-next').style.display=sliderTotal>1?'flex':'none';
  updateSlider();
  // seller
  const av=document.getElementById('d-av');
  av.textContent=p.seller.name[0];av.style.background=bg;
  document.getElementById('d-sname').textContent=p.seller.name;
  document.getElementById('d-sloc').textContent='üìç '+p.loc;
  document.getElementById('d-temp').textContent=p.seller.temp.toFixed(1)+'¬∞C';
  // fabric table
  document.getElementById('d-ftbl').innerHTML=[
    [t('lbl_type'),p.type],[t('lbl_color'),p.color],[t('lbl_width'),p.width+'cm'],
    [t('lbl_weight'),p.weight?(p.weight+'g/„é°'):t('lbl_unknown')],
    [t('lbl_qty'),p.qty+'m'],[t('lbl_price'),fmtPrice(p.price)+'/m'],
  ].map(([k,v])=>`<tr><td>${k}</td><td>${v}</td></tr>`).join('');
  document.getElementById('d-desc').textContent=p.description;
  document.getElementById('d-tags').innerHTML=(p.tags||[]).map(tg=>`<span class="tagc">#${tg}</span>`).join('');
  document.getElementById('d-stats').innerHTML=`${t('stats_interest')} ${p.likes} &nbsp;¬∑&nbsp; ${t('stats_chat')} ${p.chats} &nbsp;¬∑&nbsp; ${p.time}`;
  // action bar
  document.getElementById('d-tp').textContent=fmtPrice(p.qty*p.price);
  document.getElementById('d-pp').textContent=fmtPrice(p.price)+'/m ¬∑ '+p.qty+'m';
  updateDetailHeart(p);
  // res date default
  document.getElementById('res-date').valueAsDate=new Date();
  curSellerData=p.seller;
  showView('detail');
}
function updateDetailHeart(p){
  const btn=document.getElementById('d-heart');
  const icon=document.getElementById('d-hicon');
  btn.className='heart-btn'+(p.liked?' on':'');
  icon.textContent=p.liked?'‚ù§Ô∏è':'ü§ç';
  document.getElementById('d-lcnt').textContent=p.likes;
}
function toggleDetailLike(){
  const p=products.find(x=>x.id===curProductId);if(!p)return;
  p.liked=!p.liked;p.likes+=p.liked?1:-1;saveProducts();
  const likedMap=lsGet('likedMap',{});likedMap[p.id]=p.liked;lsSet('likedMap',likedMap);
  _sb.from('products').update({likes:p.likes}).eq('id',p.id).then();
  updateDetailHeart(p);
  showToast(p.liked?t('like_add'):t('like_remove'));
}
function openChatModal(){if(curProductId)openChatRoom(curProductId);}
function shareProduct(){openModal('modal-share')}
function openSellerPage(){
  const p=products.find(x=>x.id===curProductId);if(!p)return;
  renderSellerPage(p.seller);
}

/* ==================== SLIDER ==================== */
function slideMove(d){sliderIdx=Math.max(0,Math.min(sliderTotal-1,sliderIdx+d));updateSlider()}
function updateSlider(){
  const track=document.getElementById('s-track');
  track.style.transform=`translateX(-${(sliderIdx/sliderTotal)*100}%)`;
  document.querySelectorAll('.s-dot').forEach((d,i)=>d.classList.toggle('on',i===sliderIdx));
}
const slider=document.getElementById('d-slider');
let tX=0;
slider.addEventListener('touchstart',e=>{tX=e.touches[0].clientX},{passive:true});
slider.addEventListener('touchend',e=>{if(Math.abs(e.changedTouches[0].clientX-tX)>40)slideMove(e.changedTouches[0].clientX<tX?1:-1)});

/* ==================== MODALS ==================== */
function openModal(id){document.getElementById(id).classList.add('open')}
function closeModal(id,e){if(!e||e.target===document.getElementById(id)||!e)document.getElementById(id).classList.remove('open')}
function openSuggestModal(){openModal('modal-suggest')}
function openResModal(){openModal('modal-res')}
function submitSuggest(){
  const price=document.getElementById('suggest-price').value;
  if(!price){showToast('Ï†úÏïà Í∞ÄÍ≤©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');return}
  closeModal('modal-suggest');showToast('Í∞ÄÍ≤© Ï†úÏïàÏù¥ Ï†ÑÏÜ°ÎêêÏñ¥Ïöî! üí∞');
}
function selectRes(type,el){
  curResType=type;
  document.querySelectorAll('.res-card').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel');
}
function selectResModal(type,el){
  curResType=type;
  document.querySelectorAll('.res-type-card').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel');
}
async function submitReservation(){
  const date=document.getElementById('res-date').value;
  const time=document.getElementById('res-time').value;
  const note=document.getElementById('res-note').value.trim();
  if(curUser&&curProductId){
    const{error}=await _sb.from('reservations').insert({
      product_id:curProductId,
      user_id:curUser.id,
      type:curResType,
      date,time,note,
    });
    if(error)console.error('reservation error:',error);
  }
  closeModal('modal-res');showToast(`${date} ${time} ÏòàÏïΩÏù¥ Ïã†Ï≤≠ÎêêÏñ¥Ïöî! üìÖ`);
}

/* ==================== SELLER PAGE ==================== */
function switchSellerTab(tab,el){
  document.querySelectorAll('#view-seller .seller-tab').forEach(t=>t.classList.remove('on'));
  el.classList.add('on');
  const content=document.getElementById('sh-tab-content');
  const seller=curSellerData||{};
  const myProds=products.filter(p=>p.seller&&p.seller.name===seller.name);
  if(tab==='onsale'){
    const intro=seller._intro?`<div class="seller-intro">${seller._intro}</div>`:'';
    const active=myProds.filter(p=>p.status!=='sold');
    const grid=active.length
      ?`<ul class="plist" style="padding:10px 10px 20px;grid-template-columns:1fr 1fr">${active.map(renderCard).join('')}</ul>`
      :`<div class="empty"><div class="ei">üì¶</div><p>ÌåêÎß§ Ï§ëÏù∏ ÏÉÅÌíàÏù¥ ÏóÜÏñ¥Ïöî</p></div>`;
    content.innerHTML=intro+grid;
  }else if(tab==='sold'){
    const sold=myProds.filter(p=>p.status==='sold');
    content.innerHTML=sold.length
      ?`<ul class="plist" style="padding:10px 10px 20px;grid-template-columns:1fr 1fr">${sold.map(renderCard).join('')}</ul>`
      :`<div class="empty"><div class="ei">‚úÖ</div><p>Í±∞ÎûòÏôÑÎ£å ÎÇ¥Ïó≠Ïù¥ ÏóÜÏñ¥Ïöî</p></div>`;
  }else{
    content.innerHTML=`<div class="empty"><div class="ei">üí¨</div><p>ÏïÑÏßÅ Î¶¨Î∑∞Í∞Ä ÏóÜÏñ¥Ïöî</p></div>`;
  }
}
function renderSellerPage(seller){
  prevView='detail';
  curSellerData=seller;
  const bg=getFColor(seller.name,'abc');
  const overlay=document.getElementById('sh-cover-overlay');
  if(overlay)overlay.style.background=`linear-gradient(135deg,${bg}55,rgba(255,101,132,.2))`;
  const av=document.getElementById('sh-av');
  av.textContent=seller.name[0];av.style.background=`linear-gradient(135deg,${bg},#ff9a6c)`;
  document.getElementById('sh-name').textContent=seller.name;
  document.getElementById('sh-loc').textContent='üìç '+(seller.loc||'ÏÑúÏö∏')+'  üå°Ô∏è '+(seller.temp||36.5).toFixed(1)+'¬∞C';
  const userInfo=users.find(u=>u.id===seller.id||u.name===seller.name)||{};
  curSellerData._intro=userInfo.intro||'Ïû¨Í≥†ÏõêÎã® Ï†ÑÎ¨∏ ÏóÖÏ≤¥ÏûÖÎãàÎã§. Îã§ÏñëÌïú ÏÜåÏû¨Ïùò ÏõêÎã®ÏùÑ Ìï©Î¶¨Ï†ÅÏù∏ Í∞ÄÍ≤©Ïóê Í≥µÍ∏âÌï©ÎãàÎã§.';
  const myProds=products.filter(p=>p.seller&&p.seller.name===seller.name);
  document.getElementById('sh-stats').innerHTML=`
    <div class="sstat"><div class="sv">${myProds.length}</div><div class="sl">ÏÉÅÌíà</div></div>
    <div class="sstat"><div class="sv">${(seller.temp||36.5).toFixed(1)}¬∞C</div><div class="sl">Îß§ÎÑàÏò®ÎèÑ</div></div>
    <div class="sstat"><div class="sv">${myProds.reduce((a,p)=>a+p.likes,0)}</div><div class="sl">Í¥ÄÏã¨</div></div>
  `;
  document.querySelectorAll('#view-seller .seller-tab').forEach((t,i)=>t.classList.toggle('on',i===0));
  const firstTab=document.querySelector('#view-seller .seller-tab');
  if(firstTab)switchSellerTab('onsale',firstTab);
  showView('seller');
}

/* ==================== FORM ==================== */
document.getElementById('file-input').addEventListener('change',e=>{
  const files=Array.from(e.target.files);
  const rem=5-uploadedImgs.length;
  const wasEmpty=uploadedImgs.length===0;
  files.slice(0,rem).forEach((f,fi)=>{
    const r=new FileReader();
    r.onload=ev=>{
      uploadedImgs.push(ev.target.result);
      renderImgPreviews();
      if(wasEmpty&&fi===0)runAIAnalysis(ev.target.result);
    };
    r.readAsDataURL(f);
  });
  if(files.length>rem)showToast('ÏµúÎåÄ 5Ïû•ÍπåÏßÄ Ï≤®Î∂Ä Í∞ÄÎä•Ìï¥Ïöî');
  e.target.value='';
});
function renderImgPreviews(){
  const scroll=document.getElementById('img-scroll');
  const add=scroll.querySelector('.img-add');
  const box=document.getElementById('img-upload-box');
  scroll.querySelectorAll('.img-prev').forEach(e=>e.remove());
  uploadedImgs.forEach((src,i)=>{
    const d=document.createElement('div');d.className='img-prev';
    d.innerHTML=`<img src="${src}" alt="preview"/><button class="img-rm" onclick="removeImg(${i})">‚úï</button>`;
    scroll.insertBefore(d,add);
  });
  if(box)box.style.display=uploadedImgs.length>0?'none':'flex';
  scroll.style.display=uploadedImgs.length>0?'flex':'none';
  add.style.display=uploadedImgs.length>=5?'none':'flex';
}
function removeImg(i){uploadedImgs.splice(i,1);renderImgPreviews()}
function calcTotal(){
  const qty=parseFloat(document.getElementById('f-qty').value)||0;
  const price=parseFloat(document.getElementById('f-price').value)||0;
  const el=document.getElementById('f-total');
  el.textContent=qty&&price?`Ï¥ù ${fmtPrice(qty*price)} (${fmtPrice(price)}/m √ó ${qty}m)`:t('form_total_hint');
  // AI price hint
  const hint=document.getElementById('ai-price-hint');
  const type=document.getElementById('f-type').value;
  if(type&&price){
    const ranges={Î©¥:[3000,8000],Ìè¥Î¶¨:[2000,6000],Ïö∏:[12000,35000],Î¶∞ÎÑ®:[5000,12000],Ïã§ÌÅ¨:[20000,80000],ÌòºÎ∞©:[4000,10000],Í∏∞ÌÉÄ:[2000,15000]};
    const [lo,hi]=ranges[type]||[2000,20000];
    const avg=Math.round((lo+hi)/2);
    const diff=price-avg;
    const msg=diff<-avg*.2?'‚úÖ AI ÏòàÏ∏°: ÏãúÏÑ∏Î≥¥Îã§ Ï†ÄÎ†¥Ìï¥Ïöî! Îπ†Î•∏ Í±∞Îûò ÏòàÏÉÅ':diff>avg*.2?'‚ö†Ô∏è AI ÏòàÏ∏°: ÏãúÏÑ∏Î≥¥Îã§ ÎÜíÏùÑ Ïàò ÏûàÏñ¥Ïöî. Ï°∞Ï†ïÏùÑ Í≥†Î†§Ìï¥Î≥¥ÏÑ∏Ïöî':'üìä AI ÏòàÏ∏°: Ï†ÅÏ†ï ÏãúÏÑ∏ Î≤îÏúÑÏòàÏöî! ('+type+' ÌèâÍ∑† '+fmtPrice(avg)+'/m)';
    hint.textContent=msg;
  }
}
function updateCat2(){/* 3-tier category hook */}
async function submitForm(){
  const title=document.getElementById('f-title').value.trim();
  const type=document.getElementById('f-type').value;
  const color=document.getElementById('f-color').value.trim();
  const qty=parseFloat(document.getElementById('f-qty').value);
  const price=parseFloat(document.getElementById('f-price').value);
  const loc=document.getElementById('f-loc').value.trim();
  if(!title){showToast('ÏÉÅÌíàÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');return;}
  if(!type){showToast('ÏõêÎã® Ï¢ÖÎ•òÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî');return;}
  if(!color){showToast('ÏÉâÏÉÅÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');return;}
  if(!qty||qty<=0){showToast('ÏàòÎüâÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');return;}
  if(!price||price<=0){showToast('Îã®Í∞ÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');return;}
  if(!loc){showToast('Í±∞Îûò ÏßÄÏó≠ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');return;}
  const rawTags=document.getElementById('f-tags').value.trim();
  const tags=rawTags?rawTags.split(',').map(tg=>tg.trim().replace(/^#/,'')).filter(Boolean):[];
  const width=parseInt(document.getElementById('f-width').value)||0;
  const weight=parseInt(document.getElementById('f-weight').value)||0;
  const description=document.getElementById('f-desc').value.trim()||'ÏÉÅÌíà ÏÑ§Î™ÖÏù¥ ÏóÜÏäµÎãàÎã§.';
  const sellerInfo=curUser?{id:curUser.id,name:curUser.name,temp:curUser.temp||36.5,loc:curUser.loc||loc}:{name:'ÎÇò',temp:36.5,loc};
  // Ï≤´ Î≤àÏß∏ Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï (Base64 thumbnail)
  let image_url=null;
  if(uploadedImgs.length>0){
    try{image_url=await compressImage(uploadedImgs[0],400,0.7);}
    catch(e){console.warn('[submitForm] Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï Ïã§Ìå®:',e);}
  }
  const payload={title,type,color,width,weight,qty,price,loc,cat:document.getElementById('f-cat1').value||'Í∏∞ÌÉÄ',description,tags,seller:sellerInfo,imgs:Math.max(1,uploadedImgs.length),likes:0,chats:0,time:'Î∞©Í∏à Ï†Ñ'};
  if(image_url)payload.image_url=image_url;
  // Ìèº Ï¥àÍ∏∞Ìôî Ìó¨Ìçº
  function resetForm(){
    ['f-title','f-color','f-width','f-weight','f-qty','f-price','f-loc','f-desc','f-tags'].forEach(id=>{document.getElementById(id).value=''});
    document.getElementById('f-type').value='';document.getElementById('f-cat1').value='';
    document.getElementById('f-total').textContent=t('form_total_hint');
    const ph=document.getElementById('ai-price-hint');
    if(ph)ph.textContent='ÏõêÎã® Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÎ©¥ AIÍ∞Ä Ï†ÅÏ†ï Í∞ÄÍ≤©ÏùÑ ÏòàÏ∏°Ìï¥ÎìúÎ†§Ïöî üìä';
    uploadedImgs=[];renderImgPreviews();
  }
  // SupabaseÏóê ÏÉÅÌíà Ï†ÄÏû•
  if(!_sb){
    // Supabase ÎØ∏Ïó∞Í≤∞ ‚Äî localStorageÏóêÎßå ÏûÑÏãú Ï†ÄÏû•
    console.warn('[submitForm] Supabase ÎØ∏Ïó∞Í≤∞ ‚Äî localStorageÏóêÎßå Ï†ÄÏû•Îê©ÎãàÎã§.');
    const newP={...payload,id:Date.now(),liked:false,image_url:image_url||undefined};
    products.unshift(newP);saveProducts();
    resetForm();showView('list');showToast(t('registered'));
    return;
  }
  try{
    console.log('[submitForm] insert ÏãúÎèÑ payload:', JSON.stringify(payload));
    let{data:inserted,error}=await _sb.from('products').insert(payload).select().single();
    // image_url Ïª¨ÎüºÏù¥ ÏóÜÏúºÎ©¥ Ïù¥ÎØ∏ÏßÄ ÏóÜÏù¥ Ïû¨ÏãúÎèÑ
    if(error&&error.code==='42703'&&payload.image_url){
      console.warn('[submitForm] image_url Ïª¨Îüº ÏóÜÏùå ‚Äî Ïù¥ÎØ∏ÏßÄ ÏóÜÏù¥ Ïû¨ÏãúÎèÑ');
      delete payload.image_url;
      const res2=await _sb.from('products').insert(payload).select().single();
      inserted=res2.data;error=res2.error;
    }
    if(error){
      console.error('[submitForm] insert Ïò§Î•ò ‚Äî code:',error.code,'message:',error.message,'details:',error.details,'hint:',error.hint);
      showToast('Ï†ÄÏû• Ïã§Ìå®: '+error.message);
      return;
    }
    console.log('[submitForm] insert ÏÑ±Í≥µ ‚Äî id:',inserted.id);
    resetForm();
    showView('list');
    showToast(t('registered'));
    lsDelTTL('products_sb');await loadProductsFromSupabase(); // Supabase ÏµúÏã† Î™©Î°ùÏúºÎ°ú Í∞±Ïã†
  }catch(e){
    console.error('[submitForm] insert ÏòàÏô∏:', e);
    showToast('ÏÉÅÌíà Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏñ¥Ïöî');
  }
}
document.getElementById('search-input').addEventListener('input',e=>{curSearch=e.target.value;renderList()});
document.getElementById('sv-input').addEventListener('input',e=>{
  svSearch=e.target.value;
  const q=svSearch.trim();
  if(q.length>=2)addRecentSearch(q);
  renderSearchView();
});
const _btnLoc=document.getElementById('btn-loc');if(_btnLoc)_btnLoc.addEventListener('click',()=>showToast('ÏßÄÏó≠ ÏÑ§Ï†ï Í∏∞Îä• Ï§ÄÎπÑÏ§ëÏù¥ÏóêÏöî'));
document.getElementById('btn-alert').addEventListener('click',()=>showToast('ÏÉàÎ°úÏö¥ ÏïåÎ¶ºÏù¥ ÏóÜÏñ¥Ïöî'));

/* ==================== SEARCH VIEW ==================== */
function renderSearchView(){
  renderSvChips();
  renderRecentSearches();
  const list=document.getElementById('sv-list');
  const empty=document.getElementById('sv-empty');
  const resultHd=document.getElementById('sv-result-hd');
  const clearBtn=document.getElementById('sv-clear-btn');
  const q=svSearch.trim().toLowerCase();
  if(clearBtn)clearBtn.style.display=q?'inline':'none';
  const filtered=products.filter(p=>{
    const mf=svFilter==='Ï†ÑÏ≤¥'||p.type===svFilter;
    const ms=!q||p.title.toLowerCase().includes(q)||p.type.includes(q)||p.color.toLowerCase().includes(q)||(p.tags||[]).some(tg=>tg.toLowerCase().includes(q))||(p.seller&&p.seller.name.toLowerCase().includes(q));
    return mf&&ms;
  });
  if(resultHd){
    resultHd.style.display=q?'block':'none';
    if(q)resultHd.textContent=`"${svSearch.trim()}" Í≤ÄÏÉâ Í≤∞Í≥º ${filtered.length}Í±¥`;
  }
  if(!filtered.length){
    list.innerHTML='';list.style.display='none';empty.style.display='flex';
    document.getElementById('sv-empty-msg').textContent=q||svFilter!=='Ï†ÑÏ≤¥'?t('empty_msg'):'Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÍ±∞ÎÇò Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî';
  }else{
    empty.style.display='none';list.style.display='grid';
    list.innerHTML=filtered.map(renderCard).join('');
  }
  setTimeout(()=>document.getElementById('sv-input')?.focus(),120);
}
function renderSvChips(){
  const el=document.getElementById('sv-chips');if(!el)return;
  el.innerHTML=FILTERS.map(f=>`<button class="chip ${f===svFilter?'on':''}" onclick="setSvFilter('${f}')">${t('filter_'+f)||f}</button>`).join('');
}
function setSvFilter(f){svFilter=f;renderSvChips();renderSearchView();}
function updateSvFilterBtns(active){
  const ids=['Ï†ÑÏ≤¥','Î©¥','Ìè¥Î¶¨','Ïö∏','Î¶∞ÎÑ®','Ïã§ÌÅ¨','ÌòºÎ∞©'];
  ids.forEach(id=>{
    const btn=document.getElementById('svf-'+(id==='Ï†ÑÏ≤¥'?'all':id));
    if(btn)btn.className='sv-filter-btn'+(id===active?' on':'');
  });
}

/* ==================== RECENT SEARCHES ==================== */
function addRecentSearch(q){
  if(!q||q.length<2)return;
  recentSearches=recentSearches.filter(s=>s!==q);
  recentSearches.unshift(q);
  if(recentSearches.length>8)recentSearches=recentSearches.slice(0,8);
  lsSet('recentSearches',recentSearches);
}
function removeRecentSearch(q){
  recentSearches=recentSearches.filter(s=>s!==q);
  lsSet('recentSearches',recentSearches);
  renderRecentSearches();
}
function clearAllRecent(){
  recentSearches=[];
  lsSet('recentSearches',recentSearches);
  renderRecentSearches();
}
function applySvSearch(q){
  const el=document.getElementById('sv-input');
  if(el){el.value=q;}
  svSearch=q;
  renderSearchView();
}
function clearSvInput(){
  const el=document.getElementById('sv-input');
  if(el)el.value='';
  svSearch='';
  renderSearchView();
}
function renderRecentSearches(){
  const section=document.getElementById('sv-recent-section');
  const chips=document.getElementById('sv-recent-chips');
  if(!section||!chips)return;
  const q=svSearch.trim();
  if(!recentSearches.length||q){section.style.display='none';return;}
  section.style.display='block';
  chips.innerHTML=recentSearches.map(s=>`
    <div class="sv-recent-chip" onclick="applySvSearch('${s.replace(/'/g,"\\'").replace(/"/g,'&quot;')}')">
      <span style="font-size:12px;opacity:.5">üïê</span>
      <span>${s}</span>
      <button class="sv-recent-del" onclick="event.stopPropagation();removeRecentSearch('${s.replace(/'/g,"\\'").replace(/"/g,'&quot;')}')">‚úï</button>
    </div>`).join('');
}

/* ==================== WISHLIST ==================== */
function renderWishlist(){
  const likedMap=lsGet('likedMap',{});
  const liked=products.filter(p=>likedMap[p.id]||p.liked);
  const list=document.getElementById('wishlist-list');
  const empty=document.getElementById('wishlist-empty');
  if(!liked.length){list.innerHTML='';list.style.display='none';empty.style.display='flex';}
  else{empty.style.display='none';list.style.display='grid';list.innerHTML=liked.map(renderCard).join('');}
}

/* ==================== CHAT ==================== */
function formatChatTime(d){return d.getHours().toString().padStart(2,'0')+':'+d.getMinutes().toString().padStart(2,'0');}
function openChatRoom(productId){
  const roomId='prod_'+productId;
  curChatRoomId=roomId;
  if(!chatRooms[roomId]){
    const p=products.find(x=>x.id===productId);
    if(!p)return;
    chatRooms[roomId]={
      id:roomId,productId,productTitle:p.title,productPrice:p.price,
      sellerName:p.seller?.name||'ÌåêÎß§Ïûê',
      bgColor:getFColor(p.type,p.color),
      messages:[{from:'seller',text:'ÏïàÎÖïÌïòÏÑ∏Ïöî! Í¥ÄÏã¨ Í∞ÄÏ†∏Ï£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§ üòä Í∂ÅÍ∏àÌïú Ï†ê ÏûàÏúºÏãúÎ©¥ Ìé∏ÌïòÍ≤å Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî!',time:formatChatTime(new Date())}],
      lastMsg:'ÏïàÎÖïÌïòÏÑ∏Ïöî! Í¥ÄÏã¨ Í∞ÄÏ†∏Ï£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§ üòä',
      lastTime:formatChatTime(new Date()),unread:1,
    };
    lsSet('chatRooms',chatRooms);
  }else{chatRooms[roomId].unread=0;lsSet('chatRooms',chatRooms);}
  showView('chat-room');
}
function openChatRoomById(roomId){
  curChatRoomId=roomId;
  if(chatRooms[roomId]){chatRooms[roomId].unread=0;lsSet('chatRooms',chatRooms);}
  showView('chat-room');
}
function renderChatList(){
  const wrap=document.getElementById('chat-list-wrap');
  const empty=document.getElementById('chat-list-empty');
  const rooms=Object.values(chatRooms);
  if(!rooms.length){wrap.innerHTML='';wrap.style.display='none';empty.style.display='flex';return;}
  empty.style.display='none';wrap.style.display='block';
  wrap.innerHTML=rooms.slice().reverse().map(r=>`
    <div class="chat-room-item" onclick="openChatRoomById('${r.id}')">
      <div class="cr-av" style="background:${r.bgColor||'#999'}">${(r.sellerName||'?')[0]}</div>
      <div class="cr-info">
        <div class="cr-name">${r.sellerName} ¬∑ ${r.productTitle}</div>
        <div class="cr-preview">${r.lastMsg||'Ï±ÑÌåÖÏùÑ ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî'}</div>
      </div>
      <div class="cr-meta">
        <div class="cr-time">${r.lastTime||''}</div>
        ${r.unread?`<div class="cr-unread">${r.unread}</div>`:''}
      </div>
    </div>`).join('');
}
function renderChatRoom(roomId){
  const room=chatRooms[roomId];if(!room)return;
  document.getElementById('cr-hdr-title').textContent=room.sellerName;
  document.getElementById('cr-prod-title').textContent=room.productTitle;
  const priceEl=document.getElementById('cr-prod-price');
  if(priceEl)priceEl.textContent=room.productPrice?room.productPrice.toLocaleString()+'Ïõê/m':'';
  const thumb=document.getElementById('cr-thumb');
  thumb.style.cssText=`background:${room.bgColor||'#ccc'};border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px;`;
  thumb.textContent='üßµ';
  const body=document.getElementById('cr-body');
  body.innerHTML=room.messages.map(m=>{
    const isMe=m.from==='me';
    return `<div class="msg-row ${isMe?'me':'other'}">
      ${!isMe?`<div class="msg-av" style="background:${room.bgColor||'#999'}">${(room.sellerName||'?')[0]}</div>`:''}
      <div class="msg-col">
        <div class="msg-bubble">${m.text}</div>
        <div class="msg-time">${m.time}</div>
      </div>
    </div>`;
  }).join('');
  setTimeout(()=>body.scrollTop=body.scrollHeight,50);
}
function sendChatMsg(){
  const input=document.getElementById('cr-input');
  const text=input.value.trim();
  if(!text||!curChatRoomId)return;
  const room=chatRooms[curChatRoomId];if(!room)return;
  const time=formatChatTime(new Date());
  room.messages.push({from:'me',text,time});
  room.lastMsg=text;room.lastTime=time;room.unread=0;
  input.value='';lsSet('chatRooms',chatRooms);
  renderChatRoom(curChatRoomId);
  setTimeout(()=>{
    const replies=['ÎÑ§, ÌôïÏù∏Ìï¥ ÎìúÎ¶¥Í≤åÏöî!','ÏÜåÎüâÎèÑ Í∞ÄÎä•Ìï©ÎãàÎã§ üòä','ÌÉùÎ∞∞ Î∞è ÏßÅÍ±∞Îûò Î™®Îëê Îê©ÎãàÎã§.','ÏÉòÌîå Î∞úÏÜ° Í∞ÄÎä•Ìï¥Ïöî!','Í∞ÄÍ≤© ÌòëÏùò Í∞ÄÎä•Ìï©ÎãàÎã§.','Ïû¨Í≥† ÌôïÏù∏ ÌõÑ Ïó∞ÎùΩÎìúÎ¶¥Í≤åÏöî!','ÏÇ¨ÏßÑ Ï∂îÍ∞ÄÎ°ú Î≥¥ÎÇ¥ÎìúÎ¶¥Í≤åÏöî!'];
    const reply=replies[Math.floor(Math.random()*replies.length)];
    const rtime=formatChatTime(new Date());
    room.messages.push({from:'seller',text:reply,time:rtime});
    room.lastMsg=reply;room.lastTime=rtime;
    lsSet('chatRooms',chatRooms);
    renderChatRoom(curChatRoomId);
  },800+Math.random()*800);
}
function goChatProduct(){
  const room=chatRooms[curChatRoomId];if(!room)return;
  openDetail(room.productId);
}
function openLangSettings(){
  const el=document.getElementById('modal-lang-btns');
  el.innerHTML=Object.values(LANGS).map(l=>`
    <button class="lang-modal-btn ${l.code===curLang?'on':''}" onclick="setLang('${l.code}');closeModal('modal-lang')">
      <span class="lm-flag">${l.flag}</span>
      <span class="lm-name">${l.name}</span>
      ${l.code===curLang?'<span class="lm-check">‚úì</span>':''}
    </button>`).join('');
  openModal('modal-lang');
}

/* ==================== RESERVATIONS ==================== */
async function renderReservations(){
  const list=document.getElementById('res-list');
  const empty=document.getElementById('res-empty');
  list.innerHTML='<div style="text-align:center;padding:40px;color:var(--g500);font-size:13px">Î∂àÎü¨Ïò§Îäî Ï§ë...</div>';
  empty.style.display='none';
  if(!curUser||!_sb){
    list.innerHTML='';empty.style.display='flex';return;
  }
  try{
    const{data,error}=await _sb.from('reservations').select('*').eq('user_id',curUser.id).order('created_at',{ascending:false});
    if(error||!data||!data.length){list.innerHTML='';empty.style.display='flex';return;}
    const typeNames={visit:'Î∞©Î¨∏ ÏòàÏïΩ',swatch:'Ïä§ÏôÄÏπò ÏöîÏ≤≠',inspect:'Ï∂úÏû•Í∞êÎ≥Ñ'};
    const typeIcons={visit:'üè†',swatch:'üé®',inspect:'üîç'};
    const statusMap={confirmed:'ÌôïÏ†ï',cancelled:'Ï∑®ÏÜå',pending:'ÎåÄÍ∏∞Ï§ë'};
    const statusBadge={confirmed:'badge-green',cancelled:'badge-gray',pending:'badge-orange'};
    list.innerHTML=data.map(r=>`
      <div class="res-item">
        <div class="res-item-head">
          <div class="res-item-icon">${typeIcons[r.type]||'üìÖ'}</div>
          <div class="res-item-info">
            <div class="res-item-type">${typeNames[r.type]||r.type}</div>
            <div class="res-item-dt">üìÖ ${r.date} &nbsp;üïê ${r.time}</div>
          </div>
          <span class="badge ${statusBadge[r.status||'pending']||'badge-orange'}">${statusMap[r.status||'pending']}</span>
        </div>
        ${r.note?`<div class="res-item-note">üí¨ ${r.note}</div>`:''}
      </div>`).join('');
  }catch(e){
    list.innerHTML='';empty.style.display='flex';
  }
}

/* ==================== NOTIF SETTINGS ==================== */
function renderNotifSettings(){
  const items=[
    {key:'newMsg',title:'ÏÉà Î©îÏãúÏßÄ ÏïåÎ¶º',desc:'Ï±ÑÌåÖ Î©îÏãúÏßÄÎ•º Î∞õÏúºÎ©¥ ÏïåÎ†§ÎìúÎ†§Ïöî'},
    {key:'reservation',title:'ÏòàÏïΩ ÌôïÏ†ï ÏïåÎ¶º',desc:'ÏòàÏïΩÏù¥ ÌôïÏ†ïÎêòÎ©¥ ÏïåÎ†§ÎìúÎ†§Ïöî'},
    {key:'priceChange',title:'Í∞ÄÍ≤© Î≥ÄÎèô ÏïåÎ¶º',desc:'Í¥ÄÏã¨ ÏÉÅÌíà Í∞ÄÍ≤©Ïù¥ Î∞îÎÄåÎ©¥ ÏïåÎ†§ÎìúÎ†§Ïöî'},
    {key:'event',title:'Ïù¥Î≤§Ìä∏ ¬∑ Í≥µÏßÄ ÏïåÎ¶º',desc:'ÏÉàÎ°úÏö¥ Ïù¥Î≤§Ìä∏ÏôÄ Í≥µÏßÄÎ•º ÏïåÎ†§ÎìúÎ†§Ïöî'},
  ];
  document.getElementById('notif-list').innerHTML=items.map(it=>`
    <div class="toggle-row">
      <div class="toggle-label">
        <div class="toggle-title">${it.title}</div>
        <div class="toggle-desc">${it.desc}</div>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" ${notifSettings[it.key]?'checked':''} onchange="toggleNotif('${it.key}',this.checked)"/>
        <span class="toggle-slider"></span>
      </label>
    </div>`).join('');
}
function toggleNotif(key,val){
  notifSettings[key]=val;
  lsSet('notifSettings',notifSettings);
  showToast(val?'ÏïåÎ¶ºÏù¥ ÏºúÏ°åÏñ¥Ïöî üîî':'ÏïåÎ¶ºÏù¥ Í∫ºÏ°åÏñ¥Ïöî üîï');
}

/* ==================== PROFILE EDIT ==================== */
function renderProfileEdit(){
  const u=curUser||{};
  const nameEl=document.getElementById('pe-name');
  const introEl=document.getElementById('pe-intro');
  const locEl=document.getElementById('pe-loc');
  const avEl=document.getElementById('pe-av');
  nameEl.value=u.name||'';
  introEl.value=u.intro||'';
  locEl.value=u.loc||'';
  avEl.textContent=(u.name||'?')[0];
}
async function saveProfile(){
  const name=document.getElementById('pe-name').value.trim();
  const intro=document.getElementById('pe-intro').value.trim();
  const loc=document.getElementById('pe-loc').value.trim();
  if(!name){showToast('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');return;}
  if(curUser){
    curUser.name=name;curUser.intro=intro;curUser.loc=loc;
    lsSet('curUser',curUser);
    if(_sb&&curUser.id&&curUser.id!=='admin'){
      try{await _sb.from('users').update({name,intro,loc}).eq('id',curUser.id);}
      catch(e){console.error('ÌîÑÎ°úÌïÑ ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:',e);}
    }
  }
  showToast('ÌîÑÎ°úÌïÑÏù¥ Ï†ÄÏû•ÎêêÏñ¥Ïöî ‚úÖ');
  goBack();
}

/* ==================== MYPAGE ==================== */
function renderMypage(){
  const u=curUser||{name:'Í≤åÏä§Ìä∏',type:'guest',temp:36.5};
  const av=document.getElementById('mp-av');av.textContent=u.name[0];
  document.getElementById('mp-name').textContent=u.name;
  const types={seller:'ÌåêÎß§Ïûê',buyer:'Íµ¨Îß§Ïûê',brand:'Î∏åÎûúÎìú',both:'Í≤∏ÏóÖ',admin:'Í¥ÄÎ¶¨Ïûê',guest:'Í≤åÏä§Ìä∏'};
  document.getElementById('mp-type').textContent=types[u.type]||'ÌöåÏõê';
  const emailEl=document.getElementById('mp-email');
  if(emailEl)emailEl.textContent=u.email||u.loc||'ÏúÑÏπò ÎØ∏ÏÑ§Ï†ï';
  const temp=u.temp||36.5;
  document.getElementById('mp-temp').textContent=temp.toFixed(1)+'¬∞C';
  const fillEl=document.getElementById('mp-temp-fill');
  if(fillEl)fillEl.style.width=Math.min(Math.max((temp-30)/30*100,0),100)+'%';
  const sells=products.filter(p=>p.seller&&(p.seller.id===u.id||p.seller.name===u.name)).length;
  const wishes=lsGet('wishlist',[]).length||Object.values(lsGet('likedMap',{})).filter(Boolean).length;
  const sellEl=document.getElementById('mp-stat-sell');
  const wishEl=document.getElementById('mp-stat-wish');
  if(sellEl)sellEl.textContent=sells;
  if(wishEl)wishEl.textContent=wishes;
  const isSeller=u.type==='seller'||u.type==='both'||u.type==='brand';
  const menus=[
    {section:'ÎÇ¥ Í±∞Îûò'},
    {icon:'‚ù§Ô∏è',label:'Í¥ÄÏã¨ Î™©Î°ù',action:"showView('wishlist')"},
    {icon:'üí¨',label:'Ï±ÑÌåÖ Î™©Î°ù',action:"showView('chat')"},
    {icon:'üìÖ',label:'ÏòàÏïΩ ÎÇ¥Ïó≠',action:"showView('reservations')"},
    {icon:'‚ú®',label:'AI Í∞ÄÍ≤© Î∂ÑÏÑù',action:"showView('ai')"},
    ...(isSeller?[
      {section:'ÌåêÎß§Ïûê Î©îÎâ¥'},
      {icon:'üì¶',label:'ÎÇ¥ ÏÉÅÌíà Í¥ÄÎ¶¨',action:'showMySales()'},
      {icon:'üìä',label:'Îß§Ï∂ú ÎåÄÏãúÎ≥¥Îìú',action:"showView('analytics')"},
      {icon:'üè†',label:'ÎÇ¥ ÎØ∏ÎãàÌôàÌîº',action:'openMySellerPage()'},
    ]:[]),
    {section:'ÏÑ§Ï†ï'},
    {icon:'üåê',label:'Ïñ∏Ïñ¥ ÏÑ§Ï†ï',action:'openLangSettings()'},
    {icon:'üîî',label:'ÏïåÎ¶º ÏÑ§Ï†ï',action:"showView('notif-settings')"},
    {icon:'üë§',label:'ÌîÑÎ°úÌïÑ ÏàòÏ†ï',action:"showView('profile-edit')"},
    {icon:'üö™',label:'Î°úÍ∑∏ÏïÑÏõÉ',action:'doLogout()'},
  ];
  document.getElementById('menu-list').innerHTML=menus.map(m=>{
    if(m.section)return`<div class="menu-section">${m.section}</div>`;
    return`<div class="menu-item" onclick="${m.action}"><span class="menu-icon">${m.icon}</span><span class="menu-label">${m.label}</span><span class="menu-arrow">‚Ä∫</span></div>`;
  }).join('');
}
function showMySales(){
  const u=curUser;if(!u){showToast('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï¥Ïöî');return}
  const myP=products.filter(p=>p.seller&&(p.seller.id===u.id||p.seller.name===u.name));
  showToast('ÎÇ¥ ÏÉÅÌíà '+myP.length+'Í∞ú');
}
function openMySellerPage(){
  if(!curUser){showToast('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï¥Ïöî');return}
  renderSellerPage({id:curUser.id,name:curUser.name,temp:curUser.temp,loc:curUser.loc});
}

/* ==================== ADMIN ==================== */
let curAdminTab='overview';
function renderAdmin(tab){
  curAdminTab=tab;
  const content=document.getElementById('admin-content');
  if(tab==='overview'){
    content.innerHTML=`
      <div class="stat-grid">
        <div class="stat-card"><div class="sv">${users.length}</div><div class="sl">Ï¥ù ÌöåÏõê</div></div>
        <div class="stat-card"><div class="sv">${products.length}</div><div class="sl">Ï¥ù ÏÉÅÌíà</div></div>
        <div class="stat-card"><div class="sv">${products.reduce((a,p)=>a+p.likes,0)}</div><div class="sl">Ï¥ù Í¥ÄÏã¨</div></div>
        <div class="stat-card"><div class="sv">${products.reduce((a,p)=>a+p.chats,0)}</div><div class="sl">Ï¥ù Ï±ÑÌåÖ</div></div>
      </div>
      <div style="background:var(--g100);border-radius:var(--r);padding:14px;font-size:13px;line-height:1.8;color:var(--g700)">
        <b>üìå ÏµúÍ∑º ÌôúÎèô</b><br>
        ¬∑ Ïã†Í∑ú ÏÉÅÌíà ${products.filter(p=>p.id>10).length}Í±¥ Îì±Î°ùÎê®<br>
        ¬∑ Ïã†Í∑ú ÌöåÏõê ${users.length-3}Î™Ö Í∞ÄÏûÖ<br>
        ¬∑ Ïò§Îäò Ï†ëÏÜçÏûê: 127Î™Ö<br>
        ¬∑ Ïù¥Î≤à Ï£º Í±∞ÎûòÏï°: ‚Ç©18,450,000
      </div>`;
  }else if(tab==='users'){
    content.innerHTML=`<div class="table-wrap"><table class="data-table"><thead><tr><th>Ïù¥Î¶Ñ</th><th>Ïú†Ìòï</th><th>Ïù¥Î©îÏùº</th><th>Í∞ÄÏûÖÏùº</th><th>Í¥ÄÎ¶¨</th></tr></thead><tbody>`+
    users.map(u=>`<tr><td><b>${u.name}</b></td><td><span class="badge badge-${u.type==='admin'?'orange':u.type==='seller'?'green':'blue'}">${u.type}</span></td><td style="font-size:11px">${u.email}</td><td style="font-size:11px">${u.joinDate||'-'}</td><td><button class="action-btn" onclick="showToast('${u.name} Ï†ïÎ≥¥ ÏàòÏ†ï Ï§ÄÎπÑÏ§ë')">ÏàòÏ†ï</button></td></tr>`).join('')+
    '</tbody></table></div>';
  }else if(tab==='products'){
    content.innerHTML=`<div class="table-wrap"><table class="data-table"><thead><tr><th>ÏÉÅÌíàÎ™Ö</th><th>Ï¢ÖÎ•ò</th><th>ÏàòÎüâ</th><th>Îã®Í∞Ä</th><th>Í¥ÄÎ¶¨</th></tr></thead><tbody>`+
    products.slice(0,20).map(p=>`<tr><td style="font-size:11px;max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.title}</td><td><span class="badge badge-blue">${p.type}</span></td><td>${p.qty}m</td><td>${fmtPrice(p.price)}</td><td><button class="action-btn del" onclick="adminDeleteProduct(${p.id})">ÏÇ≠Ï†ú</button></td></tr>`).join('')+
    '</tbody></table></div>';
  }else if(tab==='notices'){
    content.innerHTML=`<div style="margin-bottom:12px"><button class="btn-primary" style="padding:10px 18px;font-size:13px" onclick="showToast('Í≥µÏßÄ ÏûëÏÑ± Í∏∞Îä• Ï§ÄÎπÑÏ§ëÏù¥ÏóêÏöî')">+ Í≥µÏßÄ ÏûëÏÑ±</button></div>
    <div style="display:flex;flex-direction:column;gap:10px">
      ${['[Í≥µÏßÄ] ÎπÑÏõÄÎßàÏºì v18.3 ÏóÖÎç∞Ïù¥Ìä∏ ÏïàÎÇ¥','[Í≥µÏßÄ] Ïó¨Î¶Ñ ÏõêÎã® ÌäπÍ∞Ä Í∏∞ÌöçÏ†Ñ ÏßÑÌñâ Ï§ë','[ÏïàÎÇ¥] Îß§ÎÑà Ïò®ÎèÑ ÏãúÏä§ÌÖú Í∞úÌé∏ ÏïàÎÇ¥'].map((title,i)=>`<div style="border:1px solid var(--g200);border-radius:var(--rs);padding:12px 14px;cursor:pointer" onclick="showToast('Í≥µÏßÄ ÏÉÅÏÑ∏ Ï§ÄÎπÑÏ§ë')"><div style="font-size:13px;font-weight:600;margin-bottom:4px">${title}</div><div style="font-size:11px;color:var(--g500)">${['2024.12.01','2024.11.25','2024.11.20'][i]}</div></div>`).join('')}
    </div>`;
  }
}
function switchAdminTab(tab,el){
  document.querySelectorAll('.atab').forEach(t=>t.classList.remove('on'));
  el.classList.add('on');renderAdmin(tab);
}
async function adminDeleteProduct(id){
  if(!confirm('Ï†ïÎßê ÏÇ≠Ï†úÌï†ÍπåÏöî?'))return;
  const{error}=await _sb.from('products').delete().eq('id',id);
  if(error)console.error('delete error:',error);
  products=products.filter(p=>p.id!==id);saveProducts();renderAdmin('products');showToast('ÏÇ≠Ï†úÎêêÏñ¥Ïöî');
}

/* ==================== ANALYTICS ==================== */
function renderAnalytics(){
  const months=['8Ïõî','9Ïõî','10Ïõî','11Ïõî','12Ïõî','1Ïõî'];
  const vals=[1.2,1.8,2.1,1.6,2.4,2.8];
  const max=Math.max(...vals);
  const chart=document.getElementById('bar-chart');
  chart.innerHTML=vals.map((v,i)=>`<div class="bar-item"><div class="bar-val">‚Ç©${v}M</div><div class="bar" style="height:${(v/max)*68}px;${i===vals.length-1?'background:var(--P)':''}"></div><div class="bar-lbl">${months[i]}</div></div>`).join('');
  document.getElementById('top-fabrics').innerHTML=[
    {name:'Î©¥ ÏõêÎã®',pct:38,color:'#E8D5C4'},
    {name:'Ìè¥Î¶¨ ÏõêÎã®',pct:29,color:'#4A90D9'},
    {name:'ÌòºÎ∞© ÏõêÎã®',pct:18,color:'#7B8FA3'},
  ].map(f=>`<div style="margin-bottom:10px"><div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:4px"><span>${f.name}</span><span style="font-weight:700">${f.pct}%</span></div><div style="height:8px;background:var(--g200);border-radius:4px"><div style="height:100%;width:${f.pct}%;background:${f.color};border-radius:4px"></div></div></div>`).join('');
  document.getElementById('market-price').innerHTML=[
    {type:'Î©¥ (40Ïàò)',price:'4,200~6,800',trend:'‚Üë'},
    {type:'Ìè¥Î¶¨ (Ïâ¨Ìè∞)',price:'2,500~4,500',trend:'‚Üí'},
    {type:'Ïö∏ (Î©îÎ¶¨ÎÖ∏)',price:'15,000~28,000',trend:'‚Üì'},
    {type:'Î¶∞ÎÑ®',price:'5,500~9,500',trend:'‚Üë'},
  ].map(f=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid var(--g100);font-size:13px"><span>${f.type}</span><span style="font-weight:600">${f.price}Ïõê/m <span style="color:${f.trend==='‚Üë'?'#e53935':f.trend==='‚Üì'?'#1565c0':'var(--g500)'}">${f.trend}</span></span></div>`).join('');
}

/* ==================== INIT ==================== */
(async function init(){
  // Ïä§ÌîåÎûòÏãú ÌôîÎ©¥ ÌëúÏãú
  showView('splash');
  const splashStart=Date.now();
  // Supabase ÏÑ∏ÏÖò ÌôïÏù∏ (ÏÉàÎ°úÍ≥†Ïπ® ÌõÑ ÏûêÎèô Î°úÍ∑∏Ïù∏ Ïú†ÏßÄ)
  if(_sb){
    try{
      const{data:{session}}=await _sb.auth.getSession();
      if(session){
        const{data:profile}=await _sb.from('users').select('*').eq('id',session.user.id).single();
        if(profile){curUser={...profile};lsSet('curUser',curUser);}
      }
    }catch(e){console.error('ÏÑ∏ÏÖò Î≥µÏõê Ïò§Î•ò:',e);}
  }
  // ÏµúÏÜå 2Ï¥à Ïä§ÌîåÎûòÏãú Î≥¥Ïû•
  const elapsed=Date.now()-splashStart;
  if(elapsed<2000)await new Promise(r=>setTimeout(r,2000-elapsed));
  if(curUser){
    if(curUser.type==='admin')showView('admin');
    else{showView('list');showListSkeleton();loadProductsFromSupabase();}
  }else{
    showView('login');
  }
  renderChips();
})();
</script>
</body>
</html>
